<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="coconutnut">
    
    <title>
        
            TCP/IP复习 |
        
        CoCoNutNut&#39;s NoteBook
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/avatar.png">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"coconutnutx.github.io","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"rgb(70,179,119)","avatar":"/images/avatar.jpg","favicon":"/images/avatar.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":false,"background_img":"/images/panorama1.jpg","description":"The cave you fear to enter holds the treasure you seek."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":true},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="CoCoNutNut's NoteBook" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                CoCoNutNut&#39;s NoteBook
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">TCP/IP复习</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">coconutnut</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2023-01-08 16:57:24
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Note/">Note</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>每一年前3题套路都是一样的，重点：</p>
<ol>
<li>IP地址&amp;路由（包的souce/dest、经过NAT/proxy的变化）</li>
<li>BGP（E-BGP和I-BGP，OSPF）</li>
<li>拥塞控制3种分配流量的方法</li>
</ol>
<p>第四题每年有些变化</p>
<h1 id="五层体系结构"><a href="#五层体系结构" class="headerlink" title="五层体系结构"></a>五层体系结构</h1><ul>
<li>application：HTTP、DNS</li>
<li>transport：TCP、IP</li>
<li>network：IP</li>
<li>link<ul>
<li>MAC：ARP</li>
</ul>
</li>
<li>physical</li>
</ul>
<h1 id="缩写和概念"><a href="#缩写和概念" class="headerlink" title="缩写和概念"></a>缩写和概念</h1><ul>
<li>DNS<ul>
<li>A/AAAA record：前者用于将域名映射到IPv4地址，后者IPv6<ul>
<li>如果有一个网站不知道用v4还是v6，可以用DNS，根据收到的record类型分辨</li>
</ul>
</li>
</ul>
</li>
<li>TCP<ul>
<li>MSS：Maximum Segment Size，指每个数据报所能携带的最大数据量</li>
<li>ECN：Explicit Congestion Notification，在数据包中添加特殊的标记，表示数据包可能会在传输过程中丢失，源端收到后，降低发送速率，从而减轻网络拥塞</li>
<li>TCP Cubic：less sensitive to RTT than Reno</li>
</ul>
</li>
<li>ARP：根据IP地址查询MAC地址<ul>
<li>Proxy ARP：主机A和B位于不同局域网（通常需要通过路由进行通信），可以用Proxy ARP设置路由器作为代理，接收ARP请求并返回虚拟的MAC地址</li>
</ul>
</li>
<li>路由<ul>
<li>IGP：Interior Gateway Protocol，AS内使用<ul>
<li>RIP：Routing Information Protocol，基于距离向量</li>
<li>OSPF：用Dijkstra计算最短路径</li>
</ul>
</li>
<li>EGP：Exterior Gateway Protocol，AS间使用<ul>
<li>BGP：Border Gateway Protocol</li>
</ul>
</li>
<li>距离向量路由算法<ul>
<li>route poisoning：当一个路由器发现某条路径不可用时，向相邻路由器发送带有较大距离的路由信息，表示该路径不可用</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h1><h2 id="6to4和NAT64"><a href="#6to4和NAT64" class="headerlink" title="6to4和NAT64"></a>6to4和NAT64</h2><p>6to4和NAT64都是用于在IPv6和IPv4之间建立连接的技术。区别：</p>
<ul>
<li>连接方式不同<ul>
<li>6to4：直接将IPv4地址转换为IPv6地址，并在前面添加一段特殊的前缀<code>2002::/16</code></li>
<li>NAT64：利用NAT表，在IPv4和IPv6之间建立地址映射关系</li>
</ul>
</li>
<li>连接方向不同<ul>
<li>6to4只能用于从IPv4到IPv6的连接</li>
<li>NAT64支持双向转换</li>
</ul>
</li>
</ul>
<h2 id="NAT64转发"><a href="#NAT64转发" class="headerlink" title="NAT64转发"></a>NAT64转发</h2><p>收到IPv6包后，转发给只支持IPv4的主机，步骤：</p>
<ol>
<li>检查NAT64转换表，看是否已经为该IPv6地址分配了IPv4地址</li>
<li>如果没有，分配地址，将该地址添加到表中，并使用该地址转发IPv4包给目标主机</li>
</ol>
<p>*不能用NAT64设备自己的IPv4地址</p>
<h2 id="Multicast"><a href="#Multicast" class="headerlink" title="Multicast"></a>Multicast</h2><p>当receiver想加入一个multicast  group，它需要发送MLD消息。其它receiver和server不需要任何操作。</p>
<h2 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h2><p>IPv4：主机/路由器都可以对数据报进行分片</p>
<p>IPv6：只有主机可以对数据报进行分片</p>
<p>但是，路由器不会重新组装数据报。这意味着，如果数据报在网络中被分片，则接收方必须自己重新组装数据报。</p>
<h1 id="OSPF"><a href="#OSPF" class="headerlink" title="OSPF"></a>OSPF</h1><p>Q：当有多条equal-cost最短路径时，会有什么负面影响？</p>
<p>A：所有用Dijkstra算法计算出的最短路径都会出现在路由表中。The router then does per-flow load balancing to ensure that packets of the same flow (e.g. same TCP connection) are sent to the same next hop. This is done to improve TCP performance by avoiding reordering of packets at the destination. It is typically achieved using hash functions on flow identifiers (source and destination IP’s and port numbers).</p>
<h1 id="套路"><a href="#套路" class="headerlink" title="套路"></a>套路</h1><h2 id="第一题：IP、路由"><a href="#第一题：IP、路由" class="headerlink" title="第一题：IP、路由"></a>第一题：IP、路由</h2><h2 id="IP-1"><a href="#IP-1" class="headerlink" title="IP"></a>IP</h2><p>分配地址、划分子网</p>
<h3 id="内网路由"><a href="#内网路由" class="headerlink" title="内网路由"></a>内网路由</h3><p>都是问IP source/dest，MAC source/dest，没什么变化</p>
<p>*只有过router才减少TTL/HC，bridge不减</p>
<p>*内网有loop时，要先用spanning tree algorithm</p>
<h3 id="NAT-proxy转发"><a href="#NAT-proxy转发" class="headerlink" title="NAT/proxy转发"></a>NAT/proxy转发</h3><p>（2018.1，2019.1）</p>
<p>A/B都用端口4567通过HTTP从服务器S下载文件，经过X</p>
<ol>
<li><p>当X是NAT</p>
<ul>
<li><p>A/B到X段观察（内网）</p>
<ul>
<li><p>A/B发送的包（仿佛没有X，直接发给S一样）</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>A/B</td>
<td>S</td>
<td>TCP</td>
<td>4567</td>
<td>80</td>
</tr>
</tbody></table>
</li>
<li><p>S发送的包（仿佛没有经过X，直接发给A/B一样）</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>S</td>
<td>A/B</td>
<td>TCP</td>
<td>80</td>
<td>4567</td>
</tr>
</tbody></table>
</li>
<li><p>X到S段观察（外网，NAT转换后）</p>
<ul>
<li><p>A/B发送的包</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>X</td>
<td>S</td>
<td>TCP</td>
<td>23456/23457</td>
<td>80</td>
</tr>
</tbody></table>
</li>
<li><p>S发送的包（先发给X，用X的IP，和不同的端口号）</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>S</td>
<td>X</td>
<td>TCP</td>
<td>80</td>
<td>23456/23457</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>​    实际上就是在NAT处做了一个地址映射，将A,4567换成X,23456，将B:4567换成X,23457</p>
<p>​    从A/B的视角，没有X，以为是直接和S通信</p>
<p>​    从S的视角，没有A/B</p>
<ol start="2">
<li><p>当X是application layer gateway, acting as web proxy</p>
<ul>
<li><p>A/B到X段观察（内网）</p>
<ul>
<li><p>A/B发送的包</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>A/B</td>
<td>X的内网IP</td>
<td>TCP</td>
<td>4678</td>
<td>8080</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
<li><p>X到S段观察（外网）</p>
<ul>
<li><p>A/B发送的包</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>X的外网IP</td>
<td>S</td>
<td>TCP</td>
<td>8923/8924</td>
<td>80</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>​    从A/B的视角，没有S（以为X就是S）</p>
<p>​    X收到A/B的请求后，从不同端口转发给S</p>
<p>​    从S的视角，没有A/B</p>
<h2 id="第二题：BGP-OSPF"><a href="#第二题：BGP-OSPF" class="headerlink" title="第二题：BGP/OSPF"></a>第二题：BGP/OSPF</h2><h2 id="第三题：拥塞控制"><a href="#第三题：拥塞控制" class="headerlink" title="第三题：拥塞控制"></a>第三题：拥塞控制</h2><p>max-min fairness</p>
<p>propotional fairness</p>
<pre><code>- 计算propotional fair的分配
- 判断分配是否propotional fair</code></pre><p>TCP with ECN</p>

        </div>

        

        
            <div class="article-nav">
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/07/30/obsedian/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Obsidian使用感受2</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">coconutnut</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E5%B1%82%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">五层体系结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%A9%E5%86%99%E5%92%8C%E6%A6%82%E5%BF%B5"><span class="nav-number">2.</span> <span class="nav-text">缩写和概念</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#IP"><span class="nav-number">3.</span> <span class="nav-text">IP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6to4%E5%92%8CNAT64"><span class="nav-number">3.1.</span> <span class="nav-text">6to4和NAT64</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NAT64%E8%BD%AC%E5%8F%91"><span class="nav-number">3.2.</span> <span class="nav-text">NAT64转发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Multicast"><span class="nav-number">3.3.</span> <span class="nav-text">Multicast</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E7%89%87"><span class="nav-number">3.4.</span> <span class="nav-text">分片</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#OSPF"><span class="nav-number">4.</span> <span class="nav-text">OSPF</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A5%97%E8%B7%AF"><span class="nav-number">5.</span> <span class="nav-text">套路</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%A2%98%EF%BC%9AIP%E3%80%81%E8%B7%AF%E7%94%B1"><span class="nav-number">5.1.</span> <span class="nav-text">第一题：IP、路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IP-1"><span class="nav-number">5.2.</span> <span class="nav-text">IP</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E7%BD%91%E8%B7%AF%E7%94%B1"><span class="nav-number">5.2.1.</span> <span class="nav-text">内网路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NAT-proxy%E8%BD%AC%E5%8F%91"><span class="nav-number">5.2.2.</span> <span class="nav-text">NAT&#x2F;proxy转发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%A2%98%EF%BC%9ABGP-OSPF"><span class="nav-number">5.3.</span> <span class="nav-text">第二题：BGP&#x2F;OSPF</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%A2%98%EF%BC%9A%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="nav-number">5.4.</span> <span class="nav-text">第三题：拥塞控制</span></a></li></ol></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
