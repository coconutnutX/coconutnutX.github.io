<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="coconutnut">
    
    <title>
        
            TCP/IP复习 |
        
        CoCoNutNut&#39;s NoteBook
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/avatar.png">
    
<link rel="stylesheet" href="/css/font-awesome.min.css">

    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"coconutnutx.github.io","root":"/","language":"en","path":"search.json"};
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"rgb(70,179,119)","avatar":"/images/avatar.jpg","favicon":"/images/avatar.png","article_img_align":"left","left_side_width":"260px","content_max_width":"920px","hover":{"shadow":false,"scale":false},"first_screen":{"enable":false,"background_img":"/images/panorama1.jpg","description":"The cave you fear to enter holds the treasure you seek."},"scroll":{"progress_bar":{"enable":false},"percent":{"enable":false}}},"local_search":{"enable":true,"preload":false},"code_copy":{"enable":true,"style":"default"},"pjax":{"enable":false},"lazyload":{"enable":true},"version":"3.4.3"};
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
  </script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="CoCoNutNut's NoteBook" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            <header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                CoCoNutNut&#39;s NoteBook
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                CATEGORIES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">TCP/IP复习</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">coconutnut</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-edit"></i>&nbsp;2023-01-08 16:57:24
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Note/">Note</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <p>每一年前3题套路基本是一样的，重点：</p>
<ol>
<li>IP地址&amp;路由（问请求的souce/dest、配置network box为NAT/proxy/VLAN switch后的变化）</li>
<li>BGP（E-BGP和I-BGP，OSPF）</li>
<li>拥塞控制3种分配流量的方法</li>
</ol>
<p>第四题每年有些变化，大部分有IPv6-IPv4 interworking、IP multicast相关内容</p>
<h1 id="五层体系结构"><a href="#五层体系结构" class="headerlink" title="五层体系结构"></a>五层体系结构</h1><ul>
<li>application：HTTP、DNS</li>
<li>transport：TCP、IP</li>
<li>network：IP</li>
<li>link<ul>
<li>MAC：ARP</li>
</ul>
</li>
<li>physical</li>
</ul>
<h1 id="缩写和概念"><a href="#缩写和概念" class="headerlink" title="缩写和概念"></a>缩写和概念</h1><ul>
<li>DNS<ul>
<li>A/AAAA record：前者用于将域名映射到IPv4地址，后者IPv6<ul>
<li>如果有一个网站不知道用v4还是v6，可以用DNS，根据收到的record类型分辨</li>
</ul>
</li>
</ul>
</li>
<li>TCP<ul>
<li>MSS：Maximum Segment Size，指每个数据报所能携带的最大数据量</li>
<li>ECN：Explicit Congestion Notification，在数据包中添加特殊的标记，表示数据包可能会在传输过程中丢失，源端收到后，降低发送速率，从而减轻网络拥塞</li>
</ul>
</li>
<li>IP<ul>
<li>address prefix delegation through DHCPv6：在 IPv6 网络中，地址分配由 DHCPv6 服务器完成。当一个客户端连接到网络时，它会发送一个 Solicit 消息给 DHCPv6 服务器，请求获取一个地址前缀。如果 DHCPv6 服务器认为该请求是合法的，它会向该客户端发送一个 Advertise 消息，提供一个地址前缀。客户端收到的地址前缀可以用于分配其他地址。</li>
</ul>
</li>
<li>ARP：根据IP地址查询MAC地址<ul>
<li>Proxy ARP：主机A和B位于不同局域网（通常需要通过路由进行通信），可以用Proxy ARP设置路由器作为代理，接收ARP请求并返回虚拟的MAC地址</li>
</ul>
</li>
<li>路由<ul>
<li>IGP：Interior Gateway Protocol，AS内使用<ul>
<li>RIP：Routing Information Protocol，基于距离向量</li>
<li>OSPF：用Dijkstra计算最短路径</li>
</ul>
</li>
<li>EGP：Exterior Gateway Protocol，AS间使用<ul>
<li>BGP：Border Gateway Protocol</li>
</ul>
</li>
<li>距离向量路由算法<ul>
<li>route poisoning：当一个路由器发现某条路径不可用时，向相邻路由器发送带有较大距离的路由信息，表示该路径不可用</li>
</ul>
</li>
</ul>
</li>
<li>Stub network：指一种特殊类型的路由器，它只有一条出边（或者说只连向一个直接的邻居）。在这样的网络中，所有的数据包都会通过默认网关转发，而不是进行多跳转发</li>
</ul>
<h1 id="套路"><a href="#套路" class="headerlink" title="套路"></a>套路</h1><h2 id="第一题：IP、路由"><a href="#第一题：IP、路由" class="headerlink" title="第一题：IP、路由"></a>第一题：IP、路由</h2><h3 id="subnet-mask"><a href="#subnet-mask" class="headerlink" title="subnet mask"></a>subnet mask</h3><ul>
<li><p>不能太长：保证同一LAN内前缀相同</p>
</li>
<li><p>不能太短：避免不同LAN内前缀相同</p>
<ul>
<li>不同LAN前缀相同的问题：The hosts will think that other hosts are on the same LAN, and will try using ARP to get their MAC addresses. To solve this, one solution is to use proxy ARP in all routers X1, X2, X3, X4 .</li>
</ul>
</li>
<li><p>不同LAN中，长度可以不同</p>
</li>
</ul>
<h3 id="ping-request-ARP"><a href="#ping-request-ARP" class="headerlink" title="ping request/ARP"></a>ping request/ARP</h3><ul>
<li><p>ping的过程</p>
<ol>
<li><p>查询本地路由表，看ping的是内网还是外网地址</p>
</li>
<li><p>如果是内网地址</p>
<ol>
<li><p>查询ARP缓存，如果有，直接返回ICMP reply</p>
</li>
<li><p>如果缓存没有，用ARP协议在LAN内广播，要求拥有指定IP地址的主机回复自己的MAC地址</p>
<ul>
<li><p>ARP的可见范围是LAN内</p>
</li>
<li><p>如果收到，加入ARP缓存，返回ICMP reply</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p>如果是外网地址</p>
<ol>
<li><p>ARP请求的IP目的地址是路由器的IP地址</p>
</li>
<li><p>路由器转发请求到外网</p>
<ul>
<li>路由器可能再次用ARP协议，查找目标主机的MAC地址</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li><p>注意network boxs的配置，是bridge还是router</p>
<ul>
<li>只有过router才减少TTL/HC，bridge不减（易错：host和router相连的一段没注意，直接填了64）</li>
<li>如果是bridge<ul>
<li>注意内网有没有环，如果有，要先用spanning tree algorithm，禁用部分链接</li>
<li>内网可以经过多个bridge，直接发给目标MAC地址（易错：把bridge看成router，填了bridge的MAC）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="request经过NAT-proxy-VLAN-switch的变化"><a href="#request经过NAT-proxy-VLAN-switch的变化" class="headerlink" title="request经过NAT/proxy/VLAN switch的变化"></a>request经过NAT/proxy/VLAN switch的变化</h3><ul>
<li><p>NAT：建立{内网IP和端口，外网IP和端口}的对应</p>
<ul>
<li>内网向外发请求时，正常用自己的地址，像没有NAT一样</li>
<li>外网向内发请求时，用NAT翻译后的地址，像内网的主机不存在一样<ul>
<li>外网的C想ping内网的A，直接ping翻译后的地址即可</li>
</ul>
</li>
<li>TCP，丢包，source负责重发，NAT不负责</li>
</ul>
</li>
<li><p>application layer gateway, acting as web proxy</p>
<ul>
<li>host向server发请求时，发给proxy，像server不存在一样</li>
<li>server像host发请求时，发给proxy，像host不存在一样</li>
<li>proxy转发host的请求时，不同的host用不同的端口</li>
</ul>
</li>
<li><p>VLAN switch：将原本相连的网络分成不同的VLAN，通信必须经过路由器</p>
<ul>
<li>如果2个VLAN链接到同一个路由，可以：configure the Y1 interface of the router with two different IP addresses, each belonging to a different VLAN</li>
</ul>
</li>
<li><p>题目中有ping request和HTTP两种，地址变化都一样</p>
<ul>
<li>HTTP的protocol是TCP</li>
<li>HTTP over QUIC则protocol是UDP</li>
</ul>
</li>
</ul>
<p>🌰 A/B都用端口4567通过HTTP从服务器S下载文件，经过X</p>
<ol>
<li><p>当X是NAT</p>
<ul>
<li><p>A/B到X段观察（内网）</p>
<ul>
<li><p>A/B发送的包（仿佛没有X，直接发给S一样）</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>A/B</td>
<td>S</td>
<td>TCP</td>
<td>4567</td>
<td>80</td>
</tr>
</tbody></table>
</li>
<li><p>S发送的包（仿佛没有经过X，直接发给A/B一样）</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>S</td>
<td>A/B</td>
<td>TCP</td>
<td>80</td>
<td>4567</td>
</tr>
</tbody></table>
</li>
<li><p>X到S段观察（外网，NAT转换后）</p>
<ul>
<li><p>A/B发送的包</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>X</td>
<td>S</td>
<td>TCP</td>
<td>23456/23457</td>
<td>80</td>
</tr>
</tbody></table>
</li>
<li><p>S发送的包（先发给X，用X的IP，和不同的端口号）</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>S</td>
<td>X</td>
<td>TCP</td>
<td>80</td>
<td>23456/23457</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>​    实际上就是在NAT处做了一个地址映射，将A,4567换成X,23456，将B:4567换成X,23457</p>
<p>​    从A/B的视角，没有X，以为是直接和S通信</p>
<p>​    从S的视角，没有A/B</p>
<ol start="2">
<li><p>当X是application layer gateway, acting as web proxy</p>
<ul>
<li><p>A/B到X段观察</p>
<ul>
<li><p>A/B发送的包</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>A/B</td>
<td>X的内网IP</td>
<td>TCP</td>
<td>4678</td>
<td>8080</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
<li><p>X到S段观察</p>
<ul>
<li><p>A/B发送的包</p>
<table>
<thead>
<tr>
<th>IP source</th>
<th>IP dest</th>
<th>protocol</th>
<th>source port</th>
<th>dest port</th>
</tr>
</thead>
<tbody><tr>
<td>X的外网IP</td>
<td>S</td>
<td>TCP</td>
<td>8923/8924</td>
<td>80</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>​    从A/B的视角，没有S（以为X就是S）</p>
<p>​    X收到A/B的请求后，从不同端口转发给S</p>
<p>​    从S的视角，没有A/B</p>
<h3 id="路由表配置"><a href="#路由表配置" class="headerlink" title="路由表配置"></a>路由表配置</h3><p>路由器的routing table需要的几列：</p>
<table>
<thead>
<tr>
<th>Destination Network</th>
<th>Interface</th>
<th>Gateway</th>
</tr>
</thead>
<tbody><tr>
<td>10.1/16</td>
<td>Xw VLAN A</td>
<td>onlink</td>
</tr>
<tr>
<td>10.2/16</td>
<td>Xw VLAN B</td>
<td>onlink</td>
</tr>
<tr>
<td>9/8</td>
<td>Xe</td>
<td>onlink</td>
</tr>
</tbody></table>
<ul>
<li><p>Interface是该路由器的网络接口</p>
<ul>
<li>通常以eth0、eth1、eth2等命名，表示网卡的编号</li>
</ul>
</li>
<li><p>如果需要其它路由器转发，gateway填其它路由器的IP</p>
</li>
</ul>
<h2 id="第二题：BGP-OSPF"><a href="#第二题：BGP-OSPF" class="headerlink" title="第二题：BGP/OSPF"></a>第二题：BGP/OSPF</h2><p>注意：BGP next hop是AS外部的地址，不一定直接连接，而OSPF next hop是相邻的地址</p>
<p>注意：题目给定的OSPF cost是一个常数，还是cost to BGP next hop加一个常数</p>
<h3 id="Adj-RIB-in-out"><a href="#Adj-RIB-in-out" class="headerlink" title="Adj-RIB-in/out"></a>Adj-RIB-in/out</h3><p>当运行BGP的路由器收到更新时，会更新这两个表</p>
<p>Adj-RIB-in的列：</p>
<table>
<thead>
<tr>
<th></th>
<th>Destination network</th>
<th>AS path</th>
<th>Next hop</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>from C1</td>
<td>66.66/16</td>
<td>C E F</td>
<td>30.20.0.3</td>
<td>best</td>
</tr>
<tr>
<td>from C1</td>
<td>66.66.0/17</td>
<td>C E F</td>
<td>30.20.0.3</td>
<td>best</td>
</tr>
</tbody></table>
<p>Adj-RIB-out包含best的几行</p>
<p>*如果上面的路由B1转发给另一个路由B2，next hop不变，仍是AS外的地址</p>
<p>*out只转发通过E-BGP得到的路径（不转发I-GBP得到的）</p>
<h3 id="BGP"><a href="#BGP" class="headerlink" title="BGP"></a>BGP</h3><p>BGP如何选择最优路线的Decision process，几项常用的（详见Exam booklet）：</p>
<ol>
<li>Shortest AS-PATH</li>
<li>E-BGP&gt;I-BGP</li>
<li>Shortest path to NEXT-HOP, according to IGP</li>
<li>Lowest BGP identifier</li>
</ol>
<p>Q：假设一个AS中只有部分路由器运行BGP，它们不re-distribute BGP into the interior routing protocol，如何让其他路由器也能知道外部的路径？</p>
<p>A：方法一：By configuring default gateway on all other routers. Drawback: Can not cope with link-failures. 方法二：By running BGP on all routers. Drawback: Expensive</p>
<h3 id="Distance-vector-routing"><a href="#Distance-vector-routing" class="headerlink" title="Distance vector routing"></a>Distance vector routing</h3><p>🌰 关于更新</p>
<p>假设有连接A-B-net1-C-net2，原本cost都是1</p>
<p>原本A的路由表中有：</p>
<table>
<thead>
<tr>
<th>Destination network</th>
<th>Next hop</th>
<th>Distance</th>
</tr>
</thead>
<tbody><tr>
<td>net1</td>
<td>IP of B</td>
<td>2</td>
</tr>
<tr>
<td>net2</td>
<td>IP of B</td>
<td>3</td>
</tr>
</tbody></table>
<p>此时B告诉A：B到直接相连的net1的cost变成了6，A的路由表变成：</p>
<table>
<thead>
<tr>
<th>Destination network</th>
<th>Next hop</th>
<th>Distance</th>
</tr>
</thead>
<tbody><tr>
<td>net1</td>
<td>IP of B</td>
<td>7</td>
</tr>
<tr>
<td>net2</td>
<td>IP of B</td>
<td>3</td>
</tr>
</tbody></table>
<p>由于routing protocol还没有converge，其它暂时不变</p>
<h3 id="OSPF"><a href="#OSPF" class="headerlink" title="OSPF"></a>OSPF</h3><p>在某一节点，对某一目的地，BGP会根据Decision process选出最优路径，但OSPF可能会算出多条equal-cost的路径</p>
<p>如果有大量packet发到该目的地，一般选择每条路径的可能性相同</p>
<p>Q：当有多条equal-cost最短路径时，会有什么负面影响？</p>
<p>A：所有用Dijkstra算法计算出的最短路径都会出现在路由表中。The router then does per-flow load balancing to ensure that packets of the same flow (e.g. same TCP connection) are sent to the same next hop. This is done to improve TCP performance by avoiding reordering of packets at the destination. It is typically achieved using hash functions on flow identifiers (source and destination IP’s and port numbers).</p>
<p>🌰 关于获得路径的过程</p>
<p>假设有3个area：</p>
<ul>
<li>Area 1：A，B1</li>
<li>Area 2：B1，B2</li>
<li>Area 3：B2，C</li>
</ul>
<p>C如何获得到A的路径？</p>
<p>过程：</p>
<ol>
<li>B1在area 1内用Dijkstra计算到A的最短路径，然后inject the route into area 2</li>
<li>B2在area 2内用Dijkstra计算到A的最短路径，然后inject the route into area 3</li>
<li>C在area 3内用Dijkstra计算到A的最短路径</li>
</ol>
<h2 id="第三题：拥塞控制"><a href="#第三题：拥塞控制" class="headerlink" title="第三题：拥塞控制"></a>第三题：拥塞控制</h2><h3 id="max-min-fairness"><a href="#max-min-fairness" class="headerlink" title="max-min fairness"></a>max-min fairness</h3><p>计算方法：water-filling</p>
<ol>
<li>mark all sources as non frozen</li>
<li>Do<ul>
<li>increase the rate of all non frozen sources to the largest possible common value</li>
<li>mark sources that use a saturated link as frozen</li>
</ul>
</li>
<li>Until all sources are frozen</li>
</ol>
<h3 id="propotional-fairness"><a href="#propotional-fairness" class="headerlink" title="propotional fairness"></a>propotional fairness</h3><p>计算方法<br>$$<br>J(x) = \sum_i{ logx_i }<br>$$</p>
<p>判断分配是否propotional fair：如果改变分配，变化率符合↓，则符合propotional fairness<br>$$<br>\sum_i\frac{\Delta x_i}{x_i}\le0<br>$$</p>
<h3 id="TCP-with-ECN"><a href="#TCP-with-ECN" class="headerlink" title="TCP with ECN"></a>TCP with ECN</h3><p>rate和RTT成反比</p>
<p>TCP Cubic：less sensitive to RTT than Reno</p>
<h3 id="TCP-Loss-Throughput-Formula"><a href="#TCP-Loss-Throughput-Formula" class="headerlink" title="TCP Loss - Throughput Formula"></a>TCP Loss - Throughput Formula</h3><p>$$<br>𝜃 = \frac{MSS*1.22}{RTT\sqrt{q}}<br>$$</p>
<p>其中𝜃是throughput，a fraction <em>q</em> of packets is lost，MSS和RTT题目会给</p>
<p>一般是前一问已经算出𝜃，问q</p>
<p>注意单位，s和bit，1 MB=10^6 bit</p>
<h2 id="第四题：IPv4和IPv6"><a href="#第四题：IPv4和IPv6" class="headerlink" title="第四题：IPv4和IPv6"></a>第四题：IPv4和IPv6</h2><h3 id="6to4"><a href="#6to4" class="headerlink" title="6to4"></a>6to4</h3><p>IPv6保留地址块<code>2002::/16</code></p>
<p>IPv4保留地址块<code>192.88.99/24</code>（6to4 relay routers）</p>
<p>🌰 <code>3.3.3.3</code>-&gt;<code>2002:0303:0303::</code>，default gateway <code>192.88.99.1</code>-&gt;<code>2002:c058:6301::</code></p>
<h3 id="NAT64"><a href="#NAT64" class="headerlink" title="NAT64"></a>NAT64</h3><p>收到IPv6包后，转发给只支持IPv4的主机，步骤：</p>
<ol>
<li>检查NAT64转换表，看是否已经为该IPv6地址分配了IPv4地址</li>
<li>如果没有，分配地址，将该地址添加到表中，并使用该地址转发IPv4包给目标主机</li>
</ol>
<p>*不能用NAT64设备自己的IPv4地址</p>
<h3 id="IP-multicast"><a href="#IP-multicast" class="headerlink" title="IP multicast"></a>IP multicast</h3><p>当receiver想加入一个multicast  group，它需要发送MLD(Multicast Listener Discovery)消息。其它receiver和server不需要任何操作。</p>
<p>（还看到一种答案是start a program that listens to the multicast group）</p>
<p>multicast MAC 地址：</p>
<ul>
<li>IPv4：01-00-5e-XX-XX-XX（后23bit）</li>
<li>IPv6：33-33-XX-XX-XX-XX（后32bit）<ul>
<li>🌰 <code>ff35::6:7</code> -&gt; <code>33-33-00-06-00-07</code></li>
</ul>
</li>
</ul>
<h3 id="分片"><a href="#分片" class="headerlink" title="分片"></a>分片</h3><p>IPv4：主机/路由器都可以对数据报进行分片</p>
<p>IPv6：只有主机可以对数据报进行分片</p>
<p>但是，路由器不会重新组装数据报。这意味着，如果数据报在网络中被分片，则接收方必须自己重新组装数据报。</p>
<h1 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h1><p>一些错题的知识点</p>
<p><strong>Protocol type</strong></p>
<p>in IP header: TCP/UDP</p>
<p>in Ethernet header: IPv4/IPv6/ARP</p>
<p><strong>6to4</strong></p>
<p>A的IPv4地址：3.3.3.3，则：</p>
<p>A的6to4 IPv6地址：<code>2002:0303:0303:abcd:EUI_A</code></p>
<p>A的6to4 default gateway’s IPv6地址：2002:c058:6301::（IPv4默认网关192.88.99/24）</p>
<p><strong>BGP</strong></p>
<p>R1-B1-B4 R1-B2-B3都跑BGP</p>
<p>R1 peers with all BGP routers inside AS B</p>
<p>B4、B3的路线直接I-BGP发给R1，而不是通过B1、B2（不转发I-BGP学到的路径），所以在R1的表里，路径是来自BGP peer B4、B3的</p>
<p><strong>ARP</strong></p>
<p>The first ARP packet is broadcast and is sent to all bridges along the tree（MAC dest <code>ff-ff-ff-ff-ff-ff</code>）</p>
<p>The ARP reply is unicast from dest to source</p>

        </div>

        

        
            <div class="article-nav">
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2022/07/30/obsedian/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Obsidian使用感受2</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span>&nbsp;-&nbsp;
            
            2023&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">coconutnut</a>
        </div>
        
            <script async  src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.3</a>
        </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    
        <aside class="page-aside">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E5%B1%82%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">五层体系结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BC%A9%E5%86%99%E5%92%8C%E6%A6%82%E5%BF%B5"><span class="nav-number">2.</span> <span class="nav-text">缩写和概念</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A5%97%E8%B7%AF"><span class="nav-number">3.</span> <span class="nav-text">套路</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E9%A2%98%EF%BC%9AIP%E3%80%81%E8%B7%AF%E7%94%B1"><span class="nav-number">3.1.</span> <span class="nav-text">第一题：IP、路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#subnet-mask"><span class="nav-number">3.1.1.</span> <span class="nav-text">subnet mask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ping-request-ARP"><span class="nav-number">3.1.2.</span> <span class="nav-text">ping request&#x2F;ARP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#request%E7%BB%8F%E8%BF%87NAT-proxy-VLAN-switch%E7%9A%84%E5%8F%98%E5%8C%96"><span class="nav-number">3.1.3.</span> <span class="nav-text">request经过NAT&#x2F;proxy&#x2F;VLAN switch的变化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E8%A1%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.4.</span> <span class="nav-text">路由表配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E9%A2%98%EF%BC%9ABGP-OSPF"><span class="nav-number">3.2.</span> <span class="nav-text">第二题：BGP&#x2F;OSPF</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Adj-RIB-in-out"><span class="nav-number">3.2.1.</span> <span class="nav-text">Adj-RIB-in&#x2F;out</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BGP"><span class="nav-number">3.2.2.</span> <span class="nav-text">BGP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Distance-vector-routing"><span class="nav-number">3.2.3.</span> <span class="nav-text">Distance vector routing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OSPF"><span class="nav-number">3.2.4.</span> <span class="nav-text">OSPF</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E9%A2%98%EF%BC%9A%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="nav-number">3.3.</span> <span class="nav-text">第三题：拥塞控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#max-min-fairness"><span class="nav-number">3.3.1.</span> <span class="nav-text">max-min fairness</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#propotional-fairness"><span class="nav-number">3.3.2.</span> <span class="nav-text">propotional fairness</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-with-ECN"><span class="nav-number">3.3.3.</span> <span class="nav-text">TCP with ECN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-Loss-Throughput-Formula"><span class="nav-number">3.3.4.</span> <span class="nav-text">TCP Loss - Throughput Formula</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%AC%E5%9B%9B%E9%A2%98%EF%BC%9AIPv4%E5%92%8CIPv6"><span class="nav-number">3.4.</span> <span class="nav-text">第四题：IPv4和IPv6</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6to4"><span class="nav-number">3.4.1.</span> <span class="nav-text">6to4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NAT64"><span class="nav-number">3.4.2.</span> <span class="nav-text">NAT64</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IP-multicast"><span class="nav-number">3.4.3.</span> <span class="nav-text">IP multicast</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%89%87"><span class="nav-number">3.4.4.</span> <span class="nav-text">分片</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%A1%A5%E5%85%85"><span class="nav-number">4.</span> <span class="nav-text">补充</span></a></li></ol>
    </div>
</div>
        </aside>
    

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>



    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-copy.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts">
    
        
<script src="/js/left-side-toggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/toc.js"></script>

    
</div>



</body>
</html>
