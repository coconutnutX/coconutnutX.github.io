<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CoCoNutNut&#39;s NoteBook</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://coconutnutx.github.io/"/>
  <updated>2022-01-14T16:26:21.000Z</updated>
  <id>https://coconutnutx.github.io/</id>
  
  <author>
    <name>coconutnut</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Snapshotæ€»ç»“</title>
    <link href="https://coconutnutx.github.io/2022/01/14/snapshot/"/>
    <id>https://coconutnutx.github.io/2022/01/14/snapshot/</id>
    <published>2022-01-14T16:26:21.000Z</published>
    <updated>2022-01-14T16:26:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>é‡ç‚¹ï¼šå…³äºå®ç°Wait-free Atomic Snapshotæ—¶ï¼Œä¸ºä»€ä¹ˆè¦åˆ¤æ–­2æ¬¡/næ¬¡æ›´æ–°</p><p>ç›¸å…³slides: The Power of Registers, Computing with anonymous processes</p><h1 id="å®ç°Snapshot"><a href="#å®ç°Snapshot" class="headerlink" title="å®ç°Snapshot"></a>å®ç°Snapshot</h1><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2022/screencapture2022-01-14 PM5.34.04.jpg"                                     ><p>å½“æ— åŒæ­¥æ›´æ–°æ—¶ï¼Œscanè¿”å›çš„æ˜¯å½“å‰æ‰€æœ‰å¯„å­˜å™¨ä¸­çš„å€¼</p><p>å½“æœ‰åŒæ­¥æ›´æ–°æ—¶ï¼Œè¿”å›çš„æ˜¯last written valueæˆ–concurrent update value</p><p>ç±»ä¼¼äºregular</p><h1 id="å®ç°Atomic"><a href="#å®ç°Atomic" class="headerlink" title="å®ç°Atomic"></a>å®ç°Atomic</h1><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2022/screencapture2022-01-14 PM5.32.39.jpg"                                     ><p>æ€è·¯ï¼šé€šè¿‡ä¸¤ä¸ªç›¸åŒçš„collectï¼Œç¡®ä¿è¿™ä¸¤æ¬¡æ“ä½œæœŸé—´æ²¡æœ‰æ›´æ–°ï¼Œä»è€Œæ‰¾åˆ°ä¸€ä¸ªlinearization point</p><p>æ³¨æ„ï¼šâ€œç›¸åŒçš„collectâ€ä¸ä»…æŒ‡å€¼ç›¸åŒï¼Œè¿˜éœ€è¦timestampç›¸åŒï¼Œå¦åˆ™åä¾‹è§<a href="https://coconutnutx.github.io/2022/01/12/snapshot/">Snapshotçš„timestamp</a></p><h1 id="å®ç°Wait-free"><a href="#å®ç°Wait-free" class="headerlink" title="å®ç°Wait-free"></a>å®ç°Wait-free</h1><p>ä¸Šé¢çš„ç®—æ³•ä¸æ˜¯wait-freeï¼Œå› ä¸ºå½“æœ‰å¤šä¸ªè¿›ç¨‹åŒæ­¥è°ƒç”¨scanæ—¶ï¼Œå¯èƒ½å‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼š</p><ul><li>p1ç‰¹åˆ«å¿«ï¼Œä¸åœåœ°æ›´æ–°</li><li>p2å¾ˆæ…¢ï¼Œæƒ³è¦scanï¼Œä½†æ¯æ¬¡ç”±äºp1çš„æ›´æ–°ï¼Œtemp1æ€»ä¸ç­‰äºtemp2ï¼Œæ— æ³•è¿”å›</li></ul><p>è§£å†³æ€è·¯é€šå¸¸æ˜¯ï¼Œè®©å¿«çš„è¿›ç¨‹å¤šåšç‚¹äº‹ã€‚è¿™é‡Œå¦‚æœè®©p1æ¯æ¬¡æ›´æ–°æ—¶ï¼Œè¿˜è¦scanï¼Œé‚£ä¹ˆp2å³ä½¿è‡ªå·±æ— æ³•å®Œæˆscanï¼Œä½†å¯ä»¥ç›´æ¥æŠ„p1 scançš„ç»“æœï¼Œå°±æœ‰æœºä¼šè¿”å›ï¼Œä»è€Œè¾¾åˆ°æ•´ä½“çš„wait-freeã€‚å…·ä½“ç®—æ³•å¦‚ä¸‹ï¼š</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2022/screencapture2022-01-14 PM5.43.28.jpg"                                     ><p>è¿™é‡Œ if( t3=t2 ) æ¯”è¾ƒçš„æ˜¯è‡ªå·±è¿™æ¬¡å’Œä¸Šæ¬¡çš„ç»“æœï¼Œå¦‚æœä¸€æ ·ï¼Œå¯ä»¥è¿”å›</p><p>è€Œ if( t3[j,2] â‰¥ t1[j,2]+2 ) æ¯”è¾ƒçš„æ˜¯å…¶å®ƒè¿›ç¨‹ï¼Œå®ƒè¿™æ¬¡çš„ç»“æœæœ‰æ²¡æœ‰æ¯”ç¬¬ä¸€æ¬¡æ–°ï¼Ÿå¦‚æœæ˜¯ï¼Œåˆ™è¯´æ˜è¿™ä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´æœ‰è¿‡ä¸€æ¬¡å®Œæ•´çš„scanï¼Œå¯ä»¥æŠ„è¿‡æ¥ç›´æ¥ç”¨</p><h2 id="ä¸ºä»€ä¹ˆâ‰¥2ï¼ˆä¸€ä¸ªåä¾‹ï¼‰"><a href="#ä¸ºä»€ä¹ˆâ‰¥2ï¼ˆä¸€ä¸ªåä¾‹ï¼‰" class="headerlink" title="ä¸ºä»€ä¹ˆâ‰¥2ï¼ˆä¸€ä¸ªåä¾‹ï¼‰"></a>ä¸ºä»€ä¹ˆâ‰¥2ï¼ˆä¸€ä¸ªåä¾‹ï¼‰</h2><p>å¦‚æœå°†( t3[j,2] â‰¥ t1[j,2]+2 )å˜æˆ( t3[j,2] â‰¥ t1[j,2]+1 )ï¼Œæ— æ³•ä¿è¯ä¸€æ¬¡å®Œæ•´çš„scanï¼Œå¯èƒ½å‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼š</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2022/IMG_FA11786ABCC8-1.jpeg"                                     ><p>å³ï¼Œè™½ç„¶æœ‰ä¸€æ¬¡æ›´æ–°ï¼Œä½†è¿™ä¸ªæ›´æ–°å¯èƒ½å¼€å§‹äºå¾ˆä¹…å¾ˆä¹…ä»¥å‰ã€‚å¦‚æœæ˜¯â‰¥2ï¼Œåˆ™å¯ä»¥é¿å…ã€‚</p><h1 id="å®ç°Anonymous"><a href="#å®ç°Anonymous" class="headerlink" title="å®ç°Anonymous"></a>å®ç°Anonymous</h1><p>å‡ ä¸ªä¸åŒï¼š</p><ul><li>ä¸Šé¢æ˜¯ä¸€ä¸ªprocesså¯¹åº”ä¸€ä¸ªRegï¼ˆå¦‚process1åªä¼šæ›´æ–°Reg1ï¼‰ï¼›è¿™é‡Œä¸å¿…ä¸€ä¸€å¯¹åº”ï¼Œä»è€Œä¿è¯anonymous</li><li>ä¸Šé¢æ¯ä¸ªprocessæœ‰è‡ªå·±çš„local timestampï¼Œæ¯æ¬¡åŠ 1ï¼›è¿™é‡Œç”¨ä¸€ä¸ªå…±äº«çš„weak counter</li></ul><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2022/screencapture2022-01-14 PM6.36.08.jpg"                                     ><p>ï¼ˆè¿™é‡Œå†™çš„æ˜¯n+1ï¼Œåæ¥TAè¯´å…¶å®nå°±å¤Ÿäº†ï¼‰</p><h2 id="ä¸ºä»€ä¹ˆnï¼ˆä¸€ä¸ªåä¾‹ï¼‰"><a href="#ä¸ºä»€ä¹ˆnï¼ˆä¸€ä¸ªåä¾‹ï¼‰" class="headerlink" title="ä¸ºä»€ä¹ˆnï¼ˆä¸€ä¸ªåä¾‹ï¼‰"></a>ä¸ºä»€ä¹ˆnï¼ˆä¸€ä¸ªåä¾‹ï¼‰</h2><p>ï¼ˆfrom last exercise sessionï¼‰</p><p>å¦‚æœ2ä¸ªç›¸åŒçš„collectå°±è¿”å›ï¼Œå‡è®¾ï¼š</p><ul><li><p>Nä¸ªprocessåŒæ—¶å¼€å§‹ï¼Œéƒ½æ‹¿åˆ°äº†ç›¸åŒçš„timestamp t1</p></li><li><p>process Næƒ³è¦scan</p></li><li><p>process 1 ~ N-1æƒ³è¦updateï¼ˆåœ¨writeä¹‹å‰ï¼Œéƒ½è¿›è¡Œäº†scanï¼Œè®°ä¸ºs1ã€‚s1=s0ï¼‰</p></li></ul><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2022/IMG_B1316757EE80-1.jpeg"                                     ><ul><li>PNä¸¤æ¬¡æ‰«æå¾—åˆ°äº†ç›¸åŒçš„[0,1]ï¼Œä¼šè¿”å›è¿™ä¸ªå€¼</li><li>ä½†æ˜¯è§‚å¯Ÿæ•´ä¸ªè¿‡ç¨‹ä¸­Xå’ŒYä½ç½®çš„å€¼ï¼Œä»æ¥æ²¡æœ‰å‡ºç°è¿‡[0,1]ã€‚è¿™ä¸ªscanæ— æ³•linearizeåˆ°ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œè¿èƒŒAtomic</li><li>å¦‚æœç­‰Næ¬¡ç›¸åŒçš„æ›´æ–°ï¼Œå¯ä»¥é¿å…è¯¥é—®é¢˜ï¼ˆå› ä¸ºå…¶å®ƒN-1ä¸ªprocessç›¸åŒçš„timestampå·²ç»ç”¨å®Œäº†ï¼‰</li></ul><h1 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h1><p><strong>éAnonymousæƒ…å†µï¼š</strong></p><ol><li><p>processå’ŒRegä¸€ä¸€å¯¹åº”</p></li><li><p>éweak counterï¼Œæ¯æ¬¡æ“ä½œéƒ½æœ‰å”¯ä¸€çš„timestamp</p></li><li><p>åˆ¤æ–­è‡ªå·±çš„collectæ˜¯å¦å¯ä»¥è¿”å› (è¿ç»­2æ¬¡collectç›¸åŒ)</p><ul><li><p>è¿ç»­2æ¬¡collectï¼Œæ‰€æœ‰å€¼ç›¸åŒï¼Œæ‰€æœ‰timestampç›¸åŒ</p></li><li><p>å³å¯ä¿è¯è¿™ä¸¤æ¬¡collectä¹‹é—´æœ‰ä¸€æ¬¡å®Œæ•´çš„scan</p></li></ul></li><li><p>åˆ¤æ–­èƒ½å¦æŠ„åˆ«äººçš„scan (æŸäººçš„ts â‰¥ è‡ªå·±å¼€å§‹æ—¶çš„ts+2)</p><ul><li>tsæ˜¯æ¯ä¸ªprocessæœ¬åœ°çš„ï¼Œè‡³å°‘2æ‰èƒ½ä¿è¯æ²¡æœ‰â€œç¡äº†å¾ˆä¹…åˆšé†’â€çš„æƒ…å†µ</li></ul></li></ol><p><strong>Anonymousæƒ…å†µï¼š</strong></p><ol><li><p>processå’ŒRegå¹¶éä¸€ä¸€å¯¹åº”ï¼Œä¸€ä¸ªRegå¯èƒ½åŒæ—¶è¢«Nä¸ªprocessæ›´æ–°</p></li><li><p>weak counterï¼ŒNä¸ªprocesså¯èƒ½åŒæ—¶è·å¾—ç›¸åŒçš„timestamp</p></li><li><p>åˆ¤æ–­è‡ªå·±çš„collectæ˜¯å¦å¯ä»¥è¿”å› (è¿ç»­næ¬¡collectç›¸åŒ)</p><ul><li><p>è¿ç»­næ¬¡collectï¼Œæ‰€æœ‰å€¼ç›¸åŒï¼Œæ‰€æœ‰timestampç›¸åŒ</p></li><li><p>ä¸ºä»€ä¹ˆæ˜¯nï¼Ÿæé™æƒ…å†µï¼š</p><ul><li>æ‰€æœ‰Nä¸ªprocessæ‹¿åˆ°äº†ç›¸åŒçš„timestampï¼Œå†™ç›¸åŒå€¼ï¼Œå†™åˆ°åŒä¸€ä¸ªRegä¸­</li><li>é™¤è‡ªå·±ä»¥å¤–ï¼Œæœ€å¤šå¯èƒ½æœ‰N-1ä¸ªä¸€æ¨¡ä¸€æ ·çš„æ›´æ–°</li><li>ä½†å¦‚æœè¯»åˆ°äº†Nä¸ªç›¸åŒçš„ç»“æœï¼Œè¯´æ˜å‰©ä½™N-1ä¸ªprocessä¸­ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªæ›´æ–°äº†ä¸¤æ¬¡ã€‚è¿™ä¸¤æ¬¡ä¹‹é—´æ˜¯ä¸€ä¸ªå®Œæ•´çš„scan</li></ul></li><li><p>What Ifâ€¦?</p><ul><li>æŠŠWeak counteræ”¹æˆStrong counterï¼Œä¸ä¼šæ‹¿åˆ°ç›¸åŒçš„timestamp -&gt; 2æ¬¡è¿ç»­collectç›¸åŒå³å¯</li><li>ä»æ˜¯Weak counterï¼Œä½†æœ€å¤š10ä¸ªprocessæ‹¿åˆ°ç›¸åŒçš„timestamp -&gt; 10æ¬¡è¿ç»­collectç›¸åŒå³å¯</li></ul></li></ul></li><li><p>åˆ¤æ–­èƒ½å¦æŠ„åˆ«äººçš„scan ( æŸå¤„çš„ts â‰¥ è‡ªå·±å¼€å§‹æ—¶çš„ts+1 )</p><ol><li>ç»†èŠ‚ï¼šè¿™é‡Œå¼€å§‹æ—¶çš„tsä¹Ÿæ˜¯ä»Weak counterè·å¾—çš„ï¼Œè€Œä¸æ˜¯collect()å¾—åˆ°çš„ï¼ˆå³ï¼Œä¸æ˜¯update()å†™å…¥çš„ï¼‰</li><li>Weak counterçš„æ€§è´¨ä¿è¯ï¼Œå¦‚æœtsæ›´å¤§ï¼Œè¯¥æ“ä½œä¸€å®šæ›´æ™šå‘ç”Ÿï¼Œä¸ä¼šæœ‰â€œç¡äº†å¾ˆä¹…åˆšé†’â€çš„æƒ…å†µ<ul><li>ç”šè‡³å¯ä»¥æ˜¯ ( æŸå¤„çš„ts â‰¥ è‡ªå·±å¼€å§‹æ—¶çš„ts )ï¼Œåªè¦ä¸å°äºå³å¯ï¼ŒWeak counterçš„æ€§è´¨å¯ä¿è¯å®Œæ•´çš„scanï¼ˆExercise 8 Problem 2ï¼‰</li></ul></li></ol></li></ol><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åˆ¤æ–­èƒ½å¦ç”¨è‡ªå·±collectçš„ç»“æœï¼Œéœ€è¦æ¯”è¾ƒä¸¤ä¸ªcollectæ˜¯å¦ç›¸åŒï¼ˆåŒ…æ‹¬å€¼å’Œtimestampï¼‰ï¼Œå½“timestampå¯èƒ½é‡å¤æ—¶ï¼Œè¿˜éœ€è¦æ’é™¤é‡å¤æƒ…å†µã€‚</p><p>åˆ¤æ–­èƒ½å¦æŠ„åˆ«äººçš„ç»“æœï¼Œéœ€è¦ç¡®ä¿äº§ç”Ÿè¿™ä¸ªç»“æœçš„scanå‘ç”Ÿåœ¨è‡ªå·±å¼€å§‹ä¹‹åï¼Œæ ¹æ®timestampè·å–æ–¹å¼çš„ä¸åŒï¼ˆlocalå’Œshared weak counterï¼‰ï¼Œæ¯”è¾ƒæ—¶å¤§å¤šå°‘ä¹Ÿæœ‰æ‰€åŒºåˆ«ã€‚</p><h1 id="é™„"><a href="#é™„" class="headerlink" title="é™„"></a>é™„</h1><p>TAçš„è§£é‡Š</p><p>å…³äºAtomicï¼Œå’Œå®ç°linearizableçš„æ€è·¯</p><blockquote><p>Weak counter facts (perspective of an individual process):</p><p>- After I get a value (return) from the weak counter by calling wInc(), at most N-1 other processes can <em>still</em> obtain a value less or equal to that.</p><p>This is true because at most N-1 other processes can be concurrently executing with me (there are at most N processes after all, me being one of them), and <em>specifically</em>, executing wInc() on that same counter (e.g. they could have been about to return from wInc()). A weak counter guarantees that if some process calls wInc after I return from wInc (Correctness) that process <em>will</em> get a higher timestamp so adding to the previous fact, at most N-1 processes might still get a lower or equal value to the one I have just obtained.</p><p>Now, the goal of the atomic snapshot (anonymous or not) is to return a read of the entire array that is linearizable. We break correctness if we somehow return an array that is <em>not</em> linearizable. For example, take the following history (sequence of states) for an array of size 2:</p><p>S1: [0, 0] -&gt; S2: [1, 0] -&gt; S3: [1, 1] -&gt; S4: [1, 0] -&gt; S5: [0, 0]</p><p>At no point in time did the array ever have the state [0, 1]. If we ever were to return that state in the scan() operation, it would break correctness. However, this could happen if we were doing a naive approach where we simply collected once (read e.g. left to right): We read the first register at S1, sleep during S2, read the second register at S3, and finally return [0, 1].</p><p>The key point is that this problem arises only if some other process writes while we are reading: if we could guarantee that, when we collect, no process wrote on any register of the array, we would be free to return the result of that collect.</p><p>The <strong>non-anonymous</strong> snapshot solves this problem in two manners:</p><p>- We add timestamps to each register</p><p>- We collect twice and only return the result if and only if the timestamps of all registers have not changed.</p><p>This implies that no register wrote on the array between the first and second collect (and that is the scanâ€™s linearization point). Why? Because each process has its own register, therefore each registerâ€™s timestamp is <em>monotonically</em> increasing. If there is a write to the register, the timestamp necessarily increases (by one). By negation, if the timestamp did not increase, there was no write.</p><p>Can we make the same argument for the anonymous snapshotâ€™s algorithm? The answer is no. The difficulty comes because the model is different: the anonymous snapshot allows any process to update any register. If we constrained or assigned processes to a few or their own register, we would break anonymity. The consequence is that, for each register, its timestamp is no longer monotonically increasing (because of counter is weak), so even if two reads return the same value for that register there might have been a write in between.</p><p>However, even if it is not <em>monotonically</em> increasing, it <strong>necessarily</strong> <strong>increases</strong> after every N writes (see Weak Counter facts at the beginning of this explanation). So by collecting N+1 times and getting the same timestamps on all registers, there must necessarily be a point between two of the N+1 collects in which no write to any register could have happened, and we can linearize our scan then.</p></blockquote><p>åä¾‹2</p><blockquote><p>Consider an anonymous snapshot object with M = 2, i.e. only 2 slots. Suppose process p is performing a scan operation. Suppose also that the scan operation consists of <strong>only</strong> 2 collects, as you mention, and not N as the original algorithm implies, and that process p obtains timestamp <strong>t</strong>. Suppose all other N-1 processes are performing update operations, have all obtained the same timestamp <strong>tâ€™</strong> &lt; <strong>t</strong> and scan <strong>S</strong>, and are about to write to their corresponding register (paused just before writing).</p><p>Since N can be made arbitrarily large (and thus so can N-1), I can use any constant number of processes from this group in my counter example. More specifically, in these conditions I can choose to apply any number of writes of any value to any position of the snapshot at any point during process pâ€™s scan, with the restriction that the timestamp value written is <strong>tâ€™</strong> and the scan is <strong>S</strong>. Taking this into account, consider the following sequence of operations and state of the snapshot:</p><p>[empty, empty]     - initial value</p><p>[(0, tâ€™, S), empty]   - process q1 writes (v = 0, i = 0)</p><p>[(0, tâ€™, S), (0, tâ€™, S)]  - process q2 writes (v = 0, i = 1)</p><p>[(0, tâ€™, S), (0, tâ€™, S)]  - process p reads the first register. first collect -&gt; (0, tâ€™, S)</p><p>[(1, tâ€™, S), (0, tâ€™, S)]  - process q3 writes (v = 1, i = 0)</p><p>[(1, tâ€™, S), (1, tâ€™, S)]  - process q4 writes (v = 1, i = 1)</p><p>[(1, tâ€™, S), (1, tâ€™, S)]  - process p reads the second register. first collect -&gt; (1, tâ€™, S)</p><p>[(1, tâ€™, S), (0, tâ€™, S)]  - process q5 writes (v = 0, i = 1)</p><p>[(0, tâ€™, S), (0, tâ€™, S)]  - process q6 writes (v = 0, i = 0)</p><p>[(0, tâ€™, S), (0, tâ€™, S)]  - process p reads the first register. second collect -&gt; (0, tâ€™, S)</p><p>[(1, tâ€™, S), (0, tâ€™, S)]  - process q7 writes (v = 1, i = 0)</p><p>[(1, tâ€™, S), (1, tâ€™, S)]  - process q8 writes (v = 1, i = 1)</p><p>[(1, tâ€™, S), (1, tâ€™, S)]  - process p reads the second register. second collect -&gt; (1, tâ€™, S)</p><p>In the previous execution, process p returns [0, 1] as the result of the scan operation (2 identical collects). However, at no point in time was the state of the snapshot ever [0, 1] indicating that the read of the snapshot is not linearizable.</p><p>Finally, note that the authors of the paper are not claiming a lower bound on the number of reads that have to be realized to have an atomic snapshot. They are claiming an upper bound (N collects -&gt; N x M reads). Maybe with some other algorithm, a strong counter or the like, you would be able to do it with less reads, but the present algorithm fails for just 2 collects as Iâ€™ve show above.</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;é‡ç‚¹ï¼šå…³äºå®ç°Wait-free Atomic Snapshotæ—¶ï¼Œä¸ºä»€ä¹ˆè¦åˆ¤æ–­2æ¬¡/næ¬¡æ›´æ–°&lt;/p&gt;
&lt;p&gt;ç›¸å…³slides: The Power of Registers, Computing with anonymous processes&lt;/p&gt;
&lt;h1 id=&quot;å®
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="concurrent_algorithm" scheme="https://coconutnutx.github.io/tags/concurrent-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Snapshotçš„timestamp</title>
    <link href="https://coconutnutx.github.io/2022/01/12/snapshot/"/>
    <id>https://coconutnutx.github.io/2022/01/12/snapshot/</id>
    <published>2022-01-12T10:44:01.000Z</published>
    <updated>2022-01-12T10:44:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>CS-453 Concurrent algorithmsï¼Œslide: The Power of Registers</p><p>Atomic Snapshotå®ç°çš„åŸºæœ¬æ€è·¯ï¼š</p><ul><li>ä¸¤æ¬¡æ‰«æï¼Œå¾—åˆ°ç›¸åŒçš„ç»“æœ</li><li>åŠ timestampé¿å…ABAæƒ…å†µ</li></ul><p>ä¸åŠ timestampçš„åä¾‹ï¼ˆp19ï¼‰</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2022/screencapture2022-01-12 PM12.20.20.jpg"                                     ><p>å†™äº†ä¸€ä¸‹å…·ä½“æ­¥éª¤ï¼š</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2022/IMG_A6C8CC987C90-1.jpeg"                                     ><p>å¯ä»¥å‘ç°ï¼Œä¸¤æ¬¡collectå¾—åˆ°çš„éƒ½æ˜¯[0,0,2]ï¼Œæœ€åè¿”å›[0,0,2]<br>ä½†æ˜¯å®é™…ä¸Šï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œå¯„å­˜å™¨ä¸­å®é™…çš„å€¼æ˜¯[0,0,2]<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶collectäº†åŒæ ·çš„å€¼ï¼Œä½†è¿™ä¸ªå€¼ä»æœªå­˜åœ¨è¿‡</p><p>æ‰€ä»¥ä¸ä»…å€¼è¦ç›¸åŒï¼Œè¿˜éœ€è¦timestampæ¥ä¿è¯æ²¡æœ‰å‘ç”Ÿè¿‡æ›´æ–°</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;CS-453 Concurrent algorithmsï¼Œslide: The Power of Registers&lt;/p&gt;
&lt;p&gt;Atomic Snapshotå®ç°çš„åŸºæœ¬æ€è·¯ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸¤æ¬¡æ‰«æï¼Œå¾—åˆ°ç›¸åŒçš„ç»“æœ&lt;/li&gt;
&lt;li&gt;åŠ timestampé¿å…
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="concurrent_algorithm" scheme="https://coconutnutx.github.io/tags/concurrent-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Obsidianä½¿ç”¨æ„Ÿå—</title>
    <link href="https://coconutnutx.github.io/2022/01/12/note/"/>
    <id>https://coconutnutx.github.io/2022/01/12/note/</id>
    <published>2022-01-12T08:56:00.000Z</published>
    <updated>2022-01-12T08:56:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>æƒ³è¦è¯•è¯•å¸¦å…³ç³»å›¾çš„åŒé“¾ç¬”è®°ï¼Œ10æœˆå¼€å§‹å°è¯•Obsidianï¼Œåˆ°ç°åœ¨å·®ä¸å¤šä¸‰ä¸ªæœˆï¼Œæ²¡æƒ³åˆ°å·²ç»è¿™ä¹ˆå¤šäº†ã€‚</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2022/Obsedian2021.jpg"                                     ><p>ä¸€å¼€å§‹åªæ˜¯è®°äº†äº›è¯¾ç¨‹ç¬”è®°ï¼Œè“è‰²æ˜¯Machine Learningï¼Œç²‰è‰²æ˜¯Sublinear Algorithmsï¼Œç´«è‰²å’Œé»„è‰²æ˜¯Distributedå’ŒConcurrent Algorithmsã€‚åæ¥åˆæŠŠä¸€äº›å…¶å®ƒçš„ã€åŒ…æ‹¬è¯»ä¹¦ç¬”è®°éƒ½åŠ äº†è¿›æ¥ã€‚çœ‹ç€æ•´ä¸ªå›¾ä¸€ç‚¹ç‚¹é•¿å¤§ã€ä¸åŒçš„éƒ¨åˆ†å¼€å§‹æœ‰äº†è”ç³»ï¼Œæœ‰ç§é›†å¡æ¸¸æˆçš„æ»¡è¶³æ„Ÿã€‚</p><p>Obsidian+GithubçœŸæ˜¯å¤ªæ£’äº†ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æƒ³è¦è¯•è¯•å¸¦å…³ç³»å›¾çš„åŒé“¾ç¬”è®°ï¼Œ10æœˆå¼€å§‹å°è¯•Obsidianï¼Œåˆ°ç°åœ¨å·®ä¸å¤šä¸‰ä¸ªæœˆï¼Œæ²¡æƒ³åˆ°å·²ç»è¿™ä¹ˆå¤šäº†ã€‚&lt;/p&gt;
&lt;img  
                     lazyload
                     src=&quot;/images/loading.svg
      
    
    </summary>
    
    
      <category term="Memo" scheme="https://coconutnutx.github.io/categories/Memo/"/>
    
    
      <category term="tool" scheme="https://coconutnutx.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>CA project çŠ¶æ€åˆ†æ&amp;debug</title>
    <link href="https://coconutnutx.github.io/2021/12/16/ca-condition/"/>
    <id>https://coconutnutx.github.io/2021/12/16/ca-condition/</id>
    <published>2021-12-16T19:49:38.000Z</published>
    <updated>2021-12-16T19:49:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šæ¬¡<a href="https://coconutnutx.github.io/2021/11/28/ca-project/">CA project æ€è·¯ç¬”è®°</a>åˆ†æä¸€ä¸ªä½ç½®æ˜¯å¦å¯ä»¥è¯»å†™çš„çŠ¶æ€ï¼š</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-16 PM8.49.01.jpg"                                     ><p>ä½†æ˜¯åœ¨projectæµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°æœ‰é—®é¢˜ã€‚</p><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>æŒ‰ç…§<a class="link"   href="http://localhost:4000/2021/12/15/ca-control/" >Atomic control<i class="fas fa-external-link-alt"></i></a>çš„é€»è¾‘å†™äº†read_align()å’Œwrite_align()ã€‚</p><p>read_alignä¸­åˆ¤æ–­Written==0æ—¶ï¼Œå¦‚æœæ²¡æœ‰ownerã€æˆ–è€…owneræ˜¯è‡ªå·±ï¼Œå¯ä»¥å†™ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(owner==<span class="number">0</span> || owner==tr-&gt;id)&#123;</span><br><span class="line">  <span class="keyword">uint_least64_t</span> not_written = owner &lt;&lt; <span class="number">32</span> | epoch | valid;</span><br><span class="line">  <span class="keyword">if</span>(atomic_compare_exchange_strong(cur_control, &amp;not_written, written_and_is_owner))&#123;</span><br><span class="line">    <span class="comment">// write the content at source into the writable copy;</span></span><br><span class="line">    write_writable_copy(source, segment, index);</span><br><span class="line">    <span class="comment">// return the transaction can continue;</span></span><br><span class="line">    flag = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æµ‹è¯•æ—¶ï¼Œtransactioné‡ä¸€ä¸¤åƒè¿˜èƒ½è¿‡ï¼Œ10000å°±è¿‡ä¸äº†äº†ã€‚</p><p>åè€Œâ†“è¿™æ ·å¯ä»¥è¿‡ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(atomic_compare_exchange_strong(cur_control, &amp;load_control, written_and_is_owner))&#123;</span><br><span class="line">  <span class="comment">// write the content at source into the writable copy;</span></span><br><span class="line">  write_writable_copy(source, segment, index);</span><br><span class="line">  <span class="comment">// return the transaction can continue;</span></span><br><span class="line">  flag = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å®ƒå¹¶ä¸ç¬¦åˆåŸæœ¬çš„æ€è·¯ï¼Œå› ä¸ºå¯èƒ½ä¼šå°†ç¬¬ä¸€ä¸ªè¯»æˆåŠŸçš„ownerè¦†ç›–ã€‚å°±å¾ˆå¥‡æ€ªã€‚</p><h1 id="é‡è¯»"><a href="#é‡è¯»" class="headerlink" title="é‡è¯»"></a>é‡è¯»</h1><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-16 PM8.58.31.jpg"                      width=600                ><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-16 PM8.59.01.jpg"                      width=600                ><p>æ„Ÿè§‰ä¼šæœ‰é—®é¢˜çš„å¾ˆå¯èƒ½æ˜¯access setï¼Œä¸Šæ¬¡åˆ†æåªç”¨è®°å½•ç¬¬ä¸€ä¸ªè¯»æˆ–å†™æˆåŠŸçš„idï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå®é™…ä¸­å³ä½¿å†™è¦†ç›–äº†è¯»ä¹Ÿå¯ä»¥æˆåŠŸå‘¢ï¼Ÿ</p><p>å‡è®¾åœ¨æŸä¸€ä¸ªalignï¼Œtr1ã€tr2è¯»äº†æ—§å€¼ï¼Œæ­¤æ—¶å¦‚æœtr3å†™äº†æ–°å€¼ï¼Œtr1ã€tr2ä»¥åŠä»»ä½•é™¤tr3ä»¥å¤–çš„transactionéƒ½ä¸èƒ½å†è¯»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå†™è¿‡çš„ä½ç½®ï¼Œåªæœ‰å†™è€…å¯è¯»ã€‚è¿™å…¶å®æ˜¯ç¬¦åˆread_word()ä¼ªä»£ç çš„ã€‚å¹¶ä¸”ï¼Œå¦‚æœtr1ã€tr2åé¢ä¸å†è¯»è¿™ä¸ªå€¼ï¼Œå¯ä»¥æäº¤å¹¶linearizeåˆ°tr3å¼€å§‹ä¹‹å‰ï¼›åä¹‹ï¼Œå¦‚æœå®ƒä»¬åé¢è¿˜è¦è¯»è¿™ä¸ªå€¼ï¼Œå°±ä¼šè¯»å¤±è´¥ï¼Œè¿›è€Œè¢«abortã€‚æ‰€ä»¥ä¹Ÿæ˜¯ç¬¦åˆlinearizableçš„ã€‚</p><p>éš¾é“access setåªç”¨è®°å½•ç¬¬ä¸€ä¸ªå†™æˆåŠŸçš„ï¼Ÿä¸Šæ¬¡è·ŸTAç¡®è®¤äº†ä¸€ä¸‹ï¼Œaccess setåªç”¨è®°ä¸€ä¸ªidï¼Œä¼¼ä¹ç¡®å®æ²¡ä»”ç»†é—®æ˜¯ç¬¬ä¸€ä¸ªè¯»æˆåŠŸã€è¿˜æ˜¯å†™æˆåŠŸã€‚</p><p>é‚£ä¹ˆæŒ‰ç…§æ–°çš„é€»è¾‘åˆ†æï¼Œç¬¬ä¸€ä¸ªè¯»æˆ–å†™æˆåŠŸï¼Œè¿˜æ˜¯éƒ½è®°å…¥ownerï¼Œåªä¸è¿‡è¯»æˆåŠŸçš„ownerå¯ä»¥è¢«è¦†ç›–ã€‚</p><p>å¯å¦‚æœèƒ½å¤Ÿè¦†ç›–ï¼Œread ownerå’Œotherè¿˜æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿï¼ˆå…¶å®ç°åœ¨è¿™ç‰ˆä»£ç é‡Œé¢ä¹Ÿå‹æ ¹æ²¡ç”¨åˆ°otherï¼‰å¦‚æœç›´æ¥æŠŠread_alignä¸­è®¾ç½®ownerå’Œotherçš„ä»£ç æ³¨é‡Šæ‰ï¼Œè¿˜èƒ½è·‘å—ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">âª #worker threads:     4</span><br><span class="line">âª #TX per worker:      10000</span><br><span class="line">âª #repetitions:        7</span><br><span class="line">âª Initial #accounts:   128</span><br><span class="line">âª Expected #accounts:  1024</span><br></pre></td></tr></table></figure><p>â€¦ç”¨â†‘å‚æ•°æµ‹äº†å‡ æ¬¡ï¼Œå¤šæ•°èƒ½è¿‡ï¼Œå°‘æ•°Violated isolation or atomicityã€‚ä¹Ÿå°±æ˜¯è¯´otherè¿˜æ˜¯æœ‰ç”¨çš„ã€‚</p><p>å†çœ‹ä¸‹project descriptionä¸­å¯¹access setçš„æè¿°ï¼š</p><blockquote><p>The â€œaccess setâ€ of read-write transaction(s) which have accessed the word in the current epoch. Do not implement an actual set in any (optimized) implementation: this set will only be used to tell whether a transaction can write to the word. Namely, if at least one other transaction has accessed (i.e. read or written) this word in the same epoch, the write cannot happen. Said differently, if two transactions are in the access set, it doesnâ€™t matter which one they are.</p></blockquote><p>ç°åœ¨è¿·æƒ‘çš„ç‚¹å°±æ˜¯ï¼š</p><ol><li>å¦‚æœæœ‰å¦ä¸€ä¸ªtransactionä¹Ÿè®¿é—®è¿‡ï¼Œè¿˜èƒ½ä¸èƒ½å†™ï¼Ÿ</li><li>ç°åœ¨çš„ä»£ç é‡Œåˆ°åº•åˆ¤æ–­äº†otheræ²¡ï¼Ÿ</li></ol><p>2åº”è¯¥æ˜¯æ²¡æœ‰çš„ï¼ŒåŠ ä¸ªè¾“å‡ºå¯ä»¥å‘ç°ï¼Œå³ä½¿æœ‰otherè¿˜æ˜¯æœ‰æ—¶å†™æˆåŠŸäº†ã€‚é‚£ä¸ºä»€ä¹ˆå¯ä»¥è¿‡å‘¢ï¼Ÿéš¾é“æ˜¯æ„å¤–ï¼Ÿå¤šæµ‹å‡ æ¬¡è¿˜çœŸå¶å°”æœ‰Violated isolation or atomicityï¼</p><p>å¥½å§ï¼Œè™½ç„¶projectåˆå˜æˆäº†æœªå®ŒæˆçŠ¶æ€ï¼Œä½†è‡³å°‘æ²¡æœ‰é€»è¾‘é”™çš„ä»£ç èƒ½è·‘å¯¹ã€é€»è¾‘(ä»¥ä¸º)å¯¹çš„ä»£ç è·‘ä¸é€šçš„å°´å°¬æƒ…å†µäº†ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œä¸ºä»€ä¹ˆé€»è¾‘(ä»¥ä¸º)å¯¹çš„ä»£ç è·‘ä¸é€šï¼Ÿæ›´å‡†ç¡®çš„æ˜¯ï¼Œä¸ºä»€ä¹ˆåœ¨transactioné‡è¾ƒå¤§æ—¶è·‘ä¸é€šï¼Ÿ</p><h1 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h1><h2 id="CAS-fail-when-equal"><a href="#CAS-fail-when-equal" class="headerlink" title="CAS fail when equal"></a>CAS fail when equal</h2><p>æ‰“å°äº†ä¸€äº›tm_beginå’Œtm_endçš„ä¿¡æ¯ï¼Œå‘ç°å½“transactionè¿›è¡Œäº†å¾ˆå¤šã€idå¾ˆå¤§ä¹‹åï¼Œåªæœ‰tm_beginæ²¡æœ‰tm_endäº†ï¼Œä¹Ÿå°±æ˜¯è¯´åé¢çš„éƒ½æ²¡æœ‰commitã€‚å¹¶ä¸”éƒ½æ˜¯ä¸€äº›read/write transactionï¼Œå®ƒä»¬çš„writeéƒ½æ²¡æœ‰æˆåŠŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">[304850 write align] seg_id=8 index=1 flag=0</span><br><span class="line">[304851 tm_begin] is_ro=0</span><br><span class="line">[304821 write align] seg_id=8 index=1 flag=0</span><br><span class="line">[304852 tm_begin] is_ro=0</span><br><span class="line">[304833 write align] seg_id=8 index=1 flag=0</span><br><span class="line">[304853 tm_begin] is_ro=0</span><br><span class="line">[304836 write align] seg_id=8 index=1 flag=0</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å‘ç°æœ‰ä¸€ä¸ªCASä¸­ï¼Œæ˜æ˜expectedå€¼å’Œcontrolä¸­çš„å€¼æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ²¡æœ‰æ¢æˆåŠŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">atomic_compare_exchange_strong(cur_control, &amp;not_written, written_and_is_owner)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">not_written=5e0cb00000005 load_control=5e0cb00000005 cur_control=5e0cb00000005 equal=1</span><br></pre></td></tr></table></figure><p>è¿™å¯å°±å¤ªç¦»è°±äº†ï¼</p><blockquote><p><a class="link"   href="https://stackoverflow.com/questions/35534305/compare-exchange-strong-failing-despite-data-matching-expected-value" >compare_exchange_strong failing despite data matching expected value<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://stackoverflow.com/questions/66566810/why-does-compare-exchange-strong-fail-with-stdatomicdouble-stdatomicfloa" >Why does compare_exchange_strong fail with std::atomic, std::atomic in C++?<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>å¯èƒ½æ˜¯ç”±paddingå¯¼è‡´çš„ã€‚è¿™å°±å¾ˆå°´å°¬äº†ã€‚</p><h3 id="å°è¯•1"><a href="#å°è¯•1" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uint_least64_t not_written = owner &lt;&lt; 32 | valid;</span><br></pre></td></tr></table></figure><p>æ”¹æˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uint_least64_t not_written = load_control &amp; 0xFFFFFFFFFFFFFFF9;</span><br></pre></td></tr></table></figure><p>ä¸è¡Œ</p><h3 id="å°è¯•2"><a href="#å°è¯•2" class="headerlink" title="å°è¯•2"></a>å°è¯•2</h3><p>è¿™æ˜¯çœŸçš„å¾ˆç¦»è°±å•Šï¼æ‰“å°å‡ºæ¥çš„åˆ¤æ–­å°±æ˜¯ç›¸ç­‰å•Šï¼è¿™æ¢ä¸äº†èƒ½æ€ä¹ˆåŠå•Šï¼Ÿï¼Ÿï¼Ÿ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;DEBUG4 not_written=%lx load_control=%lx cur_control=%lx equal=%d test=%d\n&quot;</span>, not_written, load_control, load, not_written==load, atomic_load(cur_control)==not_written);</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DEBUG4 not_written=3e1a300000005 load_control=3e1a300000005 cur_control=3e1a300000005 equal=1 test=1</span><br><span class="line">[254371 write align] seg_id=8 index=1 flag=0 cond=4</span><br><span class="line">[254373 tm_begin] is_ro=0</span><br><span class="line">DEBUG4 not_written=3e1a400000005 load_control=3e1a400000005 cur_control=3e1a400000005 equal=1 test=1</span><br><span class="line">[254372 write align] seg_id=8 index=1 flag=0 cond=4</span><br><span class="line">[254374 tm_begin] is_ro=0</span><br><span class="line">DEBUG4 not_written=3e1a500000005 load_control=3e1a500000005 cur_control=3e1a500000005 equal=1 test=1</span><br></pre></td></tr></table></figure><p>éš¾é“æ˜¯uint_least64_tçš„é—®é¢˜ï¼Ÿå®ƒå’Œmemcpyçš„æ¯”è¾ƒæ–¹æ³•ä¸ä¸€æ ·ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">size_t a = (size_t)not_written;</span><br></pre></td></tr></table></figure><p>å¼ºåˆ¶è½¬æˆsize_tç„¶åæ¯”å°±å¥½äº†ï¼Ÿï¼Ÿï¼Ÿé‚£ä¹‹å‰æ‹…å¿ƒä½æ•°ä¸å¯¹ï¼Œè¿˜ç‰¹åœ°æä¸ªuint_least64_tï¼Œç®€ç›´æ˜¯ç¦»äº†ä¸ªå¤§è°±ã€‚</p><h2 id="too-long"><a href="#too-long" class="headerlink" title="too long"></a>too long</h2><p>æ”¹å¥½ä¸Šé¢è¿™ä¸ªç¦»è°±çš„bugä¹‹åï¼Œå½“transactionå¤ªå¤šè¿˜æ˜¯ä¼šè·‘ä¸å®Œã€‚æ‰“å°è¾“å‡ºçœ‹è¿˜æ˜¯write_alignä¸æˆåŠŸã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[370371 tm_begin] is_ro=0</span><br><span class="line">[370371 write align] seg_id=8 index=1 flag=0 cond=4 lc=5a6c300000005, cc=5a6c300000005</span><br><span class="line">[370372 tm_begin] is_ro=0</span><br><span class="line">[370372 write align] seg_id=8 index=1 flag=0 cond=4 lc=5a6c400000005, cc=5a6c400000005</span><br><span class="line">[370373 tm_begin] is_ro=0</span><br><span class="line">[370373 write align] seg_id=8 index=1 flag=0 cond=4 lc=5a6c500000005, cc=5a6c500000005</span><br><span class="line">[370374 tm_begin] is_ro=0</span><br><span class="line">[370374 write align] seg_id=8 index=1 flag=0 cond=4 lc=5a6c600000005, cc=5a6c600000005</span><br><span class="line">[370375 tm_begin] is_ro=0</span><br><span class="line">[370375 write align] seg_id=8 index=1 flag=0 cond=4 lc=5a6c700000005, cc=5a6c700000005</span><br></pre></td></tr></table></figure><p>å…¨éƒ¨éƒ½æ˜¯æœ‰other readå†²çª</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[215647 read align] seg_id=7 index=0 lc=0 cc=34a5f00000000</span><br><span class="line">[215647 read align] seg_id=7 index=1 lc=1 cc=34a5f00000001</span><br><span class="line">[215647 read align] seg_id=8 index=0 lc=0 cc=34a5f00000000</span><br><span class="line">[215647 read align] seg_id=8 index=1 lc=1 cc=34a5f00000001</span><br><span class="line">[215647 read align] seg_id=9 index=0 lc=1 cc=34a5f00000001</span><br><span class="line">[215647 read align] seg_id=9 index=1 lc=0 cc=34a5f00000000</span><br><span class="line">[215647 read align] seg_id=9 index=2 lc=0 cc=34a5f00000000</span><br><span class="line">[215647 read align] seg_id=9 index=3 lc=1 cc=34a5f00000001</span><br><span class="line">[215647 read align] seg_id=8 index=1 lc=34a5f00000001 cc=34a5f00000005</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸€ä¸ªé€»è¾‘é”™è¯¯ï¼Œowneræ˜¯è‡ªå·±æ—¶ä»è®¾äº†otherã€‚</p><p>è¿™ä¸‹ç®—æ˜¯ä¿®äº†ä¸€ä¸ªé€»è¾‘ä¸Šçš„å¤§bugï¼Œå†ä¸ŠæœåŠ¡å™¨æµ‹æµ‹ã€‚</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-16 PM10.51.17.jpg"                      width=600                ><p>æˆåŠŸï¼è™½ç„¶æ²¡æœ‰å˜å¿«ï¼Œä½†è‡³å°‘é€»è¾‘ä¸Šåˆç†äº†ï¼Œä¸åƒä¹‹å‰é‚£ä¹ˆè™šäº†ã€‚</p><hr><p>æ‰€ä»¥ä¹‹å‰é‚£ä¹ˆå¤§ä¸€ä¸ªbugæ˜¯æ€ä¹ˆè¿‡çš„æµ‹è¯•å•Šå°±ç¦»è°±ï¼Œä»Šå¤©çœŸæ˜¯æ»¡å¤´é—®å·ã€‚è€Œä¸”ä¹‹å‰é€»è¾‘éƒ½æ²¡å¯¹å°±å†™ä¼˜åŒ–ï¼Œé‚£å¯ä¸æ˜¯å†™äº†ä¸ªå¯‚å¯ã€‚å¹¸äºä¼˜åŒ–çš„æ€è·¯ç°åœ¨æ˜¯å¾ˆæ¸…æ™°äº†ï¼Œæ¯•ç«Ÿrevertã€é‡å†™éƒ½æäº†å¥½å‡ éäº†ã€‚è™½ç„¶ä¸çŸ¥é“è¿™äº›ä¼˜åŒ–åˆ°åº•èƒ½ä¸èƒ½æ­£å‘ä¼˜åŒ–ï¼Œä½†è¿˜æ˜¯æƒ³è¯•è¯•ï¼Œå°±æ˜¯å¾ˆå¥½å¥‡ï¼Œè€Œä¸”æ¯•ç«Ÿéƒ½èŠ±äº†è¿™ä¹ˆå¤šæ—¶é—´äº†ã€‚</p><p>é¡ºä¾¿æŠŠ<a href="https://coconutnutx.github.io/2021/12/15/ca-control/">Atomic control</a>æ›´æ–°ä¸€ä¸‹ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol><li>referenceçš„é€»è¾‘è¿˜æ˜¯å¾ˆæ­£ç¡®çš„</li><li>bugç¡®å®æ˜¯è‡ªå·±å†™çš„bug</li><li>é™¤äº†cçš„atomic_compare_exchange_strongï¼Œå€¼è¾ƒå¤§æ—¶ï¼ŒæœŸæœ›å€¼å’Œå®é™…å€¼ä¸€æ ·ä½†æ¢ä¸æˆåŠŸï¼Œæ˜¯çœŸçš„ç¦»è°±</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸Šæ¬¡&lt;a href=&quot;https://coconutnutx.github.io/2021/11/28/ca-project/&quot;&gt;CA project æ€è·¯ç¬”è®°&lt;/a&gt;åˆ†æä¸€ä¸ªä½ç½®æ˜¯å¦å¯ä»¥è¯»å†™çš„çŠ¶æ€ï¼š&lt;/p&gt;
&lt;img  
                     lazy
      
    
    </summary>
    
    
      <category term="Debug" scheme="https://coconutnutx.github.io/categories/Debug/"/>
    
    
      <category term="concurrent_algorithm" scheme="https://coconutnutx.github.io/tags/concurrent-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>CA project Atomic control</title>
    <link href="https://coconutnutx.github.io/2021/12/15/ca-control/"/>
    <id>https://coconutnutx.github.io/2021/12/15/ca-control/</id>
    <published>2021-12-15T16:37:29.000Z</published>
    <updated>2021-12-15T16:37:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>Projectä¸­ä¸ºäº†æ ‡è¯†transactional memoryä¸­æ¯ä¸€ä¸ªalignçš„çŠ¶æ€ï¼Œéœ€è¦ä¸€ä¸ªcontrol structureï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ª64bitçš„atomic intergeræ¥å­˜è¿™äº›ä¿¡æ¯ã€‚</p><p>é€šè¿‡ä¸€æ¬¡CASå®Œæˆå¯¹çŠ¶æ€çš„åˆ¤æ–­å’Œä¿®æ”¹ï¼Œé¿å…åŠ é”ã€‚</p><h1 id="Controlè®¾è®¡"><a href="#Controlè®¾è®¡" class="headerlink" title="Controlè®¾è®¡"></a>Controlè®¾è®¡</h1><table><thead><tr><th>å ç”¨bit</th><th>32</th><th>20</th><th>9</th><th>1</th><th>1</th><th>1</th></tr></thead><tbody><tr><td>åç§°</td><td>Owner</td><td>Epoch</td><td>ç•™ç©º</td><td>Other</td><td>Written</td><td>Valid</td></tr><tr><td>æè¿°</td><td>æœ¬è½®ç¬¬ä¸€ä¸ªreadæˆ–writeæˆåŠŸçš„transactionçš„id</td><td>å½“å‰è½®æ•°</td><td></td><td>æ˜¯å¦æœ‰å…¶å®ƒtransactionè®¿é—®</td><td>æ˜¯å¦è¢«å†™</td><td>Aæˆ–Bå“ªä¸ªæœ‰æ•ˆ</td></tr></tbody></table><h1 id="Control-masks"><a href="#Control-masks" class="headerlink" title="Control masks"></a>Control masks</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> VALID_MASK = <span class="number">0x1</span>;         <span class="comment">// 0: A is valid    1: B is valid</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> WRITE_MASK = <span class="number">0x1</span> &lt;&lt; <span class="number">1</span>;    <span class="comment">// 0: not written   1: written</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> OTHER_MASK = <span class="number">0x1</span> &lt;&lt; <span class="number">2</span>;    <span class="comment">// 0: no other read 1: has other read</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> EPOCH_MASK = <span class="number">0xFFFFF000</span>;</span><br></pre></td></tr></table></figure><h1 id="Control-macros"><a href="#Control-macros" class="headerlink" title="Control macros"></a>Control macros</h1><p>æœ‰æ—¶éœ€è¦ç›´æ¥è¯»atomic intergerã€‚å…¶ä»–æ—¶å€™ï¼Œå…ˆè¯»ä¸€æ¬¡ï¼Œç„¶åç›´æ¥å¯¹è¯»åˆ°çš„å€¼è¿›è¡Œæ“ä½œï¼Œå¯ä»¥å‡å°‘atomic_load()æ¬¡æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_FLAG_SIGN(control, flag) ((atomic_load(control) &amp; flag) != 0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_FLAG_SIGN_LOADED(load_control, flag) ((load_control &amp; flag) != 0)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_FLAG_LOADED(load_control, flag) (load_control &amp; flag)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_EPOCH_LOADED(load_control) (load_control &amp; EPOCH_FLAG)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_OWNER(control) ((atomic_load(control)) &gt;&gt; 32)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_OWNER_LOADED(load_control) (load_control &gt;&gt; 32)</span></span><br></pre></td></tr></table></figure><h1 id="read-aligné€»è¾‘"><a href="#read-aligné€»è¾‘" class="headerlink" title="read_aligné€»è¾‘"></a>read_aligné€»è¾‘</h1><ol><li><p>If å·²ç»è¢«å†™è¿‡ï¼Œåªæœ‰ownerå¯ä»¥è¯»ï¼ˆä¸”Otheråº”è¯¥ä¸ºç©ºï¼Œå› ä¸ºOtherå’ŒWrittenä¸è‚¯èƒ½åŒæ—¶ä¸º1ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expected: Owner==id; Epoch==epoch; Other==0; Written==1; Valid==valid</span><br></pre></td></tr></table></figure></li><li><p>If æ²¡æœ‰è¢«å†™è¿‡</p><ol><li><p>If owner==0ï¼Œå°è¯•æŠ¢å ï¼ˆå¯èƒ½ä¼šå‡ºç°ç«äº‰è€Œå¤±è´¥ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Expected: Owner==0;  Epoch==epoch; Other==0; Written==0; Valid==valid</span><br><span class="line">Desired:  Owner==id; Epoch==epoch; Other==0; Written==0; Valid==valid</span><br></pre></td></tr></table></figure></li><li><p>Else if owner==è‡ªå·±ï¼Œç›´æ¥è¯»ï¼ˆownerä¸ä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿåªæœ‰è‡ªå·±å¯èƒ½å†™ï¼‰</p></li><li><p>Else if owner==åˆ«äºº</p><ol><li><p>If å°è¯•è®¾Other</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Expected: Owner==owner; Epoch==epoch; Other==0; Written==0; Valid==valid</span><br><span class="line">Desired:  Owner==owner; Epoch==epoch; Other==1; Written==0; Valid==valid</span><br></pre></td></tr></table></figure></li><li><p>Else if è¯»åˆ°å·²ç»è¢«è®¾äº†Other</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expected: Owner==owner; Epoch==epoch; Other==1; Written==0; Valid==valid</span><br></pre></td></tr></table></figure><p>å¦‚æœè¯»åˆ°Otherä¸º1ï¼Œownerä¹Ÿä¸èƒ½å†å†™è¿™ä¸ªalignäº†ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒè¯»ã€‚</p></li></ol></li></ol></li></ol><h1 id="write-aligné€»è¾‘"><a href="#write-aligné€»è¾‘" class="headerlink" title="write_aligné€»è¾‘"></a>write_aligné€»è¾‘</h1><ol><li><p>If å·²ç»è¢«å†™è¿‡ï¼Œåªæœ‰ownerå¯ä»¥å†™ï¼Œä¸”ä¸èƒ½æœ‰other</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Expected: Owner==id; Epoch==epoch; Other==0; Written==1; Valid==valid</span><br></pre></td></tr></table></figure></li><li><p>If æ²¡æœ‰è¢«å†™è¿‡</p><ol><li><p>å·²ç»æ˜¯ownerå¯ä»¥å†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Expected: Owner==id; Epoch==epoch; Other==0; Written==0; Valid==valid</span><br><span class="line">Desired:  Owner==id; Epoch==epoch; Other==0; Written==1; Valid==valid</span><br></pre></td></tr></table></figure></li><li><p>æŠ¢åˆ°ownerå¯ä»¥å†™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Expected: Owner==0;  Epoch==epoch; Other==0; Written==0; Valid==valid</span><br><span class="line">Desired:  Owner==id; Epoch==epoch; Other==0; Written==1; Valid==valid</span><br></pre></td></tr></table></figure></li></ol></li></ol><p>Noteï¼šå¦‚æœå†™æˆåŠŸäº†ï¼Œæœ¬è½®ä¸­controlçš„å€¼å°†ä¸ä¼šå†å‘ç”Ÿæ”¹å˜</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Projectä¸­ä¸ºäº†æ ‡è¯†transactional memoryä¸­æ¯ä¸€ä¸ªalignçš„çŠ¶æ€ï¼Œéœ€è¦ä¸€ä¸ªcontrol structureï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ª64bitçš„atomic intergeræ¥å­˜è¿™äº›ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;p&gt;é€šè¿‡ä¸€æ¬¡CASå®Œæˆå¯¹çŠ¶æ€çš„åˆ¤æ–­å’Œä¿®æ”¹ï¼Œé¿å…åŠ é”ã€‚&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="concurrent_algorithm" scheme="https://coconutnutx.github.io/tags/concurrent-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>CA project å¸¸ç”¨æ“ä½œ</title>
    <link href="https://coconutnutx.github.io/2021/12/12/ca-project/"/>
    <id>https://coconutnutx.github.io/2021/12/12/ca-project/</id>
    <published>2021-12-12T22:42:37.000Z</published>
    <updated>2021-12-12T22:42:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>å¾ˆä¹…æ²¡ç”¨Cäº†ï¼Œè¿˜æœ‰ä¸€äº›åŒæ­¥ç›¸å…³çš„æ“ä½œï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><h1 id="å†…å­˜"><a href="#å†…å­˜" class="headerlink" title="å†…å­˜"></a>å†…å­˜</h1><p>åˆ†é…</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">region</span>* <span class="title">region</span> =</span> (struct region*) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct region));</span><br><span class="line"><span class="keyword">if</span> (unlikely(!region)) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†é…ï¼ˆä¸”å†…å­˜æŒ‰alignæ’åˆ—ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (posix_memalign(&amp;(region-&gt;start), align, size) != <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="built_in">free</span>(region);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¡«é›¶</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">memset</span>(region-&gt;start, <span class="number">0</span>, size);</span><br></pre></td></tr></table></figure><h1 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h1><p>å¡«å€¼&amp;å–å€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// define index</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segment</span> &#123;</span></span><br><span class="line">    <span class="keyword">size_t</span> align;</span><br><span class="line">    <span class="keyword">uint8_t</span>* index;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// init index</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>; i&lt;cnt; i++)&#123;</span><br><span class="line">  <span class="keyword">size_t</span>* p = (<span class="keyword">size_t</span>*)(segment-&gt;index + i*align);</span><br><span class="line">  *p = i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get index</span></span><br><span class="line"><span class="keyword">size_t</span> index = *(<span class="keyword">size_t</span>*)(address)</span><br></pre></td></tr></table></figure><p>ğŸŒ°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// find segment and index</span></span><br><span class="line"><span class="keyword">size_t</span> index = *(<span class="keyword">size_t</span>*)(address);</span><br><span class="line"><span class="keyword">size_t</span> offset = index * region-&gt;align + <span class="keyword">sizeof</span>(struct segment);</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segment</span>* <span class="title">segment</span> =</span> (struct segment*)((<span class="keyword">uint8_t</span>*)address - offset);</span><br></pre></td></tr></table></figure><p>æŒ‡é’ˆçš„æŒ‡é’ˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">s</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span>** p_addr;</span><br><span class="line">    <span class="keyword">size_t</span>* p_num;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// set</span></span><br><span class="line">*(s-&gt;p_addr + index) = address;    <span class="comment">// void* address</span></span><br><span class="line">*(s-&gt;p_num + index) = size;        <span class="comment">// size_t size</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// get</span></span><br><span class="line"><span class="keyword">void</span>* addr = *(p_addr + i);</span><br><span class="line"><span class="keyword">size_t</span> size = *(p_num + i);</span><br></pre></td></tr></table></figure><h1 id="ä½è¿ç®—"><a href="#ä½è¿ç®—" class="headerlink" title="ä½è¿ç®—"></a>ä½è¿ç®—</h1><p>è®¾ç½®mask</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">size_t</span> MASK = <span class="number">0x0001</span> &lt;&lt; <span class="number">2</span>;</span><br></pre></td></tr></table></figure><p>è·å–maskä¸‹çš„å€¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> GET_FLAG(control, mask) ((atomic_load(control) &amp; mask) != 0)</span></span><br></pre></td></tr></table></figure><p>è®¾ç½®é«˜ä½</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">control |= id &lt;&lt; <span class="number">32</span>;</span><br></pre></td></tr></table></figure><p>è·å–é«˜ä½</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint_least64_t</span> id = control &gt;&gt; <span class="number">32</span>;</span><br></pre></td></tr></table></figure><h1 id="åŒæ­¥"><a href="#åŒæ­¥" class="headerlink" title="åŒæ­¥"></a>åŒæ­¥</h1><h2 id="é”å’Œæ¡ä»¶å˜é‡"><a href="#é”å’Œæ¡ä»¶å˜é‡" class="headerlink" title="é”å’Œæ¡ä»¶å˜é‡"></a>é”å’Œæ¡ä»¶å˜é‡</h2><blockquote><p>reference â€œlock.hâ€ â€œlock.câ€</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">lock_t</span> &#123;</span></span><br><span class="line">    <span class="keyword">pthread_mutex_t</span> mutex;</span><br><span class="line">    <span class="keyword">pthread_cond_t</span> cv;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">lock_init</span><span class="params">(struct <span class="keyword">lock_t</span>* lock)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> pthread_mutex_init(&amp;(lock-&gt;mutex), <span class="literal">NULL</span>) == <span class="number">0</span></span><br><span class="line">        &amp;&amp; pthread_cond_init(&amp;(lock-&gt;cv), <span class="literal">NULL</span>) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lock_cleanup</span><span class="params">(struct <span class="keyword">lock_t</span>* lock)</span> </span>&#123;</span><br><span class="line">    pthread_mutex_destroy(&amp;(lock-&gt;mutex));</span><br><span class="line">    pthread_cond_destroy(&amp;(lock-&gt;cv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">lock_acquire</span><span class="params">(struct <span class="keyword">lock_t</span>* lock)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> pthread_mutex_lock(&amp;(lock-&gt;mutex)) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lock_release</span><span class="params">(struct <span class="keyword">lock_t</span>* lock)</span> </span>&#123;</span><br><span class="line">    pthread_mutex_unlock(&amp;(lock-&gt;mutex));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lock_wait</span><span class="params">(struct <span class="keyword">lock_t</span>* lock)</span> </span>&#123;</span><br><span class="line">    pthread_cond_wait(&amp;(lock-&gt;cv), &amp;(lock-&gt;mutex));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">lock_wake_up</span><span class="params">(struct <span class="keyword">lock_t</span>* lock)</span> </span>&#123;</span><br><span class="line">    pthread_cond_broadcast(&amp;(lock-&gt;cv));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸå­å˜é‡"><a href="#åŸå­å˜é‡" class="headerlink" title="åŸå­å˜é‡"></a>åŸå­å˜é‡</h2><p><a class="link"   href="https://en.cppreference.com/w/c/atomic/atomic_load" >atomic_load<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://en.cppreference.com/w/cpp/atomic/atomic_store" >atomic_store<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://en.cppreference.com/w/c/atomic/atomic_fetch_add" >atomic_fetch_add<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://en.cppreference.com/w/c/atomic/atomic_compare_exchange" >atomic_compare_exchange<i class="fas fa-external-link-alt"></i></a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¾ˆä¹…æ²¡ç”¨Cäº†ï¼Œè¿˜æœ‰ä¸€äº›åŒæ­¥ç›¸å…³çš„æ“ä½œï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h1 id=&quot;å†…å­˜&quot;&gt;&lt;a href=&quot;#å†…å­˜&quot; class=&quot;headerlink&quot; title=&quot;å†…å­˜&quot;&gt;&lt;/a&gt;å†…å­˜&lt;/h1&gt;&lt;p&gt;åˆ†é…&lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;ta
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="concurrent_algorithm" scheme="https://coconutnutx.github.io/tags/concurrent-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>å…³äºLocalized Causal Broadcast</title>
    <link href="https://coconutnutx.github.io/2021/12/09/lcb/"/>
    <id>https://coconutnutx.github.io/2021/12/09/lcb/</id>
    <published>2021-12-09T12:33:01.000Z</published>
    <updated>2021-12-09T12:33:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>DA project submission #2 è¦æ±‚å®ç°Localized Causal Broadcastï¼Œå…·ä½“çš„å®šä¹‰åœ¨project repoçš„READMEä¸­</p><blockquote><ul><li>You must implement this on top of uniform reliable broadcast (URB).</li><li>The <code>CONFIG</code> command-line argument for this algorithm consists of a file that contains an integer <code>m</code> in its first line. <code>m</code> defines how many messages each process should broadcast.</li><li>For a system of <code>n</code> processes, there are <code>n</code> more lines in the <code>CONFIG</code> file. Each line <code>i</code> corresponds to process <code>i</code>, and such a line indicates the identities of other processes which can affect process <code>i</code>. See the example below.<ul><li>The FIFO property still needs to be maintained by localized causal broadcast. That is, messages broadcast by the same process must not be delivered in a different order then they were broadcast.</li><li>The output format for localized causal broadcast remains the same as before.<br>Example of <code>CONFIG</code> file for a system of <code>5</code> processes, where each one broadcasts <code>m</code> messages:</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">m</span><br><span class="line">1 4 5</span><br><span class="line">2 1</span><br><span class="line">3 1 2</span><br><span class="line">4</span><br><span class="line">5 3 4</span><br></pre></td></tr></table></figure><p><em>Note</em>: Lines should end in <code>\n</code>, and numbers are separated by white-space characters.</p><p>In this example we specify that process <code>1</code> is affected by messages broadcast by processes <code>4</code> and <code>5</code>. Similarly, we specify that process <code>2</code> is only affected by process <code>1</code>. Process <code>4</code> is not affected by any other processes. Process <code>5</code> is affected by processes <code>3</code> and <code>4</code>.</p><p>We say that a process <code>x</code> is affected by a process <code>z</code> if all the messages which process <code>z</code> broadcasts and which process <code>x</code> delivers become dependencies for all future messages broadcast by process <code>x</code>. We call these dependencies <em>localized</em>. If a process is not affected by any other process, messages it broadcasts only depend on its previously broadcast messages (due to the FIFO property).</p><p><em>Note</em>:  In the default causal broadcast (this algorithm will be discussed in one of the lectures) each process affects <code>all</code> processes. In this algorithm we can selectively define which process affects some other process.</p></blockquote><h1 id="å…³äºdependency"><a href="#å…³äºdependency" class="headerlink" title="å…³äºdependency"></a>å…³äºdependency</h1><p>process is affected by other processesï¼Œä½†æ¶ˆæ¯çš„dependencyæ˜¯å¯¹æ¯ä¸€æ¡æ¶ˆæ¯è€Œè¨€çš„ã€‚</p><p>ï¼ˆå½“ç”¨ä¹¦ä¸Šçš„vector clockæ–¹æ³•å®ç°æ—¶ï¼‰ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€æ¡LCBå±‚æ¶ˆæ¯åœ¨broadcastçš„æ—¶é—´ç‚¹ï¼Œéœ€è¦æ‹¿åˆ°è¿™ä¸ªæ—¶é—´ç‚¹ã€å½“å‰è¿›ç¨‹çš„vector clockï¼Œä½œä¸ºè‡ªå·±çš„dependency clockã€‚å¯ä»¥ä½œä¸ºæ¶ˆæ¯å†…å®¹ä¼ ç»™å…¶å®ƒprocessã€‚</p><p>å…¶å®ƒprocessæ”¶åˆ°æ¶ˆæ¯ï¼Œåˆ¤æ–­èƒ½å¦deliverï¼Œå³åˆ¤æ–­è‡ªå·±çš„vector clockæ˜¯å¦å¤§äºæ¶ˆæ¯çš„dependency clockã€‚</p><h1 id="å…³äºFIFO"><a href="#å…³äºFIFO" class="headerlink" title="å…³äºFIFO"></a>å…³äºFIFO</h1><p>æ ¹æ®sequence numberå¯ä»¥ä¿è¯FIFOã€‚</p><p>åŸºäºvector clockä¹Ÿå¯ä»¥ä¿è¯FIFOã€‚</p><p>å¯¹äºå…¶å®ƒè¿›ç¨‹ï¼Œéƒ½æ˜¯åœ¨deliveræ¶ˆæ¯æ—¶ï¼Œå¢åŠ è¯¥è¿›ç¨‹å¯¹åº”çš„vector clockå€¼ã€‚</p><p>å¯¹äºå½“å‰è¿›ç¨‹ï¼Œå¯ä»¥åšä¸€äº›è°ƒæ•´ï¼Œåœ¨broadcastæ¶ˆæ¯æ—¶å°±ä¿®æ”¹å¯¹åº”çš„vector clockå€¼ã€‚</p><p>ğŸŒ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># in process 1</span><br><span class="line">b 1 [0 . .]</span><br><span class="line">b 2 [1 . .]</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå…¶å®ƒè¿›ç¨‹æ”¶åˆ°2æ—¶ï¼Œå¿…é¡»å…ˆdeliver 1ã€‚</p><p>å¯ä»¥ä¿è¯å½“å‰è¿›ç¨‹å¹¿æ’­çš„æ¯ä¸€æ¡æ¶ˆæ¯ï¼Œéƒ½æœ‰ä¸åŒçš„vector clockï¼ˆå³ä½¿å½“å‰è¿›ç¨‹æ²¡æœ‰affected byä»»ä½•è¿›ç¨‹ï¼‰ï¼Œä»è€Œä¿è¯FIFOã€‚</p><p>è¿™æ ·åœ¨deliverçš„æ—¶å€™ï¼Œå¯ä»¥ç»Ÿä¸€å¤„ç†vector clockï¼Œè€Œä¸ç”¨ç®¡sequence numberã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;DA project submission #2 è¦æ±‚å®ç°Localized Causal Broadcastï¼Œå…·ä½“çš„å®šä¹‰åœ¨project repoçš„READMEä¸­&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;You must implement this on t
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="distributed_algorithm" scheme="https://coconutnutx.github.io/tags/distributed-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>CA project debugè®°å½•</title>
    <link href="https://coconutnutx.github.io/2021/12/06/ca-debug/"/>
    <id>https://coconutnutx.github.io/2021/12/06/ca-debug/</id>
    <published>2021-12-06T10:09:23.000Z</published>
    <updated>2021-12-06T10:09:23.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æƒ¨ç—›ç»éªŒ"><a href="#æƒ¨ç—›ç»éªŒ" class="headerlink" title="æƒ¨ç—›ç»éªŒ"></a>æƒ¨ç—›ç»éªŒ</h1><h2 id="Start-easy"><a href="#Start-easy" class="headerlink" title="Start easy"></a>Start easy</h2><p>ç¬¬ä¸€æ­¥ï¼ŒåŠ é”ï¼ŒæŠŠTransactional Memoryçš„åŠŸèƒ½å†™å¯¹ã€‚</p><ul><li>æµ‹è¯•æŠ¥é”™Transactional library takes too long to process the transactionsï¼Œæ˜¯åŠŸèƒ½å°±ä¸å¯¹ï¼Œå’Œçº¿ç¨‹æ•°é‡ã€transactionæ•°é‡ã€printæ²¡ä»€ä¹ˆå…³ç³»ã€‚</li><li>è¦æŠŠè¿™ä¸ªæŠ¥é”™çš„é˜ˆå€¼è°ƒå¤§ï¼Œä¿®æ”¹gradingé‡Œçš„slow_factorå³å¯ã€‚åˆšå¼€å§‹å¯ä»¥ç›´æ¥æ”¹åˆ°1024ã€‚</li></ul><p>å…ˆä¸è¦å†™ä»€ä¹ˆä¼˜åŒ–ï¼ŒæŠŠåŸºç¡€åŠŸèƒ½å†™å¯¹ï¼Œå¦åˆ™debugç›´æ¥deåˆ°åè¡€</p><h2 id="ç»†èŠ‚"><a href="#ç»†èŠ‚" class="headerlink" title="ç»†èŠ‚"></a>ç»†èŠ‚</h2><ol><li>read_word()å’Œwrite_write()è™½ç„¶æ˜¯ç…§ç€project desciptionå†™ï¼Œä½†è¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºé”™ï¼Œè¦å¾ˆå¾ˆå¾ˆå°å¿ƒï¼</li><li>freeçš„æ—¶æœºéœ€è¦æ³¨æ„ï¼Œæœ‰æ—¶å€™freeåå†è¯»å¹¶ä¸æ˜¯ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥ï¼Œbugè—å¾—æ¯”è¾ƒéšè”½ã€‚</li></ol><h2 id="Debug-Segmentation-fault"><a href="#Debug-Segmentation-fault" class="headerlink" title="Debug Segmentation fault"></a>Debug Segmentation fault</h2><p>Segmentation faultå¸¸ç”¨debugæ“ä½œï¼šcore dumpï¼ˆè™šæ‹Ÿæœºç¯å¢ƒä¸åŒï¼Œæµç¨‹å¯èƒ½ä¸ä¸€æ ·ï¼Œè¿™é‡Œç”¨äº†å’ŒDA projectä¸€æ ·çš„ubuntuï¼Œæœ€å¤§çš„å‘æ˜¯æ‰¾ä¸åˆ°coreï¼‰</p><ol><li><p>è®¾ç½®</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ulimit -c unlimited</span><br><span class="line">ulimit -a</span><br></pre></td></tr></table></figure></li><li><p>run</p></li><li><p>æ‰¾åˆ°coreæ–‡ä»¶</p><blockquote><p><a class="link"   href="https://askubuntu.com/questions/966407/where-do-i-find-the-core-dump-in-ubuntu-16-04lts" >Where do I find the core dump in ubuntu 16.04LTS?<i class="fas fa-external-link-alt"></i></a></p></blockquote></li><li><p>è®¾æƒé™</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /var/lib/apport/</span><br><span class="line">sudo chmod 777 coredump/</span><br></pre></td></tr></table></figure></li><li><p>coreç§»åŠ¨åˆ°gradingæ–‡ä»¶å¤¹</p></li><li><p>debug</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb grading core</span><br></pre></td></tr></table></figure><p> gdbä¸­å¸¸ç”¨</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where</span><br></pre></td></tr></table></figure></li></ol><hr><p>é™¤äº†ä»¥ä¸Šæ‚²ä¼¤çš„æ•…äº‹ï¼Œä¹Ÿæœ‰ä¸€äº›å¯å–œå¯è´ºçš„ä¹ æƒ¯ï¼Œç»™debugå¸¦äº†äº†å·¨å¤§å¸®åŠ©ï¼Œè¦ç»§ç»­ä¿æŒï¼š</p><ol><li>æ¯ä¸€éƒ¨åˆ†debugè¾“å‡ºç”¨å‚æ•°æ§åˆ¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¼€å…³ã€‚</li><li>ç»å¸¸commitã€‚é¿å…debugå˜æˆå†™bugæ—¶ï¼Œå›é€€éƒ½æ— å¤„å¯é€€ã€‚</li></ol><hr><p>å¤‡æ³¨ï¼šä¸‹æ–‡æ‰€æœ‰TMæŒ‡çš„æ˜¯Transactional Memoryï¼Œä¸æ˜¯å£åèŠ¬èŠ³ã€‚</p><h1 id="é˜¶æ®µä¸€"><a href="#é˜¶æ®µä¸€" class="headerlink" title="é˜¶æ®µä¸€"></a>é˜¶æ®µä¸€</h1><p>å†™å®Œreadã€writeç­‰åŸºç¡€æ“ä½œï¼Œå…ˆåŠ äº†ä¸ªå…¨å±€é”ï¼Œæ”¾åˆ°è™šæ‹Ÿæœºé‡Œæµ‹ä¸€ä¸‹é€»è¾‘ã€‚</p><h2 id="atomic-loadæ—¶segmentation-fault"><a href="#atomic-loadæ—¶segmentation-fault" class="headerlink" title="atomic_loadæ—¶segmentation fault"></a>atomic_loadæ—¶segmentation fault</h2><p>æœ¬åœ°è·‘æ²¡é—®é¢˜ï¼Œä½†æ˜¯è™šæ‹Ÿæœºé‡Œmake build-libs runå°±Segmentation faultã€‚ä¸€ç•ªæŠ˜è…¾åï¼Œå®šä½åˆ°æ˜¯atomic intergerçš„é—®é¢˜ã€‚ç”¨atomic_storeæˆ–è€…atomic_loadçš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚</p><h3 id="å°è¯•1"><a href="#å°è¯•1" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><p>åœ¨è®¡ç®—control structureçš„åç§»é‡æ—¶ï¼Œç¬¬ä¸€ä¸ªsegmentæ²¡è½¬(void*)ï¼Œäºæ˜¯å–åœ°å€å‡ºäº†é—®é¢˜ï¼Œatomic_loadæ—¶å°±å´©äº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">void</span>*)segment+segment-&gt;offset_control+CONTROL_SIZE*index</span><br></pre></td></tr></table></figure><p>æ”¹æˆè¿™æ ·æœ¬åœ°è·‘åˆå–ä¸åˆ°äº†ï¼Œå°±ç¦»è°±</p><h3 id="å°è¯•2ï¼ˆç»“æ„ä½“æŒ‡é’ˆï¼‰"><a href="#å°è¯•2ï¼ˆç»“æ„ä½“æŒ‡é’ˆï¼‰" class="headerlink" title="å°è¯•2ï¼ˆç»“æ„ä½“æŒ‡é’ˆï¼‰"></a>å°è¯•2ï¼ˆç»“æ„ä½“æŒ‡é’ˆï¼‰</h3><p>æ€€ç–‘æ˜¯ç»“æ„ä½“æŒ‡é’ˆçš„é—®é¢˜ï¼Œæ‰“å°äº†ä¸€ä¸‹ç›¸å…³çš„å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct segment* segment;</span><br><span class="line"></span><br><span class="line">DEBUG segment=0x7fb229405a30</span><br><span class="line">DEBUG (uint8_t*)segment=0x7fb229405a30</span><br><span class="line">DEBUG (void*)segment=0x7fb229405a30</span><br><span class="line">DEBUG &amp;segment=0x7ffedfedf530</span><br></pre></td></tr></table></figure><p>å‰ä¸‰ä¸ªæ˜¯ä¸€æ ·çš„ï¼Œç¬¦åˆé¢„æœŸã€‚é‚£ä¹ˆè®¡ç®—åç§»é‡çš„æ—¶å€™æ˜¯å¦ä¹Ÿä¸€æ ·ï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEBUG offset=208</span><br><span class="line"></span><br><span class="line">DEBUG segment+offset=0x7fb22940b530</span><br><span class="line">DEBUG (uint8_t*)segment+offset=0x7fb229405b00</span><br><span class="line">DEBUG (void*)segment+offset=0x7fb229405b00</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç®—å‡ºæ¥å°±ä¸ä¸€æ ·äº†</p><p>b530-5a30 = 0x5b00 = 23296 = 208 * 112<br>è€Œ112æ­£å¥½æ˜¯struct segmentçš„å¤§å°ï¼Œæ‰€ä»¥ä¸è½¬æ¢ç›´æ¥åŠ ï¼Œå•ä½æ˜¯struct size</p><p>5b00-5a30 = 0xd0 = 208<br>è¿™æ ·å°±æ˜¯å¯¹çš„ï¼Œæ‰€ä»¥åº”è¯¥å…ˆè½¬æ¢æŒ‡é’ˆç±»å‹</p><p>é‚£ä¹ˆå°è¯•1åŠ äº†(void*)åº”è¯¥æ–¹å‘æ˜¯å¯¹çš„</p><h2 id="controlä¿®æ”¹é”™è¯¯"><a href="#controlä¿®æ”¹é”™è¯¯" class="headerlink" title="controlä¿®æ”¹é”™è¯¯"></a>controlä¿®æ”¹é”™è¯¯</h2><p>æ¥ä¸Šä¸€ä¸ªbugï¼Œæ”¹å®Œä¹‹åï¼Œå‘ç°set control ownerå‡ºç°é—®é¢˜ï¼Œæ²¡æœ‰setæˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[owner=0 v=0 w=0 s=0]</span><br></pre></td></tr></table></figure><p>å†™å†…å­˜æˆåŠŸäº†ï¼Œåœ¨å‡½æ•°å†…éƒ¨æ‰“å°controlä¹Ÿæ˜¯å¯¹çš„ï¼Œä½†æ˜¯ç»“æŸä¹‹åæ•´ä½“print regionæ—¶ï¼Œcontrolæ˜¯ç©ºçš„</p><p>è§£å†³ï¼š<br>æ‰“å°å‘ç°ä¸¤æ¬¡ç”¨controlæ—¶åœ°å€ä¸ä¸€æ ·ã€‚æ˜¯åé¢ç®—controlèµ·å§‹åœ°å€æ²¡æœ‰æ”¹è¿‡æ¥ï¼Œä»æ˜¯ç›´æ¥ç®—çš„ï¼Œæ²¡æœ‰ç”¨å®šä¹‰çš„å®</p><p>æ”¹è¿‡æ¥ä¹‹åé¡ºä¾¿æ£€æŸ¥äº†ä¸€éï¼Œæ‰€æœ‰è®¡ç®—controlåœ°å€çš„ä½ç½®ï¼Œéƒ½æ˜¯ç”¨å®</p><h2 id="batché—´reset-controlåsegmentation-fault"><a href="#batché—´reset-controlåsegmentation-fault" class="headerlink" title="batché—´reset controlåsegmentation fault"></a>batché—´reset controlåsegmentation fault</h2><p>ç›®å‰æœ¬åœ°æµ‹è¯•ä¸€è½®ä¸­çš„transactionæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯tm_end()ã€è°ƒç”¨batcher_cleanup()ä¹‹åï¼Œæ‰“å°regionå‡ºé”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">--------segment1--------</span><br><span class="line">[0] 00000000 | 11111111 [owner=0 v=1 w=0 s=0]</span><br><span class="line">[1] 00000000 | 11111111 [owner=0 v=1 w=0 s=0]</span><br><span class="line">[2] 00000000 | 22222222 [owner=0 v=1 w=0 s=0]</span><br><span class="line">[3] 00000000 | 22222222 [owner=0 v=1 w=0 s=0]</span><br><span class="line">--------segment0--------</span><br><span class="line">zsh: segmentation fault  ./tm.o</span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯segment2ï¼Œè€Œä¸æ˜¯0</p><h3 id="å°è¯•1-1"><a href="#å°è¯•1-1" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><p>åœ¨batch_cleanup()ä¸­æ‰“å°äº†ä¸€ä¸‹segment id</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while(segment)&#123;</span><br><span class="line">        clean_up_segment(segment);</span><br><span class="line">        segment = segment-&gt;next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å‘ç°ç¬¬äºŒæ¬¡æ˜¯0<br>å¯èƒ½æ˜¯segmentæŒ‡é’ˆçš„é—®é¢˜<br>ä½†æ˜¯print_region()é‡Œé¢ä¹Ÿæœ‰è¿™ä¸ªå¾ªç¯ï¼Œæ²¡æœ‰é—®é¢˜ï¼Œé‚£è¾¹æ˜¯è¿™æ ·å†™çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while(segment != NULL)&#123;</span><br><span class="line">        print_segment(segment);</span><br><span class="line">        segment = segment-&gt;next;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ€»ä¸èƒ½æ˜¯!=NULLçš„é—®é¢˜å§<br>è¯•äº†ä¸€ä¸‹ï¼Œæœç„¶ä¸æ˜¯</p><h3 id="å°è¯•2"><a href="#å°è¯•2" class="headerlink" title="å°è¯•2"></a>å°è¯•2</h3><p>åœ¨batcher_cleanup()çš„å¾ªç¯é‡ŒåŠ äº†å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå¥½äº†ä¸€æ¬¡ï¼Œå†æµ‹åˆä¸è¡Œäº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">segment = (struct segment*)(segment-&gt;next);</span><br></pre></td></tr></table></figure><h3 id="å°è¯•3ï¼ˆå†…å­˜åˆ†é…ï¼‰"><a href="#å°è¯•3ï¼ˆå†…å­˜åˆ†é…ï¼‰" class="headerlink" title="å°è¯•3ï¼ˆå†…å­˜åˆ†é…ï¼‰"></a>å°è¯•3ï¼ˆå†…å­˜åˆ†é…ï¼‰</h3><p>æ‰“å°regionå’Œsegmentçš„åœ°å€éƒ½æ˜¯å¯¹çš„ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¯»å‡ºæ¥ä¸œè¥¿å°±ä¸å¯¹å‘¢ï¼Ÿ</p><p>ä»”ç»†çœ‹äº†ä¸‹ä¸¤å—segmentçš„åœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--------segment1-------- addr=0x7f9bc9c05a30</span><br><span class="line">[0] 00000000 | 11111111 [owner=1 v=0 w=1 s=1]</span><br><span class="line">[1] 00000000 | 11111111 [owner=1 v=0 w=1 s=1]</span><br><span class="line">[2] 00000000 | 22222222 [owner=1 v=0 w=1 s=1]</span><br><span class="line">[3] 00000000 | 22222222 [owner=1 v=0 w=1 s=1]</span><br><span class="line">--------segment2-------- addr=0x7f9bc9c05b30</span><br></pre></td></tr></table></figure><p>a30å’Œb30è¿™æ‰éš”äº†256ï¼Œè‚¯å®šä¼šæ’å§ï¼éš¾é“æ˜¯ä¸€å¼€å§‹åˆ†é…å°±æœ‰é—®é¢˜ï¼Ÿ</p><p>åˆå§‹åŒ–æ—¶çš„ä»£ç æ˜¯</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">segment</span>* <span class="title">segment</span>;</span></span><br><span class="line">    <span class="keyword">size_t</span> total_size = <span class="keyword">sizeof</span>(struct segment) + size*<span class="number">3</span> + size/align*<span class="keyword">sizeof</span>(<span class="keyword">atomic_uint_least64_t</span>);</span><br><span class="line">    <span class="keyword">if</span> (unlikely(posix_memalign((<span class="keyword">void</span>**)&amp;segment, align, total_size) != <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;create_segment failed. cannot align memory.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>çœ‹äº†ä¸‹referenceä»£ç ï¼Œå…ˆmallocçš„regionï¼Œåé¢æ‰posix_memalignçš„segment</p><p>æ”¹æˆ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span> total_size = <span class="keyword">sizeof</span>(struct segment) + size*<span class="number">3</span> + size/align*<span class="keyword">sizeof</span>(<span class="keyword">atomic_uint_least64_t</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">segment</span>* <span class="title">segment</span> =</span> (struct segment*) <span class="built_in">malloc</span>(total_size);</span><br><span class="line">    <span class="keyword">if</span> (unlikely(posix_memalign((<span class="keyword">void</span>**)&amp;segment, align, total_size) != <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;create_segment failed. cannot align memory.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p> æˆåŠŸï¼</p><p> ç°åœ¨çš„åœ°å€æ˜¯<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">--------segment1-------- addr=0x7fde98405b20</span><br><span class="line">[0] 00000000 | 11111111 [owner=0 v=1 w=0 s=0]</span><br><span class="line">[1] 00000000 | 11111111 [owner=0 v=1 w=0 s=0]</span><br><span class="line">[2] 00000000 | 22222222 [owner=0 v=1 w=0 s=0]</span><br><span class="line">[3] 00000000 | 22222222 [owner=0 v=1 w=0 s=0]</span><br><span class="line">--------segment2-------- addr=0x7fde98405d10</span><br><span class="line">[0] 00000000 | 00000000 [owner=0 v=0 w=0 s=0]</span><br><span class="line">[1] 00000000 | 00000000 [owner=0 v=0 w=0 s=0]</span><br><span class="line">[2] 00000000 | 00000000 [owner=0 v=0 w=0 s=0]</span><br><span class="line">[3] 00000000 | 00000000 [owner=0 v=0 w=0 s=0]</span><br></pre></td></tr></table></figure><br>d10-b20 = 0x1f0 = 496</p><h2 id="é˜¶æ®µä¸€æµ‹è¯•"><a href="#é˜¶æ®µä¸€æµ‹è¯•" class="headerlink" title="é˜¶æ®µä¸€æµ‹è¯•"></a>é˜¶æ®µä¸€æµ‹è¯•</h2><p>ä¸¢è¿›è™šæ‹Ÿæœºè·‘grading<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-06 PM11.54.31.jpg"                      width=600                ><br>ç”¨æ—¶å¤ªä¹…ï¼Œæ­£å¸¸ã€‚ä½†æ˜¯æ²¡æœ‰segmentation faultäº†ï¼Œåº”è¯¥read writeæ“ä½œä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜äº†ï¼Œç¬¬ä¸€æ­¥å®Œæˆï¼è€¶ï¼</p><p>åœæ‰äº†ä¸€äº›printï¼Œå‡å°‘ä¸å¿…è¦çš„æ—¶é—´æµªè´¹ï¼Œæµ‹TMç›¸å…³å‡½æ•°</p><h2 id="mallocé”™è¯¯"><a href="#mallocé”™è¯¯" class="headerlink" title="mallocé”™è¯¯"></a>mallocé”™è¯¯</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[batcher_cleanup] region addr=0x7f1bc8000b20</span><br><span class="line">[batcher_cleanup] clean segment 1, addr=0x7f1bc8001530</span><br><span class="line">grading: malloc.c:2401: sysmalloc: Assertion `(old_top == initial_top (av) &amp;&amp; old_size == 0) || ((unsigned long) (old_size) &gt;= MINSIZE &amp;&amp; prev_inuse (old_top) &amp;&amp; ((unsigned long) old_end &amp; (pagesize - 1)) == 0)&#x27; failed.</span><br><span class="line">Makefile:40: recipe for target &#x27;run&#x27; failed</span><br></pre></td></tr></table></figure><p>åƒæ˜¯ä¸ªå’Œå†…å­˜åˆ†é…æœ‰å…³çš„bug</p><blockquote><p>Why do I get a C malloc assertion failure?<br>æ£€æŸ¥clean_up_segmenté‡Œçš„å¾ªç¯</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">size_t</span> i=<span class="number">0</span>; i&lt;segment-&gt;size; i++)</span><br></pre></td></tr></table></figure><p>ç»ˆæ­¢æ¡ä»¶å†™æˆäº†segment-&gt;sizeï¼Œåº”è¯¥æ˜¯size/align<br>è§£å†³ï¼</p><h2 id="æ—¶é—´å¤ªé•¿"><a href="#æ—¶é—´å¤ªé•¿" class="headerlink" title="æ—¶é—´å¤ªé•¿"></a>æ—¶é—´å¤ªé•¿</h2><p>ç°åœ¨gradingè¾“å‡ºæ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[write]tx_id=1 seg_id=1 index=63 size=8</span><br><span class="line">[write]tx_id=1 seg_id=1 index=64 size=8</span><br><span class="line">[write]tx_id=1 seg_id=1 index=65 size=8</span><br><span class="line">[write]tx_id=1 seg_id=1 index=66 size=8</span><br><span class="line">[tm_end] id=1</span><br><span class="line"></span><br><span class="line">[batcher_cleanup]region addr=0x7f3a18000b20</span><br><span class="line">transaction created. id=2 addr=0x7f3a18001e30</span><br><span class="line">[read]tx_id=2 seg_id=1 index=3 size=8</span><br><span class="line">âª *** EXCEPTION ***</span><br><span class="line">â© Transactional library takes too long to process the transactions</span><br></pre></td></tr></table></figure><p>å¯èƒ½æ˜¯ç”¨æ—¶å¤ªé•¿ï¼Œä¹Ÿå¯èƒ½æ˜¯readæœ‰é—®é¢˜ï¼Œå…ˆæ£€æŸ¥åè€…</p><p>å•ç‹¬æ‰“äº†ä¸€ä¸‹readçš„è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[read align]tx_id=2 seg_id=1 index=64</span><br><span class="line">[read align]tx_id=2 seg_id=1 index=65</span><br><span class="line">[read align]tx_id=2 seg_id=1 index=66</span><br><span class="line">âª *** EXCEPTION ***</span><br><span class="line">â© Transactional library takes too long to process the transactions</span><br></pre></td></tr></table></figure><p>å¯ä»¥è·‘ï¼Œé‚£åº”è¯¥å°±æ˜¯ç”¨æ—¶å¤ªé•¿çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯é€»è¾‘é—®é¢˜<br>é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹æ”¹å¹¶å‘ç›¸å…³çš„ä»£ç äº†</p><h1 id="è™šå‡çš„é˜¶æ®µäºŒ"><a href="#è™šå‡çš„é˜¶æ®µäºŒ" class="headerlink" title="è™šå‡çš„é˜¶æ®µäºŒ"></a>è™šå‡çš„é˜¶æ®µäºŒ</h1><p>å‰é¢åŸºæœ¬æµ‹è¯•äº†TMçš„readã€writeã€allocåŠŸèƒ½ï¼Œç°åœ¨æŠŠå…¨å±€é”æ¢æˆbatcher</p><h2 id="æ—¶é—´å¤ªé•¿-1"><a href="#æ—¶é—´å¤ªé•¿-1" class="headerlink" title="æ—¶é—´å¤ªé•¿"></a>æ—¶é—´å¤ªé•¿</h2><p>ç°åœ¨çš„é—®é¢˜æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">âª *** EXCEPTION ***</span><br><span class="line">â© Transactional library takes too long to process the transactions</span><br><span class="line">Makefile:40: recipe for target &#x27;run&#x27; failed</span><br></pre></td></tr></table></figure><h3 id="å°è¯•1-2"><a href="#å°è¯•1-2" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><p>æŠŠå‚æ•°è°ƒå°äº†è¿˜æ˜¯å¾ˆæ…¢<br>çœ‹äº†ä¸‹å…·ä½“è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">transaction created. id=32 addr=0x7f35dc00d3d0 log_size=100</span><br><span class="line">[enter] current blocking length=1</span><br><span class="line">[read]tx_id=32 seg_id=1 index=3 size=8</span><br><span class="line">transaction created. id=33 addr=0x7f35dc00da40 log_size=100</span><br><span class="line">[enter] current blocking length=1</span><br></pre></td></tr></table></figure><p>ä¼¼ä¹batcherçš„enteræœ‰é—®é¢˜ï¼Œblocking lengthä¸å¯¹</p><p>â€¦<br>ä¸€å¼€å§‹åˆå§‹åŒ–æŠŠ1å†™æˆ0äº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> const_zero = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> const_one = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><h3 id="å°è¯•2ï¼ˆé€»è¾‘é”™è¯¯ï¼‰"><a href="#å°è¯•2ï¼ˆé€»è¾‘é”™è¯¯ï¼‰" class="headerlink" title="å°è¯•2ï¼ˆé€»è¾‘é”™è¯¯ï¼‰"></a>å°è¯•2ï¼ˆé€»è¾‘é”™è¯¯ï¼‰</h3><p>æ”¹batcherã€æ¢å›é”ï¼Œæ€»æ˜¯ç¬¬ä¸€ä¸ªtransactionå¯ä»¥è·‘åˆ°batcher cleanupï¼Œç¬¬äºŒæ‰¹å°±ä¸è¡Œï¼Œä¹Ÿè®¸æ˜¯ä¸­é—´æ¸…ç†æœ‰é—®é¢˜<br>ä½†æ˜¯æœ¬åœ°æµ‹è¯•å¹¶æ‰“å°regionï¼Œåº”è¯¥æ²¡é—®é¢˜</p><p>åœ¨è™šæ‹Ÿæœºé‡ŒåŠ å…¥äº†å…·ä½“çš„R/Wè¾“å‡ºï¼Œå‘ç°ç¬¬äºŒè½®çš„readå¡ä½äº†<br>ç»§ç»­æŸ¥å‘ç°readæ²¡é—®é¢˜ï¼Œä½†æ˜¯readä¹‹åwriteå°±å†™ä¸è¿›å»äº†<br>å‘ç°æ˜¯é€»è¾‘é—®é¢˜ï¼šå†™çš„æ—¶å€™ï¼Œå¦‚æœè¿˜æ²¡å†™è¿‡ï¼Œä¼šå°è¯•gain_ownerï¼Œä½†æ˜¯å¦‚æœè‡ªå·±å·²ç»è¯»è¿‡äº†ï¼Œéœ€è¦åˆ¤æ–­owneræ˜¯è‡ªå·±</p><p>ä½†æ˜¯è™šæ‹Ÿæœºé‡Œè·‘è¿˜æ˜¯ä¸å¯¹ï¼Œç¬¬ä¸€æ¬¡read alignè¿”å›äº†ï¼Œä½†æ˜¯æ²¡æœ‰åç»­äº†<br>å‘ç°æ˜¯tm_read()æœ€ååº”è¯¥return flagï¼Œå†™æˆäº†return falseğŸ¤ª</p><p>ç°åœ¨æŠ¥é”™å˜æˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â© Violated isolation or atomicity</span><br></pre></td></tr></table></figure><p>ç»ˆäºå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†</p><h1 id="é˜¶æ®µä¸€â€™"><a href="#é˜¶æ®µä¸€â€™" class="headerlink" title="é˜¶æ®µä¸€â€™"></a>é˜¶æ®µä¸€â€™</h1><h2 id="Violated-isolation-or-atomicity"><a href="#Violated-isolation-or-atomicity" class="headerlink" title="Violated isolation or atomicity"></a>Violated isolation or atomicity</h2><p>ç°åœ¨è¿˜æ˜¯ç›´æ¥åŠ é”ï¼Œatomicityæœ‰é—®é¢˜åªèƒ½æ˜¯é€»è¾‘é—®é¢˜ï¼Œä¸€å¤œå›åˆ°é˜¶æ®µä¸€ï¼Œåˆå¾—å¼€å§‹æ‰¾readã€writeã€allocçš„bug</p><p>å¤šæ¬¡æµ‹è¯•ï¼ŒæŠ¥é”™æœ‰2ç§ï¼Œä¸€ä¸ªæ˜¯violate atomicityï¼Œå¦ä¸€ä¸ªæ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[tm_begin 2]</span><br><span class="line">[tm_end 2]</span><br><span class="line">[tm_begin 3]</span><br><span class="line">[tm_end 3]</span><br><span class="line">[tm_begin 4]</span><br><span class="line">[tm_end 4]</span><br><span class="line">âª *** EXCEPTION ***</span><br><span class="line">â© Transactional library takes too long to process the transactions</span><br></pre></td></tr></table></figure><h3 id="å°è¯•1-3"><a href="#å°è¯•1-3" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><p>æ€€ç–‘æ˜¯segmentçš„é—®é¢˜ï¼Œå› ä¸ºæœ¬åœ°æ²¡æ€ä¹ˆæµ‹allocã€free<br>ä½†æ˜¯åŠ äº†è¾“å‡ºï¼Œå‘ç°å¹¶æ²¡æœ‰è°ƒè¿‡è¿™ä¸¤ä¸ªå‡½æ•°</p><h3 id="å°è¯•2-1"><a href="#å°è¯•2-1" class="headerlink" title="å°è¯•2"></a>å°è¯•2</h3><p>å¥‡æ€ªäº†ï¼Œçœ‹è¾“å‡ºæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œåˆ°åº•æ˜¯å“ªå¡ä½äº†ï¼Ÿ<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-09 AM10.17.59.jpg"                      width=600                ><br>å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¯ä»¥ç»§ç»­è·‘ï¼Œè·‘åˆ°æœ€åviolate atomicity</p><p>å®šä½åˆ°ä¸€ä¸ªbugï¼å…ˆreadå†writeæ²¡æœ‰å†™write_flagï¼<br>ä½†æ˜¯å¯¹è¿™é‡Œå½±å“ä¸å¤§</p><h3 id="å°è¯•3ï¼ˆé€»è¾‘é”™è¯¯ï¼‰"><a href="#å°è¯•3ï¼ˆé€»è¾‘é”™è¯¯ï¼‰" class="headerlink" title="å°è¯•3ï¼ˆé€»è¾‘é”™è¯¯ï¼‰"></a>å°è¯•3ï¼ˆé€»è¾‘é”™è¯¯ï¼‰</h3><p>å®šä½åˆ°yigebugï¼å…ˆwriteå†readï¼Œè¯»çš„æ˜¯æ—§å€¼ï¼è¿™ä¸ªé—®é¢˜æ¯”è¾ƒä¸¥é‡<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-09 AM10.48.06.jpg"                      width=600                ></p><p>ç°åœ¨çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// read the writable copy into target</span></span><br><span class="line">read_readable_copy(target, segment, index);</span><br></pre></td></tr></table></figure><p> è¿™æ˜æ˜¾è°ƒçš„å‡½æ•°éƒ½å’Œæ³¨é‡Šå†™çš„æ„æ€ä¸ä¸€æ ·å•ŠğŸ¤ª</p><h2 id="æ—¶é—´å¤ªé•¿-2"><a href="#æ—¶é—´å¤ªé•¿-2" class="headerlink" title="æ—¶é—´å¤ªé•¿"></a>æ—¶é—´å¤ªé•¿</h2><p> ç°åœ¨çš„æŠ¥é”™éƒ½æ˜¯æ—¶é—´å¤ªé•¿ï¼Œä¼šä¸ä¼šæ˜¯å…¶å®ƒçº¿ç¨‹è¢«å µå¤ªä¹…äº†ï¼Ÿ</p><p>æŠŠçº¿ç¨‹å‡åˆ°1ä¸ªï¼Œå¤§éƒ¨åˆ†è¿˜æ˜¯æ—¶é—´å¤ªé•¿ï¼Œæœ‰ä¸€ä¸ªè·‘å®Œäº†ï¼æ„ŸåŠ¨ï¼<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-09 AM11.03.47.jpg"                      width=600                ></p><p>æŠŠSlow trigger factorä»8è°ƒåˆ°1024ï¼Œéƒ½è·‘å®Œäº†ï¼æ„ŸåŠ¨ï¼<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œå•çº¿ç¨‹çš„æ—¶å€™ï¼Œread writeæ²¡é—®é¢˜äº†ï¼ï¼ˆæµ‹è¯•é‡Œå¥½åƒæ²¡æœ‰alloc freeï¼Ÿï¼‰</p><p>æ”¹åˆ°2ä¸ªçº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥è·‘ï¼å‘œå‘œå‘œå‘œå‘œ</p><p>ä¸€æ³¢æœªå¹³ä¸€æ³¢åˆèµ·ï¼Œæ­¤æ—¶è™šæ‹Ÿæœºå‡ºç°äº†bug<br>ç½¢äº†ï¼Œåšé¥­å»</p><p>ä¸‹åˆã€‚<br>æŠŠgradingçš„å‚æ•°å…¨éƒ¨è°ƒå›é»˜è®¤ï¼Œé™¤äº†slow_factorè®¾æˆ1024<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-09 PM2.43.00.jpg"                      width=600                ><br>å¯¹äº†å¯¹äº†ï¼å¯ä»¥å¼€å§‹å†™batcheräº†ï¼</p><h1 id="é˜¶æ®µäºŒ"><a href="#é˜¶æ®µäºŒ" class="headerlink" title="é˜¶æ®µäºŒ"></a>é˜¶æ®µäºŒ</h1><p>å¼€å§‹æµ‹batcherï¼Œè¿™æ¬¡è¦ä¸€æ­¥ã€ä¸€æ­¥ã€ä¸€æ­¥æ¥</p><h2 id="Too-long"><a href="#Too-long" class="headerlink" title="Too long"></a>Too long</h2><p>å¼€å››ä¸ªçº¿ç¨‹æ—¶ï¼Œæœ‰æ—¶ä¼šå¡ä½<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-10 PM4.45.21.jpg"                      width=600                ><br>æ„Ÿè§‰æ˜¯æŸä¸ªtransactionæ—¶é—´å¤ªé•¿å¯¼è‡´çš„</p><p>å‘ç°é—®é¢˜ï¼å¦‚æœæœ‰æ“ä½œabortäº†ï¼Œç”¨æˆ·ä¸ä¼šè°ƒtm_end</p><p>åœ¨read writeå¤±è´¥æ—¶è°ƒleave()ï¼Œè§£å†³</p><h2 id="æ²¡æœ‰coreæ–‡ä»¶"><a href="#æ²¡æœ‰coreæ–‡ä»¶" class="headerlink" title="æ²¡æœ‰coreæ–‡ä»¶"></a>æ²¡æœ‰coreæ–‡ä»¶</h2><p>æƒ³ç”¨coredump debugï¼Œè¿è¡Œæ˜¾ç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make: *** [run] Segmentation fault (core dumped)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ²¡æœ‰coreæ–‡ä»¶</p><p>æœ€ååœ¨â†“çš„æœ€åä¸€ä¸ªå›ç­”æ‰¾åˆ°è§£å†³<br><a class="link"   href="https://askubuntu.com/questions/966407/where-do-i-find-the-core-dump-in-ubuntu-16-04lts" >Where do I find the core dump in ubuntu 16.04LTS?<i class="fas fa-external-link-alt"></i></a></p><blockquote><p>found the core dunp in /var/lib/apport/coredump/</p></blockquote><p>coreåœ¨ä¸åŒæ–‡ä»¶å¤¹ï¼Œæƒ³ç§»åˆ°åŒä¸€ä¸ªæ–‡ä»¶å¤¹æ¯”è¾ƒæ–¹ä¾¿ï¼Œæ‹–çš„æ—¶å€™permission deniedï¼Œå…ˆæ”¹äº†ä¸‹æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 777 coredump/</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥debugäº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb grading core</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯leave()çš„é—®é¢˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#0  0x00007f13e809812c in leave ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br><span class="line">[Current thread is 1 (Thread 0x7f13e929c700 (LWP 1903))]</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ²¡æœ‰æ˜¾ç¤ºè¡Œå·ï¼Œåœ¨ç¼–è¯‘æ—¶åŠ -gï¼ˆæ”¹Makefileï¼‰ä¹Ÿä¸è¡Œ</p><h2 id="Violated-isolation-or-atomicity-1"><a href="#Violated-isolation-or-atomicity-1" class="headerlink" title="Violated isolation or atomicity"></a>Violated isolation or atomicity</h2><p>æ·»åŠ äº†read logã€write logã€transaction logï¼ŒåŠ é”æµ‹è¯•é€šè¿‡ï¼Œæ”¹æˆbatcheråæŠ¥é”™</p><p>å‘ç°1æˆ–2ä¸ªçº¿ç¨‹æ—¶ï¼Œç»“æœæ­£ç¡®ï¼Œ4ä¸ªçº¿ç¨‹ä¼šå‡ºé”™</p><p>å‘ç°ç«Ÿç„¶æ˜¯å› ä¸ºå¼€ç€DEBUG_READå’ŒDEBUG_WRITEï¼Œå¯èƒ½æ˜¯å†™debug outputæ—¶åŒæ—¶è®¿é—®ï¼Œä½†æ˜¯æ²¡æœ‰åšåŒæ­¥æ§åˆ¶ï¼Œå¯¼è‡´å‡ºé”™ã€‚å…³æ‰è¾“å‡ºå°±å¥½äº†</p><h2 id="Violated-consistency"><a href="#Violated-consistency" class="headerlink" title="Violated consistency"></a>Violated consistency</h2><p>ç°åœ¨å¤§éƒ¨åˆ†æ—¶é—´æ²¡é—®é¢˜ï¼Œæœ‰æ—¶ä¼šå‡ºè¿™ä¸ªé”™</p><p>é‡æ–°è¯»äº†ä¸€ä¸‹consistencyçš„å®šä¹‰ã€‚éš¾é“æ˜¯å¦‚æœprocessè¯»äº†ä¸€ä¸ªå€¼ï¼Œåé¢è¿™ä¸ªå€¼è¢«æ”¹äº†ï¼Œä¹Ÿå¾—abortï¼Ÿä½†æ˜¯å¦‚æœè¢«è¯»è¿‡ï¼Œè¿™ä¸ªå€¼åé¢åº”è¯¥ä¸èƒ½ä¿®æ”¹äº†ã€‚</p><h3 id="å°è¯•1-4"><a href="#å°è¯•1-4" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><p>ä¹Ÿè®¸æ˜¯å› ä¸ºread alignå’Œwrite alignä¸­ï¼Œæœ‰æ—¶æœ‰å¤šä¸ªåˆ¤æ–­ï¼Œè¿™äº›åˆ¤æ–­å•ç‹¬éƒ½æ˜¯atomicçš„ï¼Œä½†æ˜¯åˆåœ¨ä¸€èµ·å°±ä¸æ˜¯äº†ã€‚<br>æ”¹äº†ä¸€äº›é€»è¾‘ï¼Œåˆå¹¶åˆ¤æ–­å’Œäº¤æ¢ï¼Œè¿˜æ˜¯ä¸å¯¹ã€‚</p><h3 id="å°è¯•2-2"><a href="#å°è¯•2-2" class="headerlink" title="å°è¯•2"></a>å°è¯•2</h3><p>åœ¨workload.hppé‡ŒåŠ äº†ä¸€å †è¾“å‡ºï¼Œæ‰“å°å…·ä½“æ˜¯å“ªé‡Œå‡ºé”™ï¼Œå‘ç°ä¸€ä¸ªå¸¸è§é—®é¢˜æ˜¯check()ä¸­counter!=0<br>å¯æ˜¯è¿™ä¸ªcounteræ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</p><figure class="highlight hpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Shared&lt;<span class="keyword">size_t</span>&gt; counter&#123;tx, tm.<span class="built_in">get_start</span>()&#125;;</span><br></pre></td></tr></table></figure><p> æ‰¾åˆ°å®šä¹‰<br> <figure class="highlight hpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>:</span><br><span class="line">       Shared&lt;<span class="keyword">size_t</span>&gt;         count; <span class="comment">// Number of allocated accounts in this segment</span></span><br><span class="line">       </span><br><span class="line">       <span class="comment">/** Binding constructor.</span></span><br><span class="line"><span class="comment">        * @param tx      Associated pending transaction</span></span><br><span class="line"><span class="comment">        * @param address Block base address</span></span><br><span class="line"><span class="comment">       **/</span></span><br><span class="line">       <span class="built_in">AccountSegment</span>(Transaction&amp; tx, <span class="keyword">void</span>* address): count&#123;tx, address&#125;, next&#123;tx, count.<span class="built_in">after</span>()&#125;, parity&#123;tx, next.<span class="built_in">after</span>()&#125;, accounts&#123;tx, parity.<span class="built_in">after</span>()&#125; &#123;&#125;</span><br></pre></td></tr></table></figure><br>å¥½åƒå’Œtransactionæ•°é‡æœ‰å…³ï¼Œä¼šä¸ä¼šæ˜¯æœ€åæ²¡æœ‰freeï¼Ÿ<br>å¹¶ä¸æ˜¯ã€‚</p><p>1æˆ–2ä¸ªçº¿ç¨‹çš„æ—¶å€™æ²¡äº‹ï¼Œ3ä¸ªä»¥ä¸Šå‡ºé”™ï¼Œéš¾é“æ˜¯OTHERçš„é—®é¢˜ï¼Ÿ<br>åˆæ£€æŸ¥äº†ä¸€éé€»è¾‘æ„Ÿè§‰ä¹Ÿæ²¡ä»€ä¹ˆæ¯›ç—…</p><h3 id="å°è¯•3"><a href="#å°è¯•3" class="headerlink" title="å°è¯•3"></a>å°è¯•3</h3><p>ç°æœ‰çš„2ä¸ªæŠ¥é”™åˆ†åˆ«æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">------WL5------ counter=16</span><br><span class="line">[1011 leave]&#123;979&#125; committed=1 remain=0 blocked=0</span><br><span class="line">[1011 tm_end]</span><br><span class="line">â© Violated consistency</span><br></pre></td></tr></table></figure><p>å’Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">------WL1------ sum=61</span><br><span class="line">------WL1------ init_balance=10</span><br><span class="line">------WL1------ count=6</span><br><span class="line">Violated isolation or atomicity</span><br></pre></td></tr></table></figure><p>åè€…ä¼¼ä¹å¯¼è‡´äº†å‰è€…ï¼Œéœ€è¦å…ˆè§£å†³ã€‚<br>ä¸€ä¸ªç°è±¡æ˜¯ï¼Œæ¯æ¬¡å·®çš„å€¼éƒ½æ˜¯1ï¼Œè€Œä¸ä¼šæ›´å¤§<br>åŠ åˆ°8ä¸ªçº¿ç¨‹ä¼šå‡ºç°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">------WL1------ sum=637</span><br><span class="line">------WL1------ init_balance=10</span><br><span class="line">------WL1------ count=64</span><br></pre></td></tr></table></figure><p>æ€»ä¹‹åŸºæœ¬åå·®ä¸å¤§ï¼Œåƒæ˜¯å“ªé‡Œæœ‰ä¸ªç»†èŠ‚ä¸å¯¹ï¼Œä½†æ˜¯åˆ°åº•åœ¨å“ªå•ŠğŸ’¥</p><p>ä½†æ˜¯counteræœ€åçš„çš„åå·®åˆå¾ˆå¤§â€¦</p><p>æŠŠtransactionæ•°é‡å‡å°ä¹‹åï¼Œåªå‘ç°Violated consistencyï¼Œè€Œæ²¡æœ‰Violated isolation or atomicityï¼Œä¸ä¼šæ˜¯å“ªé‡Œæº¢å‡ºäº†å§ï¼Ÿ<br>å°±10å’Œ100çš„åŒºåˆ«ï¼Œä¹Ÿä¸è‡³äºå•Šã€‚</p><h3 id="å°è¯•4"><a href="#å°è¯•4" class="headerlink" title="å°è¯•4"></a>å°è¯•4</h3><p>åˆå¼€å§‹è¯»workload.hppï¼Œè¿™ä¸ªcountåº”è¯¥å°±æ˜¯æ‰€æœ‰segmenté‡Œé¢accountå€¼çš„å’Œï¼ŒåŠ èµ·æ¥åº”è¯¥ç­‰äºé¢„æœŸã€‚é‚£ä¹ˆè¿™ä¸ªå€¼é”™äº†ï¼Œå…¶å®è¿˜æ˜¯readã€writeçš„é—®é¢˜ã€‚</p><p>ç»™readã€writeåŠ é”ï¼Œè¿˜æ˜¯åŒæ ·çš„æŠ¥é”™ã€‚é‚£ä¹ˆéš¾é“æ˜¯batcherçš„é—®é¢˜ï¼Ÿ</p><p>åˆå¤šæ‰“äº†ä¸€ç‚¹è¾“å‡ºï¼Œä¸Šé¢Violated isolation or atomicityè¿™ä¸ªé—®é¢˜éƒ½æ˜¯å‡ºç°åœ¨ Long read-only transaction, summing the balance of each accountä¸­ï¼Œå…¶å®ä¹Ÿå°±æ˜¯åœ¨æ£€æŸ¥å®é™…è¿›è¡Œæ“ä½œçš„short transactionçš„ç»“æœæ˜¯å¦æ­£ç¡®ã€‚</p><p>å†æƒ³æƒ³ï¼Œå‚æ•°å°çš„æ—¶å€™ï¼Œå‡ºé”™è¯¯ä¸€ï¼Œå‚æ•°å¤§çš„æ—¶å€™ï¼Œå‡ºä¸€å’ŒäºŒï¼Œé‚£ä¹ˆè¿˜æ˜¯åº”è¯¥ä¸€æ˜¯æ›´æ ¹æœ¬çš„ã€‚è€Œä¸€çš„å…³é”®åœ¨äºcounterï¼Œæœ€ååº”è¯¥ä¸º0ã€‚é‚£ä¹ˆè¿™ä¸ªcounteråˆ°åº•æ˜¯ä¸ªä»€ä¹ˆå•Šï¼Ÿï¼Ÿï¼Ÿ</p><h3 id="å°è¯•5ï¼ˆCASæ¡ä»¶ï¼‰"><a href="#å°è¯•5ï¼ˆCASæ¡ä»¶ï¼‰" class="headerlink" title="å°è¯•5ï¼ˆCASæ¡ä»¶ï¼‰"></a>å°è¯•5ï¼ˆCASæ¡ä»¶ï¼‰</h3><p>ä»”ç»†è¯»è¾“å‡ºï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªbugï¼ï¼ï¼ä¸€ä¸‹åˆäº†ï¼Œç»ˆäºè§åˆ°å®é™…çš„bugåœ¨å“ªäº†ï¼ï¼ï¼ç¬¬ä¸€æ¬¡è§åˆ°bugè¿™ä¹ˆæ¿€åŠ¨ã€‚</p><p>æœ‰writeä¹‹åï¼Œç«Ÿç„¶åˆè¯»æˆåŠŸï¼Œè¿˜æ”¹äº†ownerï¼Œç®€ç›´ç¦»è°±ã€‚<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-12 PM5.57.15.jpg"                      width=600                ></p><p>å¤šåŠ äº†ä¸€äº›è¾“å‡ºï¼Œè½»æ¾å¤ç°è¿™ä¸ªbugã€‚éƒ½æ˜¯æœ‰2ä¸ªtransactionï¼ŒAè¯»å†™ä½ç½®1ã€ä½ç½®2ï¼ŒBåœ¨Aä¹‹åè¯»å†™ä½ç½®3ã€ä½ç½®2ã€‚æ­£ç¡®æƒ…å†µåº”è¯¥æ˜¯Bè¯»å†™ä½ç½®2å¤±è´¥ï¼Œä½†æ˜¯ç°åœ¨ æˆåŠŸäº†ã€‚</p><p>é—®é¢˜åœ¨äºread_align()</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if the word has not been written in the current epoch then</span></span><br><span class="line"><span class="comment">// add the transaction into the â€œaccess setâ€ (if not already in); </span></span><br><span class="line"><span class="comment">// try set owner</span></span><br><span class="line"><span class="keyword">uint_least64_t</span> read_and_set_owner = tr-&gt;id &lt;&lt; <span class="number">32</span> | valid;</span><br><span class="line"><span class="keyword">if</span>(atomic_compare_exchange_strong(cur_control, &amp;load_control, read_and_set_owner))</span><br></pre></td></tr></table></figure><p>æ¯”è¾ƒçš„expectedå€¼ä¸åº”è¯¥æ˜¯loadåˆ°çš„å€¼ï¼è€Œæ˜¯åˆ¤æ–­å¦‚æœowneræ˜¯è‡ªå·±ï¼Œåº”è¯¥æ˜¯çš„å€¼ã€‚</p><h2 id="Reseté”™è¯¯"><a href="#Reseté”™è¯¯" class="headerlink" title="Reseté”™è¯¯"></a>Reseté”™è¯¯</h2><p>æ”¹å®Œè¿™ä¸ªåˆå‘ç°ä¸€ä¸ªbug<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-12 PM7.41.39.jpg"                      width=600                ><br>Aå†™äº†ä½ç½®9ï¼Œä¹‹åBä¹Ÿæƒ³å†™ä½ç½®9ä½†æ²¡å†™æˆåŠŸï¼Œæœ€åæ²¡æœ‰äº¤æ¢validã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼ŒBå…ˆé€€å‡ºï¼Œè°ƒç”¨clean flagï¼Œæ­¤æ—¶ç”±äºBæ²¡æœ‰æˆåŠŸï¼Œç›´æ¥å°†controlæ¸…ç©ºäº†ï¼Œ9å†™çš„WRITE_FLAGä¹Ÿæ²¡æœ‰äº†ã€‚<br>åŠ ä¸€ä¸ªåˆ¤æ–­ï¼Œåªæœ‰è‡ªå·±æ˜¯owneræ—¶æ‰resetï¼Œåº”è¯¥å¯ä»¥è§£å†³é—®é¢˜ã€‚</p><p>ç°åœ¨æ²¡æœ‰Violated isolation or atomicityçš„é—®é¢˜äº†ï¼ˆæˆ–è€…æ²¡ç¢°åˆ°ï¼‰ã€‚<br>æš‚æ—¶æµ‹è¯•å¯ä»¥æ­£å¸¸è·‘å®Œäº†ã€‚</p><h1 id="é˜¶æ®µä¸‰"><a href="#é˜¶æ®µä¸‰" class="headerlink" title="é˜¶æ®µä¸‰"></a>é˜¶æ®µä¸‰</h1><p>batcherçš„åŠŸèƒ½å†™å¯¹äº†ï¼ˆä½†æ„¿ï¼‰ï¼Œæ¥ä¸‹æ¥å°è¯•åœ¨æœåŠ¡å™¨ä¸Šè·‘é€šï¼ˆ20 threadså’Œ10000 transaction per workerï¼‰ã€‚</p><h2 id="Floating-point-exception"><a href="#Floating-point-exception" class="headerlink" title="Floating point exception"></a>Floating point exception</h2><p>ä¸ºäº†é¿å…æ¯æ¬¡clean segmentséå†æ•´ä¸ªå†…å­˜ï¼Œå°†ä¿®æ”¹è¿‡çš„åœ°æ–¹è®°äº†logï¼Œä½†æ˜¯ä¸ŠæœåŠ¡å™¨logä¼šçˆ†æ‰ã€‚<br>æ”¹æˆäº†overflowçš„æ—¶å€™reallocå››å€ç©ºé—´</p><p>ç„¶åå°±å‡ºç°äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make: *** [run] Floating point exception (core dumped)</span><br></pre></td></tr></table></figure><h3 id="å°è¯•1-5"><a href="#å°è¯•1-5" class="headerlink" title="å°è¯•1"></a>å°è¯•1</h3><p>gdb grading coreä¸€ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[New LWP 2519]</span><br><span class="line">[New LWP 2518]</span><br><span class="line">[New LWP 2509]</span><br><span class="line">Core was generated by `./grading 453 ../reference.so ../338094.so&#x27;.</span><br><span class="line">Program terminated with signal SIGSEGV, Segmentation fault.</span><br><span class="line">#0  0x00007f34bc478f31 in ?? ()</span><br><span class="line">[Current thread is 1 (LWP 2517)]</span><br><span class="line">(gdb) where</span><br><span class="line">#0  0x00007f34bc478f31 in ?? ()</span><br><span class="line">#1  0x0000000000000387 in ?? ()</span><br><span class="line">#2  0x00007f34b8000b20 in ?? ()</span><br><span class="line">#3  0x0000000000000006 in ?? ()</span><br></pre></td></tr></table></figure><p>â€¦è¯´äº†ä¸ªå¯‚å¯</p><h3 id="å°è¯•2ï¼ˆfreeä¹‹åï¼‰"><a href="#å°è¯•2ï¼ˆfreeä¹‹åï¼‰" class="headerlink" title="å°è¯•2ï¼ˆfreeä¹‹åï¼‰"></a>å°è¯•2ï¼ˆfreeä¹‹åï¼‰</h3><p>å‘ç°æ˜¯ä¸Šæ¬¡è®¾ç½®çš„core dumpå‚æ•°åœ¨è™šæ‹Ÿæœºé‡å¯åæ²¡æœ‰äº†ï¼Œéœ€è¦é‡æ–°å†æ¥ä¸€éã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ulimit -c unlimited</span><br><span class="line">ulimit -a</span><br></pre></td></tr></table></figure><p>æƒé™ä¹Ÿè¦é‡è®¾ã€‚<br>ç„¶åå°±å¯ä»¥çœ‹core dumpæ–‡ä»¶äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Program terminated with signal SIGFPE, Arithmetic exception.</span><br><span class="line">#0  0x00007f8a4a5c30d8 in tm_read ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br><span class="line">[Current thread is 1 (Thread 0x7f8a4b7c6700 (LWP 2112))]</span><br><span class="line">(gdb) where</span><br><span class="line">#0  0x00007f8a4a5c30d8 in tm_read ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br><span class="line">#1  0x00005582a6470496 in TransactionalMemory::read (this=&lt;optimized out&gt;, </span><br><span class="line">    this=&lt;optimized out&gt;, target=0x7f8a4b7c47c0, size=8, </span><br><span class="line">    source=0x7f8a44008210, tx=&lt;optimized out&gt;) at transactional.hpp:231</span><br><span class="line">#2  Transaction::read (target=0x7f8a4b7c47c0, size=8, source=0x7f8a44008210, </span><br><span class="line">    this=0x7f8a4b7c47d0) at transactional.hpp:312</span><br><span class="line">#3  Shared&lt;unsigned long&gt;::read (this=&lt;synthetic pointer&gt;)</span><br><span class="line">    at transactional.hpp:394</span><br><span class="line">#4  Shared&lt;unsigned long&gt;::operator unsigned long (this=&lt;synthetic pointer&gt;)</span><br><span class="line">    at transactional.hpp:398</span><br></pre></td></tr></table></figure><p>ç«Ÿç„¶æ˜¯readé‡Œé¢æµ®ç‚¹å¼‚å¸¸ï¼Ÿreadé‡Œé¢æµ®ç‚¹éƒ½æ²¡æœ‰å•Šå“ªæ¥çš„å¼‚å¸¸ï¼Ÿï¼Ÿï¼Ÿ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Core was generated by `./grading 453 ../reference.so ../338094.so&#x27;.</span><br><span class="line">Program terminated with signal SIGFPE, Arithmetic exception.</span><br><span class="line">#0  0x00007f7533dfd9c8 in clean_log ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br><span class="line">[Current thread is 1 (Thread 0x7f754080d700 (LWP 3303))]</span><br><span class="line">(gdb) where</span><br><span class="line">#0  0x00007f7533dfd9c8 in clean_log ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br><span class="line">#1  0x00007f7533dfdaae in clean_transaction ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br><span class="line">#2  0x00007f7533dfdb23 in batcher_cleanup ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br><span class="line">#3  0x00007f7533dfdbf8 in leave ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br><span class="line">#4  0x00007f7533dfde2d in tm_end ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡åœ¨clean_log()é‡Œï¼Œè¿˜é è°±ç‚¹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[clean_log] size=8</span><br><span class="line">[clean_log] align=0</span><br></pre></td></tr></table></figure><p>å¥½å®¶ä¼™ï¼çœŸæ˜¯é™¤0å•Šï¼</p><p>æ‰“å°å‘ç°segment idæ˜¯0ï¼Œæ˜æ˜¾æ˜¯è®¿é—®åˆ°äº†ä¸è¯¥è®¿é—®çš„segmentï¼Œè¦ä¹ˆæ˜¯èµ·å§‹åœ°å€ç®—é”™äº†ï¼Œè¦ä¹ˆæ˜¯éå†é”™äº†ã€‚</p><p>ä¼šä¸ä¼šæ˜¯cleanäº†å·²ç»è¢«freeçš„segmentå•Šï¼Ÿ<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-12 PM9.55.00.jpg"                      width=600                ><br>æœç„¶ï¼</p><p>æ‰€ä»¥æ˜¯å› ä¸ºï¼Œreadã€writeçš„æ—¶å€™å†™äº†logï¼Œä¸€è½®ç»“æŸçš„æ—¶å€™æ ¹æ®logé‡Œçš„åœ°å€å»é‡è®¾controlã€‚ä½†æ˜¯å¯èƒ½å…¶ä¸­æœ‰çš„segmentå·²ç»è¢«freeæ‰äº†ã€‚</p><p>æ”¹æˆdeferåˆ°tm_destroyå†free segmentï¼ŒæˆåŠŸï¼<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-12 PM11.17.52.jpg"                                      ></p><h2 id="Segmentation-fault"><a href="#Segmentation-fault" class="headerlink" title="Segmentation fault"></a>Segmentation fault</h2><p>ä¸ŠæœåŠ¡å™¨è·‘ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] write log overflow!âª *** EXCEPTION ***</span><br><span class="line">â© Transactional library takes too long to process the transactions</span><br></pre></td></tr></table></figure><p>logå†™æ­»512ä¸å¤Ÿã€‚</p><p>è¯•å›¾åœ¨è™šæ‹Ÿæœºé‡Œå¤ç°bugï¼Œå‚æ•°è°ƒåˆ°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">auto const nbworkers = 4;</span><br><span class="line">auto const nbtxperwrk    = 160000ul / nbworkers;</span><br><span class="line">auto const nbaccounts    = 32 * nbworkers;</span><br><span class="line">auto const expnbaccounts = 256 * nbworkers;</span><br></pre></td></tr></table></figure><p>æ—¶ï¼Œåˆå‡ºç°äº†Segmentation faultï¼ŒæŸ¥çœ‹core</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Program terminated with signal SIGSEGV, Segmentation fault.</span><br><span class="line">#0  0x00007fe97e5faa00 in clean_log ()</span><br><span class="line">   from /home/dcl/Desktop/CS453-2021-project-main/338094.so</span><br><span class="line">[Current thread is 1 (Thread 0x7fe97ffff700 (LWP 1476))]</span><br></pre></td></tr></table></figure><p>æ˜¯logçš„é—®é¢˜</p><p>å¥‡æ€ªçš„æ˜¯ï¼Œæ‰“å¼€cleançš„debugè¾“å‡ºåï¼ŒæŠ¥é”™å˜æˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[batcher_cleanup] total=2</span><br><span class="line">[3 clean #write=1 #read=0]</span><br><span class="line">[2 clean #write=129 #read=0]</span><br><span class="line">[batcher_cleanup] total=1</span><br><span class="line">[5 clean #write=0 #read=2]</span><br><span class="line">[batcher_cleanup] total=1</span><br><span class="line">[6 clean #write=0 #read=2]</span><br><span class="line">âª *** EXCEPTION ***</span><br><span class="line">â© Transactional library takes too long to process the transactions</span><br></pre></td></tr></table></figure><p>å…ˆæŠŠslow factorè°ƒæˆ1024</p><p>å‘ç°æœ‰æ—¶å€™read logæ»¡äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[78516 clean #write=0 #read=512]</span><br><span class="line">[batcher_cleanup] done.</span><br><span class="line">batch round -&gt; 32924</span><br><span class="line">[batcher_cleanup] total=1</span><br><span class="line">[78517 clean #write=0 #read=512]</span><br><span class="line">[batcher_cleanup] done.</span><br><span class="line">batch round -&gt; 32925</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">batch round -&gt; 56620</span><br><span class="line">[77895 tm_begin] is_ro=0</span><br><span class="line">[ERROR] read log overflow! tr_id=77894 is_ro=1</span><br><span class="line">[77896 tm_begin] is_ro=1</span><br><span class="line">[ERROR] read log overflow! tr_id=77893 is_ro=1</span><br><span class="line">[77897 tm_begin] is_ro=1</span><br></pre></td></tr></table></figure><p>ä¸æ˜¯è®¾ç½®è¿‡read onlyä¸å†™logå—ï¼Ÿå‘ç°ä»£ç é‡Œæ²¡æœ‰ï¼Œå¯èƒ½æ˜¯å‰é¢å“ªæ¬¡debugå›é€€åˆ æ‰äº†ğŸ¤ª</p><p>é‡æ–°åŠ å…¥åˆ¤æ–­ï¼šis_roæ—¶ä¸å†™logã€ä¸æ¸…ç†ï¼ŒæˆåŠŸï¼</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-13 AM11.45.34.jpg"                      width=600                ><p>ç°åœ¨è·‘â†‘è¿™ä¸ªå‚æ•°å¯ä»¥è¿‡äº†ï¼å¯å–œå¯è´ºï¼</p><h2 id="log-overflow"><a href="#log-overflow" class="headerlink" title="log overflow"></a>log overflow</h2><p>ä¸ŠæœåŠ¡å™¨ï¼</p><p>write log overflowğŸ˜­</p><p>512ï¼Œä¸å¤Ÿ<br>1024ï¼Œä¸å¤Ÿ<br>2048ï¼Œä¸å¤Ÿï¼</p><p>è™šæ‹Ÿæœºè°ƒæˆç›¸åŒçš„å‚æ•°è¯•è¯•ã€‚è‡³å°‘æœ‰ä¸€ä¸ªå¥½æ¶ˆæ¯ï¼Œè™šæ‹Ÿæœºçš„æŠ¥é”™ç°åœ¨å’ŒæœåŠ¡å™¨ä¸€æ ·äº†ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œ å¯ä»¥ç›´æ¥åœ¨è™šæ‹Ÿæœºä¸Šæµ‹è¯•ä¸€ä¸‹logçš„å¤§å°ã€‚</p><p>å¯æ˜¯è™šæ‹Ÿæœº2048å¤Ÿäº†å•Šï¼Ÿè§é¬¼ã€‚</p><p>ç­‰ç­‰â€¦åˆšæ‰ä¸ŠæœåŠ¡å™¨æ”¹äº†å‚æ•°å¿˜è®°é‡æ–°æ‰“åŒ…zipäº†â€¦2048é‡æ–°è¯•ä¸€æ¬¡</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-13 PM12.03.39.jpg"                      width=600                ><p>å•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</p><p>è™šæ‹Ÿæœº1024ä¹Ÿèƒ½è¿‡ï¼Œè¦ä¸ä¸ŠæœåŠ¡å™¨å†è¯•ä¸€æ¬¡ã€‚æœä¸å…¶ç„¶ï¼è¿‡äº†ï¼å“ˆå“ˆå“ˆå“ˆå“ˆï¼</p><h1 id="Milestone"><a href="#Milestone" class="headerlink" title="Milestone"></a>Milestone</h1><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-13 PM12.16.39.jpg"                      width=600                ><p>å¤ªæ„ŸåŠ¨äº†ï¼</p><p>ç¬¬ä¸€æ¬¡è¿‡ï¼Œç»¿è‰²ï¼Œç«Ÿç„¶æœ‰1.6ï¼æ´»è¿‡æ¥äº†ï¼</p><p>ä»11/28å¼€å§‹å†™è¿™ä¸ªç‰ˆæœ¬ï¼Œæ–­æ–­ç»­ç»­å†™åˆ°ä»Šå¤©12/13ï¼Œå·®ä¸å¤šä¸¤å‘¨ï¼Œç»ˆäºï¼ŒåŠæ ¼äº†ğŸ˜­ğŸ˜­ğŸ˜­<br>ï¼ˆè™½ç„¶ä¸­é—´è¿˜å†™äº†ä¸ªDA project submission3ï¼ŒDAå¯çœŸæ˜¯å¤ªå‹å–„äº†ï¼Œæˆ‘çˆ±Javaï¼‰</p><h1 id="é˜¶æ®µå››"><a href="#é˜¶æ®µå››" class="headerlink" title="é˜¶æ®µå››"></a>é˜¶æ®µå››</h1><p>å°è¯•æ”¹è¿›ï¼Œæé«˜æ€§èƒ½ã€‚</p><p>-&gt; <a href="https://coconutnutx.github.io/2021/12/16/ca-condition/">CA project çŠ¶æ€åˆ†æ&amp;debug</a></p><h2 id="BoundedOverrun"><a href="#BoundedOverrun" class="headerlink" title="BoundedOverrun"></a>BoundedOverrun</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">terminate called after throwing an instance of &#x27;Exception::BoundedOverrun&#x27;</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯ä¼˜åŒ–é€»è¾‘åread_only transactionæ²¡æœ‰free</p><h1 id="Memcheck"><a href="#Memcheck" class="headerlink" title="Memcheck"></a>Memcheck</h1><p>ä¸‹é¢ä¸»è¦æ˜¯ç”¨Valgrindæ£€æŸ¥å†…å­˜æ³„æ¼æ—¶çš„é—®é¢˜ã€‚</p><p>è§£å†³ä¸Šé¢çš„é—®é¢˜åè¿˜æœ‰æ³„éœ²ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">==2068== 32 bytes in 1 blocks are still reachable in loss record 1 of 2</span><br><span class="line">==2068==    at 0x4C33B25: calloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)</span><br><span class="line">==2068==    by 0x4E3F7F4: _dlerror_run (dlerror.c:140)</span><br><span class="line">==2068==    by 0x4E3F050: dlopen@@GLIBC_2.2.5 (dlopen.c:87)</span><br><span class="line">==2068==    by 0x10DEE7: TransactionalLibrary::TransactionalLibrary(char const*) (in /home/dcl/Desktop/CS453-2021-project-main/grading/grading)</span><br><span class="line">==2068==    by 0x10B25C: main (in /home/dcl/Desktop/CS453-2021-project-main/grading/grading)</span><br><span class="line">==2068== </span><br><span class="line">==2068== 2,448 bytes in 51 blocks are definitely lost in loss record 2 of 2</span><br><span class="line">==2068==    at 0x4C31B0F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)</span><br><span class="line">==2068==    by 0x859A0D9: ???</span><br><span class="line">==2068==    by 0x10E12D: Transaction::Transaction(TransactionalMemory const&amp;, Transaction::Mode) (in /home/dcl/Desktop/CS453-2021-project-main/grading/grading)</span><br><span class="line">==2068==    by 0x10F425: auto transactional&lt;WorkloadBank::long_tx(unsigned long&amp;) const::&#123;lambda(Transaction&amp;)#1&#125;&gt;(TransactionalMemory const&amp;, Transaction::Mode, WorkloadBank::long_tx(unsigned long&amp;) const::&#123;lambda(Transaction&amp;)#1&#125;&amp;&amp;) [clone .constprop.125] (in /home/dcl/Desktop/CS453-2021-project-main/grading/grading)</span><br><span class="line">==2068==    by 0x110A7A: WorkloadBank::run(unsigned long, unsigned long) const (in /home/dcl/Desktop/CS453-2021-project-main/grading/grading)</span><br><span class="line">==2068==    by 0x10D376: measure(Workload&amp;, unsigned int, unsigned int, unsigned long, unsigned long, unsigned long, unsigned long)::&#123;lambda(unsigned int)#1&#125;::operator()(unsigned int) const (in /home/dcl/Desktop/CS453-2021-project-main/grading/grading)</span><br><span class="line">==2068==    by 0x531E6DE: ??? (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25)</span><br><span class="line">==2068==    by 0x50496DA: start_thread (pthread_create.c:463)</span><br><span class="line">==2068==    by 0x5CC171E: clone (clone.S:95)</span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯read onlyåœ¨readå¤±è´¥æ—¶ï¼Œä¸ä¼šè°ƒç”¨tm_endï¼Œæ‰€ä»¥åº”è¯¥å°±åœ°freeã€‚</p><p>æœç„¶ã€‚è¿…é€Ÿè§£å†³ï¼è€¶ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;æƒ¨ç—›ç»éªŒ&quot;&gt;&lt;a href=&quot;#æƒ¨ç—›ç»éªŒ&quot; class=&quot;headerlink&quot; title=&quot;æƒ¨ç—›ç»éªŒ&quot;&gt;&lt;/a&gt;æƒ¨ç—›ç»éªŒ&lt;/h1&gt;&lt;h2 id=&quot;Start-easy&quot;&gt;&lt;a href=&quot;#Start-easy&quot; class=&quot;headerlink&quot; titl
      
    
    </summary>
    
    
      <category term="Debug" scheme="https://coconutnutx.github.io/categories/Debug/"/>
    
    
      <category term="concurrent_algorithm" scheme="https://coconutnutx.github.io/tags/concurrent-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>DA project æ€»ç»“</title>
    <link href="https://coconutnutx.github.io/2021/12/01/project-review/"/>
    <id>https://coconutnutx.github.io/2021/12/01/project-review/</id>
    <published>2021-12-01T07:06:31.000Z</published>
    <updated>2021-12-01T07:06:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h1><p>åŸºäºUDP Socketï¼Œå®ç°Perfect Links -&gt; Uniform Reliable Broadcast -&gt; FIFO Broadcast applicationå’ŒLocalized Causal Broadcast</p><h1 id="Perfect-Linkså±‚"><a href="#Perfect-Linkså±‚" class="headerlink" title="Perfect Linkså±‚"></a>Perfect Linkså±‚</h1><p>ç‚¹å¯¹ç‚¹çš„é€šä¿¡ï¼Œæµ‹è¯•æ—¶è·‘nä¸ªprocessï¼Œç»™å…¶ä¸­ä¸€ä¸ªå‘mæ¡æ¶ˆæ¯ã€‚</p><p>éœ€è¦æ»¡è¶³çš„æ€§è´¨ï¼š</p><ul><li>Reliable delivery -&gt; å¦‚æœå‘é€ã€æ¥æ”¶æ–¹éƒ½æ­£ç¡®ï¼Œæ¯ä¸€æ¡å‘å‡ºçš„æ¶ˆæ¯æœ€ç»ˆéƒ½ä¼šè¢«æ¥æ”¶æ–¹deliver</li><li>No duplication -&gt; ä¸é‡å¤deliver</li><li>No creation -&gt; ä¸å‡­ç©ºäº§ç”Ÿæ¶ˆæ¯<h2 id="ä¸»è¦çš„å‡ ä¸ªç±»"><a href="#ä¸»è¦çš„å‡ ä¸ªç±»" class="headerlink" title="ä¸»è¦çš„å‡ ä¸ªç±»"></a>ä¸»è¦çš„å‡ ä¸ªç±»</h2></li></ul><ol><li>PerfectLinks<ul><li>è°ƒç”¨SocketClientå‘æ¶ˆæ¯</li><li>æ£€æŸ¥å¹¶deliverï¼Œå‘ä¸Š(URB)indicate</li></ul></li><li>SocketClient<ul><li>åˆ›å»ºå¹¶å‘é€Socketï¼ˆåŒ…æ‹¬æ™®é€šæ¶ˆæ¯å’ŒACKï¼‰</li></ul></li><li>SocketServerï¼ˆå•ç‹¬çš„çº¿ç¨‹ï¼‰<ul><li>ç›‘å¬Socketï¼Œæ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œäº¤ç»™SocketServerHandlerå¤„ç†</li></ul></li><li>SocketServerHandlerï¼ˆå•ç‹¬çš„çº¿ç¨‹ï¼‰<ul><li>å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œå‘ä¸Š(PerfectLinks)indicate</li></ul></li><li>MessageResenderï¼ˆå•ç‹¬çš„çº¿ç¨‹ï¼‰<ul><li>å®šæ—¶æ£€æŸ¥å¹¶é‡å‘æ¶ˆæ¯<h2 id="ä¿è¯Reliable-delivery"><a href="#ä¿è¯Reliable-delivery" class="headerlink" title="ä¿è¯Reliable delivery"></a>ä¿è¯Reliable delivery</h2>é€šè¿‡ACKå®ç°ã€‚PerfectLinkså‘é€æ¶ˆæ¯åï¼Œç»´æŒä¸€ä¸ªpendingé›†åˆï¼Œç”¨äºå­˜æ‰€æœ‰å·²ç»å‘é€ã€ä½†è¿˜æ²¡æœ‰æ”¶åˆ°ACKçš„æ¶ˆæ¯ï¼Œæ”¶åˆ°ACKåå°†æ¶ˆæ¯ç§»å‡ºã€‚MessageResenderå®šæ—¶æ£€æŸ¥è¿™ä¸ªé›†åˆï¼Œé‡å‘å…¶ä¸­çš„æ‰€æœ‰æ¶ˆæ¯ã€‚<h2 id="ä¿è¯No-duplication"><a href="#ä¿è¯No-duplication" class="headerlink" title="ä¿è¯No duplication"></a>ä¿è¯No duplication</h2>ç»´æŒä¸€ä¸ªdeliveredé›†åˆå³å¯ã€‚<h2 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h2>SocketServerHandlerç”¨åˆ°çº¿ç¨‹æ± ï¼Œé˜²æ­¢åŒæ—¶æ”¶åˆ°æ¶ˆæ¯å¤ªå¤šæ—¶ç‚¸æ‰ã€‚<h2 id="å¹¶å‘æ§åˆ¶"><a href="#å¹¶å‘æ§åˆ¶" class="headerlink" title="å¹¶å‘æ§åˆ¶"></a>å¹¶å‘æ§åˆ¶</h2>å¯èƒ½ä¼šå‡ºç°å†²çªçš„æ˜¯pendingå’Œdeliveredï¼Œç”¨ConcurrentHashMapå®ç°ã€‚<h2 id="SEQç»†èŠ‚"><a href="#SEQç»†èŠ‚" class="headerlink" title="SEQç»†èŠ‚"></a>SEQç»†èŠ‚</h2>ä¸Šå±‚çš„æ¶ˆæ¯æœ‰ä¸€ä¸ªSEQï¼Œåˆ›å»ºä¹‹åä¸ä¼šæ”¹å˜ï¼Œä¸”åœ¨åé¢çš„å¹¿æ’­ä¸­ï¼Œå‘é€ç»™æ¯ä¸€ä¸ªprocessçš„SEQéƒ½æ˜¯ä¸€æ ·çš„ã€‚è€ŒPLå±‚éœ€è¦åŒºåˆ†å‘ç»™ä¸åŒprocessçš„SEQï¼Œäºæ˜¯åŠ å…¥äº†PSEQã€‚PerfectLinksæœ‰ä¸€ä¸ªAtomicIntegerï¼Œæ¯æ¬¡åˆ›å»ºæ¶ˆæ¯æ—¶getAndIncrementå¾—åˆ°PSEQã€‚<h1 id="Uniform-Reliable-Broadcastå±‚"><a href="#Uniform-Reliable-Broadcastå±‚" class="headerlink" title="Uniform Reliable Broadcastå±‚"></a>Uniform Reliable Broadcastå±‚</h1>æ¯ä¸ªprocesså¯¹å…¶ä»–æ‰€æœ‰processå¹¿æ’­mæ¡æ¶ˆæ¯ï¼Œéœ€æ»¡è¶³çš„æ€§è´¨ï¼š</li></ul></li></ol><ul><li>Validity -&gt; å¦‚æœä¸€ä¸ªæ­£ç¡®çš„processå¹¿æ’­äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå®ƒæœ€ç»ˆä¼šdeliverè¿™æ¡æ¶ˆæ¯</li><li>No duplication</li><li>No creation</li><li>Agreement -&gt; å¦‚æœæŸä¸ªæ­£ç¡®çš„process deliveräº†ä¸€æ¡æ¶ˆæ¯ï¼Œæœ€ç»ˆæ‰€æœ‰çš„processéƒ½ä¼šdeliverè¿™æ¡æ¶ˆæ¯<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2>UniformReliableBroadcastç±»è°ƒç”¨PerfectLinkså¯¹æ¯ä¸€ä¸ªprocesså‘é€æ¶ˆæ¯ã€‚<h2 id="ä¿è¯Agreement"><a href="#ä¿è¯Agreement" class="headerlink" title="ä¿è¯Agreement"></a>ä¿è¯Agreement</h2>æµ‹è¯•ç¯å¢ƒä¿è¯äº†è‡³å°‘ä¸€åŠçš„processæ˜¯æ­£ç¡®çš„ï¼ŒåŸºäºè¿™ä¸ªå‡è®¾ï¼Œåªè¦ç¡®ä¿å¤§å¤šæ•°processæ”¶åˆ°æ¶ˆæ¯å³å¯ã€‚</li></ul><p>æ¯æ¬¡broadcastæˆ–æ”¶åˆ°ä¸€æ¡æ–°æ¶ˆæ¯åï¼ŒåŠ å…¥pendingã€‚æ”¶åˆ°æ–°æ¶ˆæ¯è¿˜éœ€è¦è½¬å‘ï¼Œå³å†æ¬¡å¹¿æ’­è¿™æ¡æ¶ˆæ¯ï¼Œæ­¤æ—¶SEQæ˜¯ä¸å˜çš„ï¼Œæ¶ˆæ¯ä¸­éœ€è¦å«æœ‰creator idå’Œsender idã€‚</p><p>å¯¹pendingä¸­çš„æ¯ä¸€æ¡æ¶ˆæ¯ï¼Œç»Ÿè®¡ä»å“ªäº›ä¸åŒçš„senderå¤„æ”¶åˆ°äº†è¿™æ¡æ¶ˆæ¯ï¼ˆæ­¤å¤„æ”¶åˆ°æ¶ˆæ¯ï¼Œç±»ä¼¼PLå±‚æ”¶åˆ°ACKï¼‰ï¼Œå¦‚æœæ€»æ•°è¿‡åŠï¼Œå³å¯deliverã€‚</p><h2 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h2><p>ä¸Šè¿°ç»Ÿè®¡ç”¨åˆ°BitSetå®ç°ã€‚å¯¹pendingä¸­çš„æ¯æ¡æ¶ˆæ¯ï¼Œç”¨ä¸€ä¸ªBitSetè®°å½•ä»å“ªäº›idæ”¶åˆ°äº†è¿™æ¡æ¶ˆæ¯ã€‚</p><p>å½“æ€»æ•°è¿‡åŠï¼Œdeliverä¹‹åï¼Œæ¶ˆæ¯å¯ä»¥ä»pendingä¸­ç§»å‡ºã€‚è½¬è€ŒåŠ å…¥deliveredä¸­ï¼Œæ­¤æ—¶ä¸éœ€è¦ä¿ç•™ä¹‹å‰çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè®°å½•ä¸€ä¸ªSEQå°±å¤Ÿäº†ã€‚</p><h1 id="FIFO-Broadcast-applicationå±‚"><a href="#FIFO-Broadcast-applicationå±‚" class="headerlink" title="FIFO Broadcast applicationå±‚"></a>FIFO Broadcast applicationå±‚</h1><p>æ€§è´¨ï¼šåœ¨URBçš„åŸºç¡€ä¸Šï¼Œè¿˜éœ€ä¿è¯æŒ‰åºdeliver</p><h2 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>ç”¨ä¸€ä¸ªAtomicIntegeræ•°ç»„nextï¼Œè®°å½•å¯¹äºæ¯ä¸€ä¸ªprocessï¼Œå½“å‰ä»¥åŠdeliverçš„æ¶ˆæ¯çš„SEQã€‚ä¸€å¼€å§‹ç”¨äº†PriorityQueueï¼Œæ¯æ¬¡æ¯”è¾ƒé¡¶éƒ¨å’Œnextã€‚åé¢å‘ç°PriorityQueueå¹¶å‘å¾—åŠ é”ï¼Œäºæ˜¯è¿˜æ˜¯æ”¹æˆäº†ç”¨setè®°å½•æ”¶åˆ°çš„SEQï¼Œå¯å¹¶å‘çš„seté€šè¿‡ConcurrentHashMap.newKeySet()å¾—åˆ°ã€‚</p><h2 id="æµé‡æ§åˆ¶"><a href="#æµé‡æ§åˆ¶" class="headerlink" title="æµé‡æ§åˆ¶"></a>æµé‡æ§åˆ¶</h2><p>ç”¨ä¸€ä¸ªAtomicIntegerç»Ÿè®¡å½“å‰processå‘å‡ºã€ä½†è¿˜æ²¡æœ‰deliverçš„æ¶ˆæ¯æ•°é‡ã€‚è¯¥æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæš‚åœå‘é€æ–°æ¶ˆæ¯ã€‚</p><h2 id="æ£€æŸ¥deliverç»†èŠ‚"><a href="#æ£€æŸ¥deliverç»†èŠ‚" class="headerlink" title="æ£€æŸ¥deliverç»†èŠ‚"></a>æ£€æŸ¥deliverç»†èŠ‚</h2><p>æ¯æ¬¡æ”¶åˆ°æ¶ˆæ¯åï¼Œæ£€æŸ¥pendingä¸­æ¥è‡ªè¿™æ¡æ¶ˆæ¯creatorçš„ï¼Œæœ‰æ²¡æœ‰ç¬¦åˆè¦æ±‚å¯ä»¥deliverçš„æ¶ˆæ¯ã€‚ç”¨åˆ°è¿™æ ·ä¸€å¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(currentPending.remove(currentNext.get()))&#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">currentNext.getAndIncrement();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>currentPendingæ˜¯ä¸€ä¸ªConcurrentSetï¼Œåªæœ‰removeæˆåŠŸæ—¶æ‰ä¼šè¿”å›trueï¼Œå¯ä»¥é¿å…å¹¶å‘è®¿é—®æ—¶çš„å†²çªã€‚</p><p>è‡³æ­¤ï¼Œä»PerfectLinksåˆ°FIFOï¼Œéƒ½ä¸ç”¨åŠ synchronizedã€‚</p><h1 id="UML-activity-graph-1"><a href="#UML-activity-graph-1" class="headerlink" title="UML activity graph 1"></a>UML activity graph 1</h1><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/DA_fifo_v2.jpg"                                     ><h1 id="Localized-Causal-Broadcastå±‚"><a href="#Localized-Causal-Broadcastå±‚" class="headerlink" title="Localized Causal Broadcastå±‚"></a>Localized Causal Broadcastå±‚</h1><p>æ€§è´¨ï¼šåœ¨URBçš„åŸºç¡€ä¸Šï¼Œè¿˜éœ€ä¿è¯causal order<br>ä¾‹å¦‚ï¼Œ1ä¾èµ–2ã€3ï¼Œåˆ™å½“1deliveräº†2ã€3çš„æ¶ˆæ¯m1ã€m2åï¼Œå†broadcastæ–°æ¶ˆæ¯m3ï¼Œé‚£ä¹ˆå…¶å®ƒæ‰€æœ‰processåœ¨deliver m3ä¹‹å‰ï¼Œéƒ½å¿…é¡»å·²ç»deliveräº†2ã€3çš„æ¶ˆæ¯m1ã€m2ã€‚<br>æ— ä¾èµ–çš„æ¶ˆæ¯ä»éœ€ä¿è¯FIFOã€‚</p><h2 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>ç”¨2ä¸ªAtomicIntegeræ•°ç»„ï¼Œä¸€ä¸ªæ˜¯vector clockï¼Œå½“deliverä¸€æ¡æ¶ˆæ¯åï¼Œå¯¹åº”çš„ä½ç½®+1ï¼›å¦ä¸€ä¸ªæ˜¯dependency clockï¼Œå½“deliverä¾èµ–çš„æ¶ˆæ¯åï¼Œå¯¹åº”çš„ä½ç½®+1ã€‚å‘é€æ¶ˆæ¯æ—¶ï¼ŒåŒæ—¶å‘é€å½“å‰çš„dependency clockã€‚æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œéœ€å…ˆè§£æå‡ºæ¶ˆæ¯é™„å¸¦çš„clockï¼Œåˆ¤æ–­è¿™æ¡æ¶ˆæ¯çš„æ‰€æœ‰ä¾èµ–æ˜¯å¦æ»¡è¶³ï¼Œæ˜¯æ‰å¯ä»¥deliverï¼Œå¦åˆ™åŠ å…¥pendingã€‚</p><h2 id="2ä¸ªclock"><a href="#2ä¸ªclock" class="headerlink" title="2ä¸ªclock"></a>2ä¸ªclock</h2><p>åŒºåˆ†ä¸åŒçš„vector clockå’Œdependency clockï¼Œæ˜¯è€ƒè™‘åˆ°ä»¥ä¸‹æƒ…å†µï¼š<br>å¯¹äºæŸä¸€ä¸ªprocess iï¼Œå¯èƒ½broadcastäº†å¾ˆå¤šæ¡æ¶ˆæ¯ï¼Œä½†éƒ½è¿˜æ²¡æœ‰deliverï¼Œé‚£ä¹ˆæ­¤æ—¶vector clockè¿˜æ²¡æœ‰æ›´æ–°ã€‚ä½†æ˜¯å¯¹äºå…¶å®ƒæ¥æ”¶æ¶ˆæ¯çš„processï¼Œå®ƒä»¬åœ¨deliveræ¥è‡ªiçš„æ¶ˆæ¯æ—¶ï¼Œè¦ä¿è¯é¡ºåºã€‚é€šè¿‡dependency clockå¯ä»¥ç»Ÿä¸€çš„å¤„ç†é¡ºåºå’Œä¾èµ–ã€‚<br>ï¼ˆå®é™…ä¸Šåªç”¨ä¸€ä¸ªvector clockè®°å½•ä¹Ÿè¡Œï¼Œä½†æ˜¯æ‰“åŒ…å’Œæ›´æ–°æœ‰ç‚¹éº»çƒ¦ï¼Œäºæ˜¯å¹²è„†å°±åˆ†å¼€äº†ï¼Œä¹Ÿåªå ç”¨processæ€»æ•°ä¸ªAtomicIntegerï¼Œå¯ä»¥æ¥å—ï¼‰</p><h2 id="æ£€æŸ¥deliver"><a href="#æ£€æŸ¥deliver" class="headerlink" title="æ£€æŸ¥deliver"></a>æ£€æŸ¥deliver</h2><p>ç±»ä¼¼FIFOï¼Œä»ç„¶æ˜¯åœ¨æ”¶åˆ°æ¯æ¡æ¶ˆæ¯åï¼Œæ£€æŸ¥å¯¹åº”çš„creatorï¼Œæ˜¯å¦æœ‰æ¥è‡ªæ”¹creatorçš„æ¶ˆæ¯å¯ä»¥deliverï¼Œä¸åŒçš„æ˜¯éœ€è¦æ¯”è¾ƒdependencyã€‚<br>è¿™é‡Œç”¨æ·±åº¦ä¼˜å…ˆéå†çš„æ–¹æ³•ï¼Œä»å·¦åˆ°å³æ¯”è¾ƒæ¶ˆæ¯çš„clockå’Œå½“å‰çš„vector clockï¼Œå¦‚æœå…¨éƒ¨æ»¡è¶³ï¼Œdeliverè¯¥æ¶ˆæ¯å¹¶è¿”å›trueã€‚å¦‚æœç¼ºå°‘ä¾èµ–ï¼Œå…ˆçœ‹èƒ½å¦è§£å†³ä¾èµ–ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">checkDeliver</span><span class="params">(<span class="keyword">int</span> createrId)</span></span>&#123;</span><br><span class="line">        ConcurrentHashMap&lt;Integer, URBMessage&gt; currentPending = pending.get(createrId);</span><br><span class="line">        <span class="keyword">boolean</span> hasDeilivered = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// traverse according to SEQ of this creator</span></span><br><span class="line">        <span class="keyword">while</span>(currentPending.containsKey(vectorClock[createrId-<span class="number">1</span>].get()+<span class="number">1</span>))&#123;</span><br><span class="line">            URBMessage urbMessage = currentPending.get(vectorClock[createrId-<span class="number">1</span>].get()+<span class="number">1</span>);</span><br><span class="line">            <span class="comment">// check dependency</span></span><br><span class="line">            <span class="keyword">int</span> i;</span><br><span class="line">            <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">1</span>; i&lt;=totalHost; i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(vectorClock[i-<span class="number">1</span>].get() &lt; urbMessage.vectorClock[i-<span class="number">1</span>])&#123;</span><br><span class="line">                    flag = <span class="keyword">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(flag==<span class="keyword">false</span>)&#123;</span><br><span class="line">                <span class="comment">// has dependency</span></span><br><span class="line">                System.out.println(<span class="string">&quot;depend on &quot;</span>+i);</span><br><span class="line">                <span class="comment">// check if dependency can be solved</span></span><br><span class="line">                <span class="keyword">if</span>(createrId==myId || checkDeliver(i)==<span class="keyword">false</span>)&#123;</span><br><span class="line">                    <span class="comment">// nothing delivered</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                deliver(urbMessage);</span><br><span class="line">                hasDeilivered = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> hasDeilivered;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h1 id="UML-activity-graph-2"><a href="#UML-activity-graph-2" class="headerlink" title="UML activity graph 2"></a>UML activity graph 2</h1><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/DA_lcb.jpg"                                     >]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ç›®æ ‡&quot;&gt;&lt;a href=&quot;#ç›®æ ‡&quot; class=&quot;headerlink&quot; title=&quot;ç›®æ ‡&quot;&gt;&lt;/a&gt;ç›®æ ‡&lt;/h1&gt;&lt;p&gt;åŸºäºUDP Socketï¼Œå®ç°Perfect Links -&amp;gt; Uniform Reliable Broadcast -&amp;gt; FI
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="distributed_algorithm" scheme="https://coconutnutx.github.io/tags/distributed-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>DA project 2 validation tool</title>
    <link href="https://coconutnutx.github.io/2021/11/30/validate/"/>
    <id>https://coconutnutx.github.io/2021/11/30/validate/</id>
    <published>2021-11-30T08:40:52.000Z</published>
    <updated>2021-11-30T08:40:52.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h1><p>â€¼ï¸ Dependency bug fixed. (10/12)</p><p>â€¼ï¸ ä¸æµ‹è¯•FIFO</p><p>â€¼ï¸ æœ€å¤š9ä¸ªçº¿ç¨‹ï¼ˆè‹¥è¦æµ‹10+å¯ä¿®æ”¹æ‹¼æ¥æ–‡ä»¶åä»£ç ï¼‰</p><hr><p>ä¸ºäº†æµ‹è¯•submission2(Localized Causal Broadcast)çš„è¾“å‡ºå†™äº†ä¸ªç®€é™‹å·¥å…·ï¼Œä»…<strong>æœ‰é™æƒ…å†µ</strong>ä¸‹<strong>æµ‹è¯•</strong>ç”¨<br>ä»…ï¼ä¾›ï¼å‚ï¼è€ƒï¼ä¸ï¼ä¿ï¼è¯ï¼å¯¹ï¼</p><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>å¦‚ï¼Œprocess 1ä¾èµ–2ã€3ï¼Œå’Œ4ã€5æ²¡å…³ç³»ï¼Œå…ˆæ‰¾å‡ºæ‰€æœ‰processè¾“å‡ºä¸­å…³äº1ã€2ã€3çš„æ¶ˆæ¯ï¼Œç„¶åç»Ÿè®¡1 broadcastæ¯æ¡æ¶ˆæ¯æ—¶çš„vector clockï¼Œä»¥åŠå…¶å®ƒprocess deliveræ¯æ¡æ¶ˆæ¯æ—¶çš„vector clockï¼Œåè€…çš„&gt;=å‰è€…ã€‚1çš„è¾“å‡ºå¯ä»¥æ¯”å…¶å®ƒå¤šï¼Œæ­¤æ—¶å¤šçš„ä¸è€ƒè™‘ï¼Œåªæ¯”è¾ƒå‰é¢çš„éƒ¨åˆ†ã€‚</p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p>åŸºæœ¬å’Œç»™çš„validate_fifo.pyå·®ä¸å¤š<br>æŠŠä»£ç ã€configã€outputæ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹å†…ï¼ˆå³stress.pyçš„æ‰€æœ‰è¾“å‡ºï¼Œæœ‰å¤šä½™çš„æ²¡å…³ç³»ï¼‰<br>å¸¦å‚æ•°â€“proc_numè¿è¡Œ</p><h2 id="æµç¨‹ç¤ºä¾‹"><a href="#æµç¨‹ç¤ºä¾‹" class="headerlink" title="æµç¨‹ç¤ºä¾‹"></a>æµç¨‹ç¤ºä¾‹</h2><ol><li>cdåˆ°tools</li><li>æŠŠvalidate_lcausal.pyæ”¾åˆ°toolsä¸­</li><li>run stress<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python stress.py -r ../template_java/run.sh -t lcausal -l output -p 4 -m 100</span><br><span class="line"></span><br><span class="line">// VM</span><br><span class="line">python3 stress.py -r ../template_java/run.sh -t lcausal -l output -p 4 -m 100</span><br></pre></td></tr></table></figure><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-11-30 AM9.51.22.jpg"                      width='400px'                ></li><li>run validate<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python validate_lcausal.py --proc_num 4</span><br><span class="line"></span><br><span class="line">// VM</span><br><span class="line">python3 validate_lcausal.py --proc_num 4</span><br></pre></td></tr></table></figure><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-12-01 PM3.03.46.jpg"                      width='600px'                ></li></ol><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">config_path = <span class="string">&#x27;./output/config&#x27;</span></span><br><span class="line">output_path = <span class="string">&#x27;./output/proc0&#x27;</span>   <span class="comment"># append id.output later, id&lt;=9</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_config</span>():</span></span><br><span class="line">    f = <span class="built_in">open</span>(config_path,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">    data = f.readlines()</span><br><span class="line">    m = <span class="number">0</span></span><br><span class="line">    <span class="built_in">dict</span> = &#123;&#125;</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        splited = line.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> count == <span class="number">0</span>:</span><br><span class="line">            m = <span class="built_in">int</span>(splited[<span class="number">0</span>]) <span class="comment"># how many messages each process should broadcast</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">        sender = <span class="built_in">int</span>(splited[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(splited)):</span><br><span class="line">            <span class="built_in">dict</span>.setdefault(sender,[]).append(<span class="built_in">int</span>(splited[i])) <span class="comment"># dependency (including sender itself)</span></span><br><span class="line">        count+=<span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># find all &#x27;d sender seq&#x27; in output_id, where sender is in depent set</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDependentList</span>(<span class="params"><span class="built_in">id</span>, dset</span>):</span></span><br><span class="line">    cur_output_path = output_path+<span class="built_in">str</span>(<span class="built_in">id</span>)+<span class="string">&#x27;.output&#x27;</span></span><br><span class="line">    f = <span class="built_in">open</span>(cur_output_path,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">    data = f.readlines()</span><br><span class="line">    </span><br><span class="line">    sequence = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        splited = line.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> splited[<span class="number">0</span>] == <span class="string">&quot;d&quot;</span>: <span class="comment"># only consider diliver</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(splited[<span class="number">1</span>]) <span class="keyword">in</span> dset: <span class="comment"># only consider sender in depent set</span></span><br><span class="line">                sequence.append(line)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(<span class="built_in">id</span>),<span class="string">&#x27;#msg:&#x27;</span>,<span class="built_in">len</span>(sequence))</span><br><span class="line">    <span class="keyword">return</span> sequence</span><br><span class="line"></span><br><span class="line"><span class="comment"># find all &#x27;b seq&#x27; and relevent delivered message in output_id, where sender is in depent set</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDependentListOfCreator</span>(<span class="params"><span class="built_in">id</span>, dset</span>):</span></span><br><span class="line">    cur_output_path = output_path+<span class="built_in">str</span>(<span class="built_in">id</span>)+<span class="string">&#x27;.output&#x27;</span></span><br><span class="line">    f = <span class="built_in">open</span>(cur_output_path,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">    data = f.readlines()</span><br><span class="line">    </span><br><span class="line">    sequence = []</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        splited = line.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> splited[<span class="number">0</span>] == <span class="string">&quot;b&quot;</span>:</span><br><span class="line">            sequence.append(line)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(splited[<span class="number">1</span>]) <span class="keyword">in</span> dset:</span><br><span class="line">                sequence.append(line)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(<span class="built_in">id</span>),<span class="string">&#x27;#msg:&#x27;</span>,<span class="built_in">len</span>(sequence))</span><br><span class="line">    <span class="keyword">return</span> sequence</span><br><span class="line">    </span><br><span class="line"><span class="comment"># get vector clock associated with each message created by id from sequence</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getVectorClock</span>(<span class="params">sequence, <span class="built_in">id</span>, proc_num</span>):</span></span><br><span class="line">    clock = []</span><br><span class="line">    msg_clock_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(proc_num+<span class="number">1</span>):</span><br><span class="line">        clock.append(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> msg <span class="keyword">in</span> sequence:</span><br><span class="line">        splited = msg.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        sender = <span class="built_in">int</span>(splited[<span class="number">1</span>])</span><br><span class="line">        clock[sender]+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> sender==<span class="built_in">id</span>:</span><br><span class="line">            msg_clock_list.append(clock.copy())</span><br><span class="line">    <span class="keyword">return</span> msg_clock_list</span><br><span class="line"></span><br><span class="line"><span class="comment"># get vector clock associated with each message broadcasted by id from sequence</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getVectorClockOfCreator</span>(<span class="params">sequence, <span class="built_in">id</span>, proc_num</span>):</span></span><br><span class="line">    clock = []</span><br><span class="line">    msg_clock_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(proc_num+<span class="number">1</span>):</span><br><span class="line">        clock.append(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> msg <span class="keyword">in</span> sequence:</span><br><span class="line">        splited = msg.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        sender = <span class="built_in">int</span>(splited[<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> splited[<span class="number">0</span>]==<span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">            clock[sender]+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg_clock_list.append(clock.copy())</span><br><span class="line">    <span class="keyword">return</span> msg_clock_list</span><br><span class="line">    </span><br><span class="line"><span class="comment"># check if dependency of id is satisfied in all other process</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkProcessId</span>(<span class="params"><span class="built_in">id</span>, dset</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;checking process&#x27;</span>, <span class="built_in">str</span>(<span class="built_in">id</span>), <span class="string">&#x27;,depend on&#x27;</span>, dset)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># sequence of currrent process</span></span><br><span class="line">    ref_sequence = getDependentListOfCreator(<span class="built_in">id</span>, dset)</span><br><span class="line">    ref_clock = getVectorClockOfCreator(ref_sequence, <span class="built_in">id</span>, proc_num)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">id</span>,<span class="string">&#x27;#clock:&#x27;</span>,<span class="built_in">len</span>(ref_clock))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(proc_num):</span><br><span class="line">        cur_id = i+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> cur_id != <span class="built_in">id</span>:</span><br><span class="line">            <span class="comment"># sequence of other process</span></span><br><span class="line">            sequence = getDependentList(cur_id, dset)</span><br><span class="line">            <span class="comment"># get vector clock</span></span><br><span class="line">            clock = getVectorClock(sequence, <span class="built_in">id</span>, proc_num)</span><br><span class="line">            <span class="built_in">print</span>(cur_id,<span class="string">&#x27;#clock:&#x27;</span>,<span class="built_in">len</span>(clock))</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># number should be less of equal</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(clock)&gt;<span class="built_in">len</span>(ref_clock):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Number exceeds!&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="comment"># output should be the same with ref_sequence</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(clock)):</span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(proc_num+<span class="number">1</span>):</span><br><span class="line">                    <span class="keyword">if</span> ref_clock[i][j] &gt; clock[i][j]:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&#x27;Clock not match!&#x27;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&#x27;ref_clock:&#x27;</span>,ref_clock[i])</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&#x27;clock    :&#x27;</span>,clock[i])</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check output of all processes</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkProcess</span>(<span class="params">proc_num</span>):</span></span><br><span class="line">    depend = read_config()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;dependency:&#x27;</span>,depend,<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(proc_num):</span><br><span class="line">        <span class="built_in">id</span> = i+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> checkProcessId(<span class="built_in">id</span>, depend[<span class="built_in">id</span>])==<span class="literal">False</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;validate process&#x27;</span>,<span class="built_in">str</span>(<span class="built_in">id</span>),<span class="string">&#x27;OK\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line"></span><br><span class="line">    parser.add_argument(</span><br><span class="line">        <span class="string">&quot;--proc_num&quot;</span>,</span><br><span class="line">        required=<span class="literal">True</span>,</span><br><span class="line">        dest=<span class="string">&quot;proc_num&quot;</span>,</span><br><span class="line">        <span class="built_in">help</span>=<span class="string">&quot;Total number of processes&quot;</span>,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    results = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    proc_num = <span class="built_in">int</span>(results.proc_num)</span><br><span class="line">    <span class="keyword">if</span> checkProcess(proc_num):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Validation OK&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Validation failed!&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="å…³äºdependency"><a href="#å…³äºdependency" class="headerlink" title="å…³äºdependency"></a>å…³äºdependency</h1><blockquote><p>We say that a process <code>x</code> is affected by a process <code>z</code> if all the messages which process <code>z</code> broadcasts and which process <code>x</code> delivers become dependencies for all future messages broadcast by process <code>x</code>.</p></blockquote><p>ä¸ªäººç†è§£æ˜¯ï¼Œå¦‚æœ</p><ul><li>p1 b 1</li><li>p2 d 1 1</li><li>p1 d 2 1</li><li>p1 d 3 1</li><li>p1 b 2<br>æ­¤æ—¶p1çš„dependencyæ˜¯[1 1 1]ï¼Œp2åœ¨d 1 2æ—¶éœ€è¦æœ‰è¿™äº›dependency<br>åŠ å…¥broadcastæˆ–deliveræ¯æ¡æ¶ˆæ¯æ—¶å¯¹åº”çš„clock</li><li>p1 b 1 [0 0 0]</li><li>p2 d 1 1 [0 0 0]</li><li>p1 d 2 1</li><li>p1 d 3 1</li><li>p1 b 2 [1 1 1]</li><li>p2 d 3 1</li><li>p2 d 2 1</li><li>p2 d 1 2 [1 1 1]<br>ç»Ÿè®¡æ—¶ï¼Œå¯¹referenceéœ€è¦ç»Ÿè®¡broadcastæ—¶çš„clockï¼Œè€Œå…¶å®ƒéœ€ç»Ÿè®¡deliveræ—¶çš„clock</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Update&quot;&gt;&lt;a href=&quot;#Update&quot; class=&quot;headerlink&quot; title=&quot;Update&quot;&gt;&lt;/a&gt;Update&lt;/h1&gt;&lt;p&gt;â€¼ï¸ Dependency bug fixed. (10/12)&lt;/p&gt;
&lt;p&gt;â€¼ï¸ ä¸æµ‹è¯•FIFO&lt;/p&gt;
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="distributed_algorithm" scheme="https://coconutnutx.github.io/tags/distributed-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>CA project æ€è·¯ç¬”è®°</title>
    <link href="https://coconutnutx.github.io/2021/11/28/ca-project/"/>
    <id>https://coconutnutx.github.io/2021/11/28/ca-project/</id>
    <published>2021-11-28T13:33:12.000Z</published>
    <updated>2021-11-28T13:33:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>çœ‹Project descriptioné‡Œç»™çš„Dual-versioned transactional memoryçš„ä¸€äº›è®°å½•</p><h1 id="å…³äºaccess-set"><a href="#å…³äºaccess-set" class="headerlink" title="å…³äºaccess set"></a>å…³äºaccess set</h1><h2 id="æƒ…å†µåˆ†æ"><a href="#æƒ…å†µåˆ†æ" class="headerlink" title="æƒ…å†µåˆ†æ"></a>æƒ…å†µåˆ†æ</h2><p>å‡è®¾å½“å‰Aæ˜¯readable copyï¼ŒBæ˜¯writable copyï¼ŒæŸä¸€ä¸ªä½ç½®å¯èƒ½å‡ºç°çš„ä¸€äº›æƒ…å†µï¼š</p><ol><li>å°æ˜è¯»ï¼ŒæˆåŠŸï¼ŒåŠ å…¥set<ol><li>å¼ ä¸‰è¯»ï¼ŒæˆåŠŸï¼ŒåŠ å…¥set<ol><li>å°æ˜å†™ï¼Œå‘ç°å¼ ä¸‰ä¹Ÿåœ¨setï¼Œå¤±è´¥ <font color="red">åªè¦seté‡Œæœ‰åˆ«äººï¼Œå°±ä¸èƒ½å†™äº†</font></li></ol></li><li>å¼ ä¸‰å†™ï¼Œå‘ç°å°æ˜å·²ç»åœ¨setï¼Œå¤±è´¥ <font color="red">åªè¦seté‡Œæœ‰åˆ«äººï¼Œå°±ä¸èƒ½å†™äº†</font></li><li>å°æ˜å†™ï¼Œseté‡Œåªæœ‰è‡ªå·±ï¼ŒæˆåŠŸ<ol><li>å°æ˜è¯»ï¼Œå‘ç°å·²ç»è¢«å†™è¿‡äº†ï¼Œè‡ªå·±åœ¨seté‡Œï¼ŒæˆåŠŸï¼Œè¯»B</li><li>å¼ ä¸‰è¯»ï¼Œå‘ç°å·²ç»è¢«å†™è¿‡äº†ï¼Œè‡ªå·±ä¸åœ¨seté‡Œï¼Œå¤±è´¥</li></ol></li></ol></li></ol><h2 id="ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ å…¥ï¼Ÿ"><a href="#ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ å…¥ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ å…¥ï¼Ÿ"></a>ä»€ä¹ˆæ—¶å€™å¯ä»¥åŠ å…¥ï¼Ÿ</h2><ol><li>è¯»æˆåŠŸçš„æ—¶å€™<br> ä»€ä¹ˆæ—¶å€™å¯ä»¥è¯»ï¼Ÿ<ol><li>æ²¡äººå†™è¿‡ï¼Œéšä¾¿è¯»ï¼Œè¯»A</li><li>è‡ªå·±å†™è¿‡ï¼Œå¯ä»¥è¯»ï¼Œè¯»B <font color="red">å¦‚æœæ˜¯åˆ«äººå†™çš„ï¼Œè‡ªå·±ä¸å¯èƒ½åœ¨seté‡Œï¼Œä¸èƒ½è¯»</font></li></ol></li><li>å†™æˆåŠŸçš„æ—¶å€™<br> ä»€ä¹ˆæ—¶å€™å¯ä»¥å†™ï¼Ÿ<ol><li>æ²¡äººå†™è¿‡ï¼Œä¸”seté‡Œæ²¡åˆ«äºº <font color="red">åªå¯èƒ½æœ‰ä¸€ä¸ªäººæ˜¯é€šè¿‡å†™åŠ å…¥setçš„</font></li><li>è‡ªå·±å†™è¿‡</li></ol></li></ol><p>ä»è€Œä¿è¯ï¼š</p><ol><li>åªå¯èƒ½æœ‰ä¸€ä¸ªäººå†™</li><li>å†™è¿‡çš„åœ°æ–¹åªæœ‰å†™çš„äººèƒ½è¯»</li><li>æ²¡å†™è¿‡çš„åœ°æ–¹éƒ½å¯ä»¥è¯»</li></ol><h2 id="setå¯ä»¥åªè®°ç¬¬ä¸€ä¸ª"><a href="#setå¯ä»¥åªè®°ç¬¬ä¸€ä¸ª" class="headerlink" title="setå¯ä»¥åªè®°ç¬¬ä¸€ä¸ª"></a>setå¯ä»¥åªè®°ç¬¬ä¸€ä¸ª</h2><p>seté‡Œå¯ä»¥åªè®°å½•ç¬¬ä¸€ä¸ªåŠ å…¥setçš„äººï¼Œå› ä¸ºï¼š</p><ol><li>å¦‚æœç¬¬ä¸€ä¸ªåŠ å…¥setæ˜¯é€šè¿‡å†™åŠ å…¥çš„<ol><li>åé¢å¯ä»¥é€šè¿‡setåˆ¤æ–­è‡ªå·±å†™è¿‡ï¼Œå¯ä»¥ç»§ç»­è¯»å†™</li><li>å…¶ä»–äººå‘ç°å†™è¿‡ï¼Œä¸”ä¸æ˜¯è‡ªå·±å†™çš„ï¼Œè¯»å†™éƒ½ä¸å¯ä»¥</li></ol></li><li>å¦‚æœç¬¬ä¸€ä¸ªåŠ å…¥setæ˜¯é€šè¿‡è¯»åŠ å…¥çš„ï¼Œ<ol><li>åˆ«äººä¸èƒ½å†™ï¼Œå› ä¸ºè™½ç„¶æ²¡äººå†™è¿‡ï¼Œä½†seté‡Œå·²ç»æœ‰äººäº†</li><li>åˆ«äººå¯ä»¥è¯»</li><li>è‡ªå·±å¯ä»¥å†™ï¼Œè‡ªå·±å†™è¿‡ä¹‹åï¼Œåˆ«äººä¹Ÿä¸å¯ä»¥è¯»äº†<br>è¿™ä¸ªç¬¬ä¸€ä¸ªåŠ å…¥setçš„ï¼Œå¯ä»¥è§†ä¸ºæ‰€æœ‰è€…</li></ol></li></ol><p>ğŸ§project descriptioné‡Œé¢è¯´ä¸è¦implement an actual setï¼Œé‚£ä¹ˆæŒ‰è¿™ä¸ªé€»è¾‘ï¼Œåªå­˜ä¸€ä¸ªå€¼åº”è¯¥å°±è¶³å¤Ÿäº†</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªä½ç½®æ˜¯å¦å¯ä»¥è¯»å†™æœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š<br><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-11-28 PM2.36.51.jpg"                                     ></p><p>ä¸”1çŠ¶æ€ä¸­ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–äººè¯»è¿‡ï¼Œå æœ‰è€…å¯å†™ã€‚å¦‚æœæœ‰äººè¯»è¿‡ï¼Œåˆ™ä¸å¯å†™äº†ã€‚</p><p>ä»¥ä¸Šéƒ½æ˜¯é’ˆå¯¹è¯»å†™äº‹åŠ¡ï¼Œåªè¯»äº‹åŠ¡å¯ä»¥ç›´æ¥è¯»ï¼Œä¸å½±å“</p><p>æ›´æ–°<a href="https://coconutnutx.github.io/2021/12/16/ca-condition/">CA project çŠ¶æ€åˆ†æ</a></p><h2 id="å…¶å®ƒé—®é¢˜"><a href="#å…¶å®ƒé—®é¢˜" class="headerlink" title="å…¶å®ƒé—®é¢˜"></a>å…¶å®ƒé—®é¢˜</h2><p>Qï¼šå¯èƒ½æœ‰å†™æˆåŠŸçš„ï¼Œä½†åç»­æ“ä½œå¤±è´¥ï¼Œå¦‚ä½•å¤„ç†ï¼Ÿ<br>Aï¼šè¿™æ ·çš„TXä¸ä¼šåˆ°commit()ï¼Œè€Œåªæœ‰åœ¨commit()ä¸­å¯ä»¥æ›´æ”¹valid copyï¼Œå› æ­¤ä¸‹ä¸€è½®ä¸­æœ‰æ•ˆçš„ä»æ˜¯æ—§çš„å€¼</p><h1 id="å…³äºbatcher"><a href="#å…³äºbatcher" class="headerlink" title="å…³äºbatcher"></a>å…³äºbatcher</h1><p>ä»€ä¹ˆæ—¶å€™è°ƒï¼Ÿ</p><pre><code>1. äº‹åŠ¡å¼€å§‹ï¼Œè°ƒenter() -&gt; å³åœ¨tm_begin()ä¸­2. æœ€åä¸€ä¸ªæ“ä½œç»“æŸæ—¶ï¼Œè°ƒleave() -&gt; å³åœ¨tm_end()ä¸­</code></pre><h2 id="æƒ…å†µåˆ†æ-1"><a href="#æƒ…å†µåˆ†æ-1" class="headerlink" title="æƒ…å†µåˆ†æ"></a>æƒ…å†µåˆ†æ</h2><ol><li>åˆå§‹æ—¶ï¼Œremaining=0</li><li>ç¬¬ä¸€ä¸ªäººenter()ï¼Œremainingå˜æˆ1</li><li>åé¢çš„äººenter()ï¼Œéƒ½è¢«æŒ‚åˆ°blocked</li><li>ç¬¬ä¸€ä¸ªäººleave()ï¼Œremainingå˜æˆ0</li><li>counter+1  <font color="red">ç›¸å½“äºè¿›å…¥ä¸‹ä¸€è½®</font><ul><li>remainingé‡è®¾ä¸ºblockedçš„é•¿åº¦</li><li>å«é†’æ‰€æœ‰blockedé‡Œçš„çº¿ç¨‹</li><li>æ¸…ç©ºblocked</li></ul></li><li>æ­¤æ—¶ä¸Šä¸€è½®ä¸­è¢«blockedçš„çº¿ç¨‹ï¼Œåœ¨è¿™ä¸€è½®ä¸­ä¸€èµ·å¼€å§‹å·¥ä½œã€‚å½“æœ‰æ–°çº¿ç¨‹è°ƒenter()ï¼Œåˆä¼šè¢«æŒ‚åˆ°blockedé‡Œï¼Œç­‰å¾…ä¸‹ä¸€è½®</li></ol><h2 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h2><p>Qï¼šä¸ºä»€ä¹ˆcommit()ä¸­äº¤æ¢valid copyè¦æ¨è¿Ÿåˆ°ä¸¤è½®äº¤æ›¿çš„é—´éš™è¿›è¡Œï¼Ÿ<br>Aï¼šä¿è¯atomicity</p><p>Qï¼šget_epoch()ä»€ä¹ˆæ—¶å€™ç”¨åˆ°ï¼Ÿæ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ<br>Aï¼šä¼˜åŒ–çš„æ—¶å€™ç”¨</p><h1 id="å…³äºtx-t"><a href="#å…³äºtx-t" class="headerlink" title="å…³äºtx_t"></a>å…³äºtx_t</h1><p>ä¸€ä¸ªäº‹åŠ¡éœ€è¦è®°å½•çš„ä¸œè¥¿ï¼š</p><ul><li>boolean æ˜¯å¦æˆåŠŸ <font color="red">å¦‚æœå·²ç»å¤±è´¥äº†ï¼Œåé¢è¯»å†™çš„æ—¶å€™å¯ä»¥ç›´æ¥è¿”å›</font></li><li>boolean æ˜¯å¦åªè¯» <font color="red">è¯»çš„æ—¶å€™å¯ä»¥ç›´æ¥è¯»</font></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;çœ‹Project descriptioné‡Œç»™çš„Dual-versioned transactional memoryçš„ä¸€äº›è®°å½•&lt;/p&gt;
&lt;h1 id=&quot;å…³äºaccess-set&quot;&gt;&lt;a href=&quot;#å…³äºaccess-set&quot; class=&quot;headerlink&quot; titl
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="concurrent_algorithm" scheme="https://coconutnutx.github.io/tags/concurrent-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>æ›´æ”¹ä¸»é¢˜è®°å½•</title>
    <link href="https://coconutnutx.github.io/2021/11/16/theme/"/>
    <id>https://coconutnutx.github.io/2021/11/16/theme/</id>
    <published>2021-11-16T11:01:22.000Z</published>
    <updated>2021-11-16T11:01:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰ä¸€ç›´ç”¨çš„<a class="link"   href="https://github.com/Shen-Yu/hexo-theme-ayer" >Ayer<i class="fas fa-external-link-alt"></i></a>ä¸»é¢˜ï¼Œçªç„¶å‘ç°æœç´¢ä¸èƒ½ç”¨ï¼Œdebugäº†ä¸€æ—©ä¸Šè§£å†³ä¸äº†ï¼Œå†³å®šå¹²è„†æ¢ä¸ªä¸»é¢˜</p><p>å°è¯•è¿‡ä¸‰ä¸ªä¸»é¢˜å<br><a class="link"   href="https://github.com/lh1me/hexo-theme-aomori" >Aomori<i class="fas fa-external-link-alt"></i></a><br><a class="link"   href="https://github.com/SukkaW/hexo-theme-suka" >suka<i class="fas fa-external-link-alt"></i></a><br><a class="link"   href="https://github.com/XPoet/hexo-theme-keep" >keep<i class="fas fa-external-link-alt"></i></a></p><p>å†³å®šç”¨keep<br>å¤ªä¼˜é›…äº†ï¼Œæœç´¢ä¹Ÿæ²¡æœ‰bugï¼Œå¦™</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¹‹å‰ä¸€ç›´ç”¨çš„&lt;a class=&quot;link&quot;   href=&quot;https://github.com/Shen-Yu/hexo-theme-ayer&quot; &gt;Ayer&lt;i class=&quot;fas fa-external-link-alt&quot;&gt;&lt;/i&gt;&lt;/a&gt;ä¸»é¢˜ï¼Œçªç„¶å‘ç°æœç´¢ä¸èƒ½ç”¨ï¼Œd
      
    
    </summary>
    
    
      <category term="Memo" scheme="https://coconutnutx.github.io/categories/Memo/"/>
    
    
      <category term="tool" scheme="https://coconutnutx.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>sync example note2ï¼šmemory order</title>
    <link href="https://coconutnutx.github.io/2021/11/13/concurrent2/"/>
    <id>https://coconutnutx.github.io/2021/11/13/concurrent2/</id>
    <published>2021-11-13T09:26:37.000Z</published>
    <updated>2021-11-13T09:26:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>Producer consumer example</p><p>There might be conflict on buffer[], but consumed_until and produced_until prevent that (if used correctly).</p><p>So, only need to make sure consumed_until and produced_until accessed correctly under concurrency.</p><h1 id="Using-locks"><a href="#Using-locks" class="headerlink" title="Using locks"></a>Using locks</h1><p>In each round of produce()</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  lock_acquire(&amp;lock);</span><br><span class="line">  <span class="keyword">if</span> (consumed_until + BUFFER_SIZE &gt; r) <span class="keyword">break</span>;</span><br><span class="line">  lock_release(&amp;lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">produced[r] = ...</span><br><span class="line">buffer[r % BUFFER_SIZE] = produced[r];</span><br><span class="line">produced_until++;</span><br><span class="line">lock_release(&amp;lock);</span><br></pre></td></tr></table></figure><p>Two locks:</p><ol><li>check if can produce: conflict on consumed_until</li><li>conflict on produced_until</li></ol><p>In each round of consume()</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  lock_acquire(&amp;lock);</span><br><span class="line">  <span class="keyword">if</span> (produced_until &gt; r) <span class="keyword">break</span>;</span><br><span class="line">  lock_release(&amp;lock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">consumed[r] = buffer[r % BUFFER_SIZE];</span><br><span class="line">consumed_until++;</span><br><span class="line">lock_release(&amp;lock);</span><br></pre></td></tr></table></figure><p>Two locks:</p><ol><li>check if can consume: conflict on produced_until</li><li>conflict on consumed_until</li></ol><h1 id="Using-atomic-vairables"><a href="#Using-atomic-vairables" class="headerlink" title="Using atomic vairables"></a>Using atomic vairables</h1><p>In produce, two locks can be modified:</p><ol><li><p>check if can produce: conflict on consumed_until</p><p>no ordering constraints -&gt; memory_order_relaxed</p></li><li><p>conflict on produced_until</p><p>store produced_until should happen after all operations -&gt; load-store + store-store = release</p></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="comment">// The memory order can be relaxed as we don&#x27;t read anything &quot;produced&quot; by the consumer.</span></span><br><span class="line">  <span class="keyword">int</span> local_cu = atomic_load_explicit(&amp;consumed_until, memory_order_relaxed);</span><br><span class="line">  <span class="keyword">if</span> (local_cu + BUFFER_SIZE &gt; r) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">produced[r] = ...</span><br><span class="line">buffer[r % BUFFER_SIZE] = produced[r];</span><br><span class="line"><span class="comment">// We want to increment &quot;produced_until&quot; after the buffer has been written.</span></span><br><span class="line"><span class="comment">// By using memory_order_release, we prevent the STOREs on buffer from being</span></span><br><span class="line"><span class="comment">// reordered after the atomic operation.</span></span><br><span class="line">atomic_fetch_add_explicit(&amp;produced_until, <span class="number">1</span>, memory_order_release);</span><br></pre></td></tr></table></figure><p>In consume, two locks can be modified:</p><ol><li><p>check if can consume: conflict on produced_until</p><p>load produced_until should happen before all operations -&gt; load-load + load-store = acquire</p></li><li><p>conflict on consumed_until</p><p>store consumed_until should happen after all operations -&gt; load-store + store-store = release</p></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="comment">// We don&#x27;t want to access the buffer before checking the atomic variable.</span></span><br><span class="line">  <span class="comment">// The memory_order_acquire prevents this reordering.</span></span><br><span class="line">  <span class="keyword">int</span> local_pu = atomic_load_explicit(&amp;produced_until, memory_order_acquire);</span><br><span class="line">  <span class="keyword">if</span> (local_pu &gt; r) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">consumed[r] = buffer[r % BUFFER_SIZE];</span><br><span class="line">atomic_fetch_add_explicit(&amp;consumed_until, <span class="number">1</span>, memory_order_release);</span><br></pre></td></tr></table></figure><h1 id="Memory-barriers"><a href="#Memory-barriers" class="headerlink" title="Memory barriers"></a>Memory barriers</h1><blockquote><p><a class="link"   href="https://en.cppreference.com/w/cpp/atomic/memory_order" >std::memory_order<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://www.modernescpp.com/index.php/fences-as-memory-barriers" >Fences are Memory Barriers<i class="fas fa-external-link-alt"></i></a></p><p><a class="link"   href="https://www.youtube.com/watch?v=qlkMbxUbKfw&ab_channel=CodeBlacksmith" >Memory Barriers - Learn Modern C++<i class="fas fa-external-link-alt"></i></a></p></blockquote><ul><li><p>memory_order_relaxed: no ordering constraints</p></li><li><p>memory_order_consume</p></li><li><p>memory_order_acquire: load-load + load-store</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-11-13 AM10.59.57.jpg"                                     ></li><li><p>memory_order_release: load-store + store-store</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-11-13 AM11.00.42.jpg"                                     ></li><li><p>memory_order_acq_rel</p></li><li><p>memory_order_seq_cst</p></li></ul><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-11-13 AM10.55.43.jpg"                                     ><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-11-13 AM10.57.03.jpg"                                     >]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Producer consumer example&lt;/p&gt;
&lt;p&gt;There might be conflict on buffer[], but consumed_until and produced_until prevent that (if used correct
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="concurrent_algorithm" scheme="https://coconutnutx.github.io/tags/concurrent-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>sync example note1</title>
    <link href="https://coconutnutx.github.io/2021/11/13/concurrent/"/>
    <id>https://coconutnutx.github.io/2021/11/13/concurrent/</id>
    <published>2021-11-13T08:53:44.000Z</published>
    <updated>2021-11-13T08:53:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>Cync example for C concurrent programing</p><h1 id="Threads"><a href="#Threads" class="headerlink" title="Threads"></a>Threads</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RUNS (4096 * 256)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> THREADS 4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">count</span><span class="params">(<span class="keyword">void</span>* null)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;New thread created\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// declare an array of 4 threads</span></span><br><span class="line">  <span class="keyword">pthread_t</span> handlers[THREADS];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">intptr_t</span> i = <span class="number">0</span>; i &lt; THREADS; i++) &#123;</span><br><span class="line">    <span class="keyword">int</span> res = pthread_create(&amp;handlers[i], <span class="literal">NULL</span>, count, <span class="literal">NULL</span>);</span><br><span class="line">    assert(!res);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; THREADS; i++) &#123;</span><br><span class="line">    <span class="keyword">int</span> res = pthread_join(handlers[i], <span class="literal">NULL</span>);</span><br><span class="line">    assert(!res);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (counter != RUNS * THREADS) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Didn&#x27;t count so well. :/, found %d\n&quot;</span>, counter);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Counted up to %d.\n&quot;</span>, counter);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;lock.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">count</span><span class="params">(<span class="keyword">void</span>* null)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> r = <span class="number">0</span>; r &lt; RUNS; r++) &#123;</span><br><span class="line">    lock_acquire(&amp;lock);</span><br><span class="line">    counter++;</span><br><span class="line">    lock_release(&amp;lock);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Better version: use lock_wait(&amp;lock) and lock_wake_up(&amp;lock) to prevent bucy wait, but rely on a notification.</p><h1 id="Atomic-variable"><a href="#Atomic-variable" class="headerlink" title="Atomic  variable"></a>Atomic  variable</h1><p>Atomic variables (~atomic registers) do not enforce atomic operation blocks.</p><p>Need to use atomic operation.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">atomic_int</span> counter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">count</span><span class="params">(<span class="keyword">void</span>* null)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> r = <span class="number">0</span>; r &lt; RUNS; r++) &#123;</span><br><span class="line">    atomic_fetch_add(&amp;counter, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Another example</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> expected = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (atomic_compare_exchange_strong(&amp;leader[r], &amp;expected, tid)) &#123;</span><br><span class="line">atomic_fetch_add(&amp;nb_leaders[r], <span class="number">1</span>); <span class="comment">// used to check correctness</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h1><p>å½“æœ‰include .hæ—¶ï¼ŒæŠ¥é”™</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang: error: linker command failed with <span class="built_in">exit</span> code <span class="number">1</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥åœ¨Terminal</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gcc election2.c lock.c -o ekection2.o</span><br><span class="line">./election2.o</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Cync example for C concurrent programing&lt;/p&gt;
&lt;h1 id=&quot;Threads&quot;&gt;&lt;a href=&quot;#Threads&quot; class=&quot;headerlink&quot; title=&quot;Threads&quot;&gt;&lt;/a&gt;Threads&lt;/h1&gt;&lt;figu
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="concurrent_algorithm" scheme="https://coconutnutx.github.io/tags/concurrent-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Summary on basic register reductions</title>
    <link href="https://coconutnutx.github.io/2021/10/31/register/"/>
    <id>https://coconutnutx.github.io/2021/10/31/register/</id>
    <published>2021-10-31T17:01:49.000Z</published>
    <updated>2021-10-31T17:01:49.000Z</updated>
    
    <content type="html"><![CDATA[<img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-10-31 PM5.58.54.jpg"                                     >]]></content>
    
    <summary type="html">
    
      
      
        &lt;img  
                     lazyload
                     src=&quot;/images/loading.svg&quot;
                     data-src=&quot;/images/2021/screencaptur
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="distributed_algorithm" scheme="https://coconutnutx.github.io/tags/distributed-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>CountSketch Matrix</title>
    <link href="https://coconutnutx.github.io/2021/10/27/countsketch/"/>
    <id>https://coconutnutx.github.io/2021/10/27/countsketch/</id>
    <published>2021-10-27T20:58:59.000Z</published>
    <updated>2021-10-27T20:58:59.000Z</updated>
    
    <content type="html"><![CDATA[<p>Drew a simple example to help understanding what I learned in class.</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/2021-10-27-225725.png"                                     ><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/2021-10-27-225726.png"                                     >]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Drew a simple example to help understanding what I learned in class.&lt;/p&gt;
&lt;img  
                     lazyload
                     src=&quot;/
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="sublinear_algorithm" scheme="https://coconutnutx.github.io/tags/sublinear-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>DA project0 test record</title>
    <link href="https://coconutnutx.github.io/2021/10/19/DA-project-test/"/>
    <id>https://coconutnutx.github.io/2021/10/19/DA-project-test/</id>
    <published>2021-10-19T16:28:01.000Z</published>
    <updated>2021-10-19T16:28:01.000Z</updated>
    
    <content type="html"><![CDATA[<p>Project0è¦æ±‚å®ç°Perfect Linkï¼Œç»™äº†æµ‹è¯•ç”¨çš„tc.pyç”¨æ¥ä¿®æ”¹ç½‘ç»œæƒ…å†µï¼Œstress.pyæ¨¡æ‹Ÿå‘æ¶ˆæ¯ã€‚ï¼ˆDistributed Algorithms 2021-2022 Project Validation.pdfï¼‰</p><p>æƒ³æµ‹ä¸€ä¸‹è¯•è¯•ã€‚</p><p>æ³¨ï¼šä»¥ä¸‹å‡ ä¸ªæµ‹è¯•éƒ½æ²¡æœ‰æ”¹tc.pyçš„å‚æ•°ï¼Œå³â†“</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-10-19 PM6.43.30.jpg"                                     ><h1 id="Round-1"><a href="#Round-1" class="headerlink" title="Round 1"></a>Round 1</h1><p>å‚æ•°å¦‚å›¾ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">testConfig = &#123;</span><br><span class="line">        <span class="string">&#x27;concurrency&#x27;</span> : <span class="number">8</span>, <span class="comment"># How many threads are interferring with the running processes</span></span><br><span class="line">        <span class="string">&#x27;attempts&#x27;</span> : <span class="number">8</span>, <span class="comment"># How many interferring attempts each threads does</span></span><br><span class="line">        <span class="string">&#x27;attemptsDistribution&#x27;</span> : &#123; <span class="comment"># Probability with which an interferring thread will</span></span><br><span class="line">            <span class="string">&#x27;STOP&#x27;</span>: <span class="number">0.48</span>,          <span class="comment"># select an interferring action (make sure they add up to 1)</span></span><br><span class="line">            <span class="string">&#x27;CONT&#x27;</span>: <span class="number">0.48</span>,</span><br><span class="line">            <span class="string">&#x27;TERM&#x27;</span>:<span class="number">0.04</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 stress.py -r ../template_java/run.sh -t perfect -l output -p <span class="number">10</span> -m <span class="number">10</span></span><br></pre></td></tr></table></figure><p>testConfigåœ¨stress.pyæœ€åï¼Œè¿™é‡Œå…¨æ˜¯é»˜è®¤ï¼Œ10ä¸ªprocessï¼Œæ¯ä¸ªå‘10æ¡æ¶ˆæ¯ï¼ˆconfigä¸­åªæœ‰ä¸€è¡Œ 10 1ï¼‰</p><p>ç†è®ºä¸Šæ¥è¯´ï¼Œåº”è¯¥æ˜¯2-9å·éƒ½è¦ç»™1å·å‘10æ¡ï¼Œæ€»å…±90æ¡</p><p>ä½†æ˜¯å‡ºæ¥çš„æ•°æ®ä¸å®Œå…¨æ˜¯90</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-10-19 PM6.46.31.jpg"                                     ><p>ï¼ˆè¿™é‡Œç»Ÿè®¡è¾“å‡ºå†™äº†ä¸ªç®€å•å·¥å…·ï¼Œè§æœ€åï¼‰</p><p>æ ¹æ®åé¢æµ‹è¯•çš„ç»“æœæ¨æµ‹ï¼Œé—®é¢˜åœ¨testConfigè¿™é‡Œã€‚concurrencyå’Œattemptsæ•°å€¼éƒ½æ˜¯8ï¼Œä¹Ÿå°±æ˜¯æœ‰8ä¸ªæ£ä¹±çº¿ç¨‹å„å¹²é¢„8æ¬¡ã€‚STOPå’ŒCONTåªæ˜¯æš‚åœå’Œç»§ç»­ï¼Œä¸ä¼šå¹²æ‰°æœ€åçš„ç»“æœã€‚ä½†æ˜¯è¿™é‡Œè¿˜æœ‰0.04çš„æ¦‚ç‡ä¼šå‘TERMï¼Œç›´æ¥æŠŠæ­£åœ¨å¹²æ´»çš„processæ€äº†ã€‚æ‰€ä»¥æœ€åæœ‰çš„åªå‘äº†79ã€80</p><h1 id="Round-2"><a href="#Round-2" class="headerlink" title="Round 2"></a>Round 2</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;concurrency&#x27;</span> : <span class="number">16</span></span><br><span class="line"><span class="string">&#x27;attempts&#x27;</span> : <span class="number">16</span></span><br><span class="line"><span class="string">&#x27;attemptsDistribution&#x27;</span> : </span><br><span class="line">            <span class="string">&#x27;STOP&#x27;</span>: <span class="number">0.48</span>,</span><br><span class="line">            <span class="string">&#x27;CONT&#x27;</span>: <span class="number">0.48</span>,</span><br><span class="line">            <span class="string">&#x27;TERM&#x27;</span>:<span class="number">0.04</span></span><br><span class="line"></span><br><span class="line">-p <span class="number">20</span> -m <span class="number">20</span></span><br></pre></td></tr></table></figure><p>è¯•äº†å‡ æ¬¡è¿™ä¸ªå‚æ•°ï¼Œæƒ…å†µå·®ä¸å¤šã€‚åº”è¯¥æœ‰19*20=380æ¡ï¼Œä½†æ˜¯ç»“æœåˆ†åˆ«æ˜¯ï¼š267ã€299ã€360ã€319</p><h1 id="çªç„¶"><a href="#çªç„¶" class="headerlink" title="çªç„¶"></a>çªç„¶</h1><p>ç»å¦ä¸€ä½å½“å€¼çš„æ˜†è™«é¦†ç®¡ç†å‘˜æé†’ï¼Œæµ‹è¯•è¿›ç¨‹æ•°æ˜¯æœ‰ä¸Šé™çš„</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-10-19 PM6.08.42.jpg"                                     ><p>å¯¹ä¸èµ·æˆ‘çš„CPUğŸ™‡â€â™‚ï¸</p><p>ï¼ˆä½†æ˜¯è¿™é‡Œåˆ°åº•æ˜¯åœ¨è¯´9 100æ˜¯ä¸Šé™ï¼Œè¿˜æ˜¯ä¸¾ä¸ªä¾‹å­è¯´å¦‚æœ9 100ï¼Œè®©è·‘25åˆ†é’Ÿï¼Ÿï¼Ÿï¼Ÿï¼‰</p><h1 id="Round-3"><a href="#Round-3" class="headerlink" title="Round 3"></a>Round 3</h1><p>äºæ˜¯å°±æŠŠpå’Œmç›´æ¥è®¾æˆ9å’Œ100</p><p>æ„è¯†åˆ°TERMå¯èƒ½ä¼šå¯¹correctnessæœ‰å½±å“ï¼Œè¿™é‡ŒæŠŠTERMä¹Ÿè°ƒæˆäº†0</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;concurrency&#x27;</span> : <span class="number">8</span></span><br><span class="line"><span class="string">&#x27;attempts&#x27;</span> : <span class="number">8</span></span><br><span class="line"><span class="string">&#x27;attemptsDistribution&#x27;</span> : </span><br><span class="line">            <span class="string">&#x27;STOP&#x27;</span>: <span class="number">0.5</span>,</span><br><span class="line">            <span class="string">&#x27;CONT&#x27;</span>: <span class="number">0.5</span>,</span><br><span class="line">            <span class="string">&#x27;TERM&#x27;</span>:<span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">-p <span class="number">9</span> -m <span class="number">100</span></span><br></pre></td></tr></table></figure><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-10-19 PM7.06.12.jpg"                                     ><p>è¾“å‡ºæ²¡æ¯›ç—…</p><h1 id="Round-4"><a href="#Round-4" class="headerlink" title="Round 4"></a>Round 4</h1><p>ç„¶åæŠŠTERMæ”¹å›å»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;concurrency&#x27;</span> : <span class="number">8</span></span><br><span class="line"><span class="string">&#x27;attempts&#x27;</span> : <span class="number">8</span></span><br><span class="line"><span class="string">&#x27;attemptsDistribution&#x27;</span> : </span><br><span class="line">            <span class="string">&#x27;STOP&#x27;</span>: <span class="number">0.48</span>,</span><br><span class="line">            <span class="string">&#x27;CONT&#x27;</span>: <span class="number">0.48</span>,</span><br><span class="line">            <span class="string">&#x27;TERM&#x27;</span>:<span class="number">0.04</span></span><br><span class="line"></span><br><span class="line">-p <span class="number">9</span> -m <span class="number">100</span></span><br></pre></td></tr></table></figure><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-10-19 PM7.07.10.jpg"                                     ><p>å·¦è¾¹æ˜¯è¿è¡Œä¸­éƒ¨åˆ†è¾“å‡º</p><p>å¯ä»¥å‘ç°æœ‰çš„processè¢«SIGTERMæ€æ‰äº†ï¼Œç¬¬ä¸€æ¬¡SIGTERMå¤šä¸€äº›ï¼Œæœ€åæ”¶åˆ°çš„å°‘ä¸€äº›ã€‚ç¬¬äºŒæ¬¡æœ€åæ‰æœ‰ä¸€ä¸ªSIGTERMï¼Œæ­¤æ—¶å·²ç»å‘å®Œäº†</p><p>ç¬¦åˆé¢„æœŸ</p><h1 id="Tool"><a href="#Tool" class="headerlink" title="Tool"></a>Tool</h1><p>ç”±äºè¾“å‡ºé•¿å¾—å®åœ¨æ²¡çœ¼çœ‹ï¼Œä¸å¥½debugï¼Œå†™äº†ä¸ªå·¥å…·ç»Ÿè®¡ä¸€ä¸‹</p><p>è¿™ä¸¤æ”¾ä¸€ä¸ªç›®å½•ä¸‹ï¼š</p><ul><li>count.py</li><li>output.txt</li></ul><p>output.txtæ˜¯stress.pyçš„è¾“å‡ºï¼ˆåªæ˜¯process 1çš„outputï¼Œå…¨æ˜¯deliveræ²¡æœ‰broadcastçš„ï¼Œé•¿è¿™æ ·â†“ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">d 2 81</span><br><span class="line">d 2 87</span><br><span class="line">d 2 85</span><br><span class="line">d 6 48</span><br><span class="line">d 6 58</span><br><span class="line">d 6 86</span><br><span class="line">d 6 90</span><br><span class="line">d 6 93</span><br><span class="line">d 6 95</span><br><span class="line">d 6 99</span><br><span class="line">d 6 94</span><br><span class="line">d 2 11</span><br><span class="line">d 2 61</span><br><span class="line">d 2 92</span><br><span class="line">d 2 2</span><br><span class="line">d 2 9</span><br><span class="line">d 6 54</span><br><span class="line">d 2 21</span><br><span class="line">d 2 14</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>count.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>,<span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">data = f.readlines()</span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span> = &#123;&#125;</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">splited = line.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">sender = <span class="built_in">int</span>(splited[<span class="number">1</span>])</span><br><span class="line">seq = <span class="built_in">int</span>(splited[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span>.setdefault(sender,[]).append(seq)</span><br><span class="line">count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nTotal number of senders: &quot;</span> , <span class="built_in">len</span>(<span class="built_in">dict</span>), <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Total number of messages: &quot;</span>,  count, <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Details (S: sender id; T: total message received, Q: seq)\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">keys = []</span><br><span class="line"><span class="keyword">for</span> sender <span class="keyword">in</span> <span class="built_in">dict</span>.keys():</span><br><span class="line">keys.append(<span class="built_in">int</span>(sender))</span><br><span class="line">keys.sort()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> sender <span class="keyword">in</span> keys:</span><br><span class="line"><span class="built_in">dict</span>[sender].sort()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;S:&quot;</span>, <span class="built_in">format</span>(sender,<span class="string">&quot;&lt;4&quot;</span>), <span class="string">&quot; T:&quot;</span>, <span class="built_in">format</span>(<span class="built_in">len</span>(<span class="built_in">dict</span>[sender]),<span class="string">&quot;&lt;5&quot;</span>), <span class="string">&quot; Q:&quot;</span>, <span class="built_in">dict</span>[sender])</span><br><span class="line"><span class="comment"># print(&quot;S:&quot;, format(sender,&quot;&lt;4&quot;), &quot; T:&quot;, format(len(dict[sender]),&quot;&lt;5&quot;))</span></span><br></pre></td></tr></table></figure><p>åé¢è¾“å‡ºå¤šäº†ï¼Œå¯ä»¥æŠŠå…·ä½“çš„SEQåˆ æ‰æ‰ï¼Œå‰é¢å°‘çš„æ—¶å€™å¯ä»¥çœ‹çœ‹æœ‰æ²¡æœ‰é‡å¤</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Project0è¦æ±‚å®ç°Perfect Linkï¼Œç»™äº†æµ‹è¯•ç”¨çš„tc.pyç”¨æ¥ä¿®æ”¹ç½‘ç»œæƒ…å†µï¼Œstress.pyæ¨¡æ‹Ÿå‘æ¶ˆæ¯ã€‚ï¼ˆDistributed Algorithms 2021-2022 Project Validation.pdfï¼‰&lt;/p&gt;
&lt;p&gt;æƒ³æµ‹ä¸€ä¸‹è¯•è¯•ã€‚&lt;/p&gt;

      
    
    </summary>
    
    
      <category term="Memo" scheme="https://coconutnutx.github.io/categories/Memo/"/>
    
    
      <category term="distributed_algorithm" scheme="https://coconutnutx.github.io/tags/distributed-algorithm/"/>
    
  </entry>
  
  <entry>
    <title>è®°å½•ankiå¡ç‰‡</title>
    <link href="https://coconutnutx.github.io/2021/04/21/anki/"/>
    <id>https://coconutnutx.github.io/2021/04/21/anki/</id>
    <published>2021-04-21T09:45:17.000Z</published>
    <updated>2021-04-21T09:45:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ‰“ç®—ç”¨ankièƒŒæ³•è¯­å•è¯ï¼Œç”¨Fast Word QueryåŠ å‘éŸ³</p><p>å­—æ®µï¼š</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-04-21 AM11.48.55.jpg"                      width="400px"                ><p>å¡ç‰‡ï¼š</p><p>æ­£é¢æ¨¡æ¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;/br&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;div class=&quot;background&quot;&gt;</span><br><span class="line">&lt;div&gt;&#123;&#123;word&#125;&#125;&lt;/div&gt;&lt;/br&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/center&gt;</span><br></pre></td></tr></table></figure><p>èƒŒé¢æ¨¡æ¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;center&gt;</span><br><span class="line">&lt;div class=&quot;background&quot;&gt;</span><br><span class="line">&#123;&#123;FrontSide&#125;&#125;</span><br><span class="line">&lt;hr id=answer&gt;</span><br><span class="line">&lt;div&gt;&#123;&#123;pronunciation&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;div&gt;&#123;&#123;explanation&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;div&gt;&#123;&#123;example&#125;&#125;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;var initVoice = function () &#123;</span><br><span class="line">    var player = document.getElementById(&#x27;dictVoice&#x27;);</span><br><span class="line">    document.addEventListener(&#x27;click&#x27;, function (e) &#123;</span><br><span class="line">        var target = e.target;</span><br><span class="line">        if (target.hasAttribute(&#x27;role&#x27;) &amp;&amp; target.getAttribute(&#x27;role&#x27;).indexOf(&#x27;dict_audio_js&#x27;) &gt;= 0) &#123;</span><br><span class="line">            var url = target.getAttribute(&#x27;data-rel&#x27;);</span><br><span class="line">            player.setAttribute(&#x27;src&#x27;, url);</span><br><span class="line">            player.volume = 1;</span><br><span class="line">            player.play();</span><br><span class="line">            e.preventDefault();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, false);</span><br><span class="line">&#125;;</span><br><span class="line">initVoice();&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>Fast Word Queryé…ç½®ï¼š</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-04-21 AM11.47.38.jpg"                                     ><p>è¯•äº†ä¸€ä¸‹æ³•è¯­åŠ©æ‰‹åªèƒ½æŸ¥åˆ°å‘éŸ³ï¼Œæ²¡æœ‰è§£é‡Šï¼Œäºæ˜¯è§£é‡Šç”¨äº†æœ‰é“</p><p>æ­¤æ—¶æ•ˆæœï¼š</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-04-21 AM11.51.40.jpg"                                     ><p>ç¿»é¢è‡ªåŠ¨å‘éŸ³ï¼Œä¾‹å¥çš„è¯­éŸ³ä¹Ÿå¯ä»¥ç‚¹</p><p>ä½†æœ‰ä¸ªé—®é¢˜æ˜¯ï¼ŒæŸ¥åˆ°çš„ä¾‹å¥æ˜¯ç™½è‰²ï¼ŒèƒŒæ™¯ä¹Ÿæ˜¯ç™½è‰²</p><p>é€‰ä¸­exampleæ¡†ï¼Œåœ¨ç¼–è¾‘htmlä¸­æ‰¾åˆ°äº†è¿™å‡ ä¸ªdivçš„classï¼Œå¡ç‰‡ä¸­æ”¹æ ·å¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.card &#123;</span><br><span class="line">font-family: arial;</span><br><span class="line">font-size: 20px;</span><br><span class="line">&#125;</span><br><span class="line">.background&#123;</span><br><span class="line">max-width: 800px;</span><br><span class="line">&#125;</span><br><span class="line">.mcols-layout&#123;</span><br><span class="line"> background-color:#333335</span><br><span class="line">&#125;</span><br><span class="line">.trans-container&#123;</span><br><span class="line">background-color: #333335;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æå®š~</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/screencapture2021-04-21 PM12.22.46.jpg"                                     ><hr><p>åˆåŠ äº†ä¸ªpreå­—æ®µï¼Œå¯ä»¥æ”¾le laä¹‹ç±»çš„ï¼Œæ˜¾ç¤ºæ—¶åœ¨wordä¹‹å‰ </p><p>æŸ¥çš„æ—¶å€™å¿½ç•¥ï¼ˆåœ¨Fast Word Queryä¸­Ignoreæ‰ï¼‰ï¼Œä»åªæŸ¥wordï¼Œé¿å…æŸ¥ä¸åˆ°è§£é‡Š</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ‰“ç®—ç”¨ankièƒŒæ³•è¯­å•è¯ï¼Œç”¨Fast Word QueryåŠ å‘éŸ³&lt;/p&gt;
&lt;p&gt;å­—æ®µï¼š&lt;/p&gt;
&lt;img  
                     lazyload
                     src=&quot;/images/loading.svg&quot;
     
      
    
    </summary>
    
    
      <category term="Memo" scheme="https://coconutnutx.github.io/categories/Memo/"/>
    
    
      <category term="tool" scheme="https://coconutnutx.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>Unity Debug WebGLæ’­æ”¾è§†é¢‘</title>
    <link href="https://coconutnutx.github.io/2021/04/02/unity-debug/"/>
    <id>https://coconutnutx.github.io/2021/04/02/unity-debug/</id>
    <published>2021-04-02T07:53:07.000Z</published>
    <updated>2021-04-02T07:53:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>Unityå†…è¿è¡Œæ—¶æ’­æ”¾è§†é¢‘æ²¡é—®é¢˜ï¼Œå¯¼å‡ºåç”¨ç«ç‹æ‰“å¼€å°±æ”¾ä¸äº†ï¼Œçœ‹æ§åˆ¶å°æŠ¥é”™æ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å·²æ‹¦æˆªè·¨æºè¯·æ±‚ï¼šåŒæºç­–ç•¥ç¦æ­¢è¯»å–ä½äº file:///Users/.../unity/Backups/WebV0.3/sharedassets0.resource çš„è¿œç¨‹èµ„æºã€‚ï¼ˆåŸå› ï¼šCORS è¯·æ±‚ä¸æ˜¯ httpï¼‰ã€‚</span><br></pre></td></tr></table></figure><h1 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h1><ol><li><p>WebGLåªèƒ½é€šè¿‡URLæ’­æ”¾è§†é¢‘</p><blockquote><p><a class="link"   href="https://blog.csdn.net/wuyt2008/article/details/107592492?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161752087116780265448826%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=161752087116780265448826&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~times_rank-10-107592492.first_rank_v2_pc_rank_v29&utm_term=unity+webgl+%E8%A7%86%E9%A2%91%E9%BB%91%E5%B1%8F" >Unity2019åœ¨WebGLä¸‹æ’­æ”¾è§†é¢‘<i class="fas fa-external-link-alt"></i></a></p></blockquote></li><li><p>ç«ç‹æµè§ˆå™¨è®¾ç½®å…è®¸è·¨åŸŸ</p><p>security.fileuri.strict_origin_policyæ”¹false</p><blockquote><p><a class="link"   href="https://blog.csdn.net/qq_28867949/article/details/99890103?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&spm=1001.2101.3001.4242" >Firefoxç«ç‹æµè§ˆå™¨è®¿é—®æœ¬åœ°æ–‡ä»¶-æç¤ºè·¨åŸŸé—®é¢˜<i class="fas fa-external-link-alt"></i></a></p></blockquote></li><li><p>ç«ç‹æµè§ˆå™¨è®¾ç½®å…è®¸æ’­æ”¾è§†é¢‘</p><blockquote><p><a class="link"   href="https://blog.csdn.net/qq_34243277/article/details/114398872?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&spm=1001.2101.3001.4242" >Unity2018å‘å¸ƒwebglè§†é¢‘æ— æ³•æ’­æ”¾<i class="fas fa-external-link-alt"></i></a></p></blockquote></li></ol><h1 id="å„ç§å¤±è´¥å°è¯•è®°å½•"><a href="#å„ç§å¤±è´¥å°è¯•è®°å½•" class="headerlink" title="å„ç§å¤±è´¥å°è¯•è®°å½•"></a>å„ç§å¤±è´¥å°è¯•è®°å½•</h1><p>1.</p><blockquote><p><a class="link"   href="https://blog.kongregate.com/unity-html5-cors-and-you/" >https://blog.kongregate.com/unity-html5-cors-and-you/<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>å†™äº†é—®é¢˜åŸå› ï¼Œä½†æ˜¯æ²¡çœ‹åˆ°é’ˆå¯¹Unityæ€ä¹ˆè§£å†³</p><p>2.</p><blockquote><p><a class="link"   href="https://www.jianshu.com/p/78904381ba32" >https://www.jianshu.com/p/78904381ba32<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>è¯´æŠŠprivacy.file_unique_originæ”¹æˆfalseï¼Œä½†æ˜¯å®ƒå·²ç»æ˜¯falseäº†</p><p>3.</p><p>å‘ç°Unityä¸­Video Playerçš„è§†é¢‘æºæœ‰è§†é¢‘å‰ªè¾‘å’ŒURLä¸¤ç§æ–¹å¼</p><p>ä¹‹å‰ç”¨çš„æ˜¯è§†é¢‘å‰ªè¾‘ï¼Œç›´æ¥æŠŠmp4æ–‡ä»¶æ‹–è¿›å»</p><p>æ”¹ç”¨URLè¯•è¯•ï¼Œä»æµè§ˆä¸­æ‰¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæµ‹è¯•ä¹Ÿå¯ä»¥æ’­æ”¾ã€‚è¯•äº†ä¸€ä¸ªç½‘ç»œä¸Šçš„mp4çš„URLï¼Œæµ‹è¯•ä¹Ÿå¯ä»¥</p><p>é‚£æˆ–è®¸å¯ä»¥å°è¯•æŠŠmp4ä¸Šä¼ ï¼Œç„¶åç”¨URLè®¿é—®</p><blockquote><p><a class="link"   href="https://blog.csdn.net/weixin_33912453/article/details/94087306?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-6.baidujs&amp;dist_request_id=&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-6.baidujs" >https://blog.csdn.net/weixin_33912453/article/details/94087306?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-6.baidujs&amp;dist_request_id=&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-6.baidujs<i class="fas fa-external-link-alt"></i></a></p></blockquote><p>è¯•è¯•è¿™ä¸ªç”¨çˆ±å¥‡è‰ºå¼€æ”¾å¹³å°çš„</p><p>å‘ç°æ³¨å†Œåº”ç”¨å¿…é¡»æœ‰url</p><p>4.</p><p>å†æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰è§†é¢‘æ‰˜ç®¡ç½‘ç«™</p><p><a class="link"   href="https://www.zhihu.com/question/23036186/answer/1716470191" >https://www.zhihu.com/question/23036186/answer/1716470191<i class="fas fa-external-link-alt"></i></a></p><p>æ‰¾äº†ä¸€ä¸ªé…·æ’­äº‘ï¼Œè§†é¢‘è¦å®¡æ ¸ï¼Œç­‰ä¼šå†çœ‹ï¼ˆä¼¼ä¹ä¸èƒ½ç›´æ¥æ‹¿åˆ°URLï¼Œå¯èƒ½è¦å‡‰ï¼‰</p><p><a class="link"   href="http://www.stonepoll.com/helpcenter/hc/kb/article/fcc34c50-301a-822a-df8c-e690f5af5bb5/" >http://www.stonepoll.com/helpcenter/hc/kb/article/fcc34c50-301a-822a-df8c-e690f5af5bb5/<i class="fas fa-external-link-alt"></i></a></p><p>è…¾è®¯äº‘è¦ä¹°æœåŠ¡ï¼Œç®—äº†å…ˆ</p><p>åˆä¼ äº†ä¸€ä¸ªä¼˜é…·çš„ï¼Œç­‰ä¼šçœ‹å®¡æ ¸</p><p>å¾—ï¼Œæ‹¿ä¸åˆ°mp4çš„URL</p><p>5.</p><p>è¿˜æ˜¯ä»æµè§ˆå™¨å…¥æ‰‹å§ï¼Œè¯•è¯•å…è®¸è·¨åŸŸ</p><p><a class="link"   href="https://blog.csdn.net/nju_zjy/article/details/108870385" >https://blog.csdn.net/nju_zjy/article/details/108870385<i class="fas fa-external-link-alt"></i></a></p><p>å‚è€ƒè¿™ä¸ªï¼Œè£…ä¸€ä¸ªç«ç‹æ’ä»¶</p><p>æ²¡ç”¨</p><p>å¤šè¯•äº†å‡ ä¸ªæ’ä»¶ï¼Œéƒ½æ²¡ç”¨</p><p>6.</p><p>æœ‰æ‰¾åˆ°ä¸€ä¸ªè°ƒæµè§ˆå™¨è®¾ç½®çš„</p><p><a class="link"   href="https://blog.csdn.net/qq_28867949/article/details/99890103?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242" >https://blog.csdn.net/qq_28867949/article/details/99890103?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242<i class="fas fa-external-link-alt"></i></a></p><p>æŠŠsecurity.fileuri.strict_origin_policyæ”¹æˆfalse</p><p>ã€é‡å¯åä¸æŠ¥é”™äº†ï¼ã€‘</p><p>ä½†æ˜¯è§†é¢‘è¿˜æ˜¯æ’­æ”¾ä¸äº†</p><p>7.</p><p><a class="link"   href="https://blog.csdn.net/qq_38229886/article/details/103139228?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-2&amp;spm=1001.2101.3001.4242" >https://blog.csdn.net/qq_38229886/article/details/103139228?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-2&amp;spm=1001.2101.3001.4242<i class="fas fa-external-link-alt"></i></a></p><p>WebGLä¸æ”¯æŒmp4ï¼Ÿï¼â€¦</p><p>è½¬æˆogvã€‚æ²¡ç”¨</p><p>8.</p><p>æ‰¾äº†ä¸€ä¸ªåœ¨çº¿çš„mp4åœ°å€ï¼Œæœ¬åœ°ok</p><p>å¯¼å‡ºWebGLè¿è¡Œï¼Œä¸æŠ¥é”™ï¼Œæ’­æ”¾ä¸äº†</p><p>9.</p><p><a class="link"   href="https://blog.csdn.net/weixin_43779625/article/details/103410836" >https://blog.csdn.net/weixin_43779625/article/details/103410836<i class="fas fa-external-link-alt"></i></a></p><p>æ”¹ç”¨Render Textureçš„æ–¹å¼ï¼ˆä»¥å‰æ˜¯æè´¨è¦†ç›–ï¼‰</p><p>ä¸è¡Œï¼ˆç”šè‡³æœ¬åœ°éƒ½æ˜¾ç¤ºä¸äº†è§†é¢‘ï¼Œåªæœ‰å£°éŸ³ï¼‰</p><p>10.</p><p><a class="link"   href="https://blog.csdn.net/JLX_Sir/article/details/82684491?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.baidujs&amp;dist_request_id=&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.baidujs" >https://blog.csdn.net/JLX_Sir/article/details/82684491?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.baidujs&amp;dist_request_id=&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-2.baidujs<i class="fas fa-external-link-alt"></i></a></p><p>è¯´WebGLä¸æ”¯æŒé«˜åˆ†è¾¨ç‡</p><p>è¯•è¯•åœ¨æ£€æŸ¥å™¨é‡Œè®¾ç½®è½¬ç  1/4åˆ†è¾¨ç‡ï¼Œæ¯”ç‰¹ç‡æ¨¡å¼ä½ï¼Œç©ºé—´è´¨é‡ä½</p><p>å¯¼å‡ºï¼Œä¸è¡Œ</p><p>11.</p><p><a class="link"   href="https://blog.csdn.net/qq_34243277/article/details/114398872?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242" >https://blog.csdn.net/qq_34243277/article/details/114398872?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-1&amp;spm=1001.2101.3001.4242<i class="fas fa-external-link-alt"></i></a></p><p>ç«ç‹è¿˜æœ‰é˜»æ­¢éŸ³è§†é¢‘çš„é»˜è®¤è®¾ç½®ï¼Ÿï¼Ÿå…³æ‰</p><p>mp4å’Œogvéƒ½ä¸è¡Œ</p><p>12.</p><p><a class="link"   href="https://blog.csdn.net/s1314_JHC/article/details/80618252" >https://blog.csdn.net/s1314_JHC/article/details/80618252<i class="fas fa-external-link-alt"></i></a></p><p>è¿˜æœ‰è¯´æ˜¯WebGLä¸æ”¯æŒMovieTextureçš„ï¼Œç”¨æ’ä»¶</p><p>å¯¼å‡ºåæ˜¯é»‘çš„ï¼Œç–¯ç‹‚æŠ¥é”™</p><p>13.</p><p><a class="link"   href="https://blog.csdn.net/wuyt2008/article/details/107592492?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161752087116780265448826%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=161752087116780265448826&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~times_rank-10-107592492.first_rank_v2_pc_rank_v29&amp;utm_term=unity+webgl+%E8%A7%86%E9%A2%91%E9%BB%91%E5%B1%8F" >https://blog.csdn.net/wuyt2008/article/details/107592492?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161752087116780265448826%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=161752087116780265448826&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~times_rank-10-107592492.first_rank_v2_pc_rank_v29&amp;utm_term=unity+webgl+%E8%A7%86%E9%A2%91%E9%BB%91%E5%B1%8F<i class="fas fa-external-link-alt"></i></a></p><p>è¿™ä¸ªè¯´WebGLåªèƒ½é€šè¿‡urlæ’­æ”¾</p><p>ç°åœ¨è°ƒè¿‡ç«ç‹çš„è®¾ç½®äº†ï¼Œå†è¯•è¯•urlå§</p><p>!!!!!!!!!!!!æˆåŠŸäº†ğŸ˜­!!!!!!!!!!!!</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Unityå†…è¿è¡Œæ—¶æ’­æ”¾è§†é¢‘æ²¡é—®é¢˜ï¼Œå¯¼å‡ºåç”¨ç«ç‹æ‰“å¼€å°±æ”¾ä¸äº†ï¼Œçœ‹æ§åˆ¶å°æŠ¥é”™æ˜¯&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/sp
      
    
    </summary>
    
    
      <category term="Note" scheme="https://coconutnutx.github.io/categories/Note/"/>
    
    
      <category term="unity" scheme="https://coconutnutx.github.io/tags/unity/"/>
    
  </entry>
  
  <entry>
    <title>Unity Project ç‰ˆæœ¬è®°å½•</title>
    <link href="https://coconutnutx.github.io/2021/03/21/unity-project-memo/"/>
    <id>https://coconutnutx.github.io/2021/03/21/unity-project-memo/</id>
    <published>2021-03-21T16:35:47.000Z</published>
    <updated>2021-03-21T16:35:47.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="02-16-V0-1"><a href="#02-16-V0-1" class="headerlink" title="02.16 V0.1"></a>02.16 V0.1</h1><h2 id="æ–°å¢åŸºç¡€ç§»åŠ¨æ“ä½œ"><a href="#æ–°å¢åŸºç¡€ç§»åŠ¨æ“ä½œ" class="headerlink" title="æ–°å¢åŸºç¡€ç§»åŠ¨æ“ä½œ"></a>æ–°å¢åŸºç¡€ç§»åŠ¨æ“ä½œ</h2><ul><li><p>ç‚¹å‡»å¯»è·¯</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Feb-16-2021 18-29-31.gif"                                     ></li><li><p>é è¿‘æ˜¾ç¤ºä»‹ç»</p></li><li><p>é¼ æ ‡æ»šåŠ¨å‰åå¹³ç§»</p></li><li><p>é”®ç›˜å‰åå·¦å³å¹³ç§»</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Feb-16-2021 18-30-32.gif"                                     ></li><li><p>é¼ æ ‡æ‹–æ‹½æ—‹è½¬è§†è§’</p></li></ul><h1 id="02-19-V0-1-1"><a href="#02-19-V0-1-1" class="headerlink" title="02.19 V0.1.1"></a>02.19 V0.1.1</h1><h2 id="æ–°å¢ä»‹ç»ç‰Œ"><a href="#æ–°å¢ä»‹ç»ç‰Œ" class="headerlink" title="æ–°å¢ä»‹ç»ç‰Œ"></a>æ–°å¢ä»‹ç»ç‰Œ</h2><ul><li><p>åˆ é™¤é è¿‘æ˜¾ç¤ºä»‹ç»</p></li><li><p>ä»‹ç»ç‰Œé¼ æ ‡ç§»å…¥é«˜äº®</p></li><li><p>ç‚¹å‡»ä»‹ç»ç‰Œå¯»è·¯</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Feb-19-2021 17-25-59.gif"                                     ><ul><li>å¯»è·¯ä¸­ä»»æ„æ“ä½œæ‰“æ–­</li><li>åˆ°è¾¾ç›®çš„åœ°åè½¬å‘ä»‹ç»ç‰Œ</li></ul></li></ul><h2 id="æ–°å¢å¯¼æ¸¸æ "><a href="#æ–°å¢å¯¼æ¸¸æ " class="headerlink" title="æ–°å¢å¯¼æ¸¸æ "></a>æ–°å¢å¯¼æ¸¸æ </h2><ul><li><p>ç‚¹å‡»ä¸­é—´æŒ‰é’®å¯»è·¯</p></li><li><p>ç‚¹å‡»å·¦å³æŒ‰é’®æ›´æ–°å¯¼æ¸¸æ å¹¶å¯»è·¯</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Feb-19-2021 17-26-58.gif"                                     ><ul><li>æœ€å·¦/æœ€å³æ—¶æŒ‰é’®ä¸å¯ç”¨</li></ul></li></ul><h2 id="æ–°å¢èœå•æ "><a href="#æ–°å¢èœå•æ " class="headerlink" title="æ–°å¢èœå•æ "></a>æ–°å¢èœå•æ </h2><ul><li>ç‚¹å‡»å¸®åŠ©æŒ‰é’®å¼¹å‡ºä»‹ç»</li></ul><h1 id="03-09-V0-1-2"><a href="#03-09-V0-1-2" class="headerlink" title="03.09 V0.1.2"></a>03.09 V0.1.2</h1><h2 id="æ–°å¢ä»‹ç»"><a href="#æ–°å¢ä»‹ç»" class="headerlink" title="æ–°å¢ä»‹ç»"></a>æ–°å¢ä»‹ç»</h2><ul><li><p>ç‚¹å‡»å¯¼èˆªæ ä¸­æŒ‰é’®ï¼Œæ˜¾ç¤ºç®€ä»‹</p><ul><li>æ–‡å­—è¶…å‡ºæ—¶æ˜¾ç¤ºæ»šåŠ¨æ¡</li></ul><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Mar-09-2021 17-34-17.gif"                                     ><ul><li>ç‚¹å‡»æŸ¥çœ‹å¤§å›¾æ‰“å¼€æ–°é¡µé¢</li></ul></li></ul><h1 id="03-11-V0-2"><a href="#03-11-V0-2" class="headerlink" title="03.11 V0.2"></a>03.11 V0.2</h1><h2 id="é‡å»ºå±•å…"><a href="#é‡å»ºå±•å…" class="headerlink" title="é‡å»ºå±•å…"></a>é‡å»ºå±•å…</h2><ul><li><p>åˆå§‹æ”¾å…¥éš‹åˆ°äº”ä»£çš„8å¼ ç”»</p></li><li><p>è°ƒæ•´ä»‹ç»ç‰Œæ ·å¼</p></li><li><p>åŠ å…¥å¤©èŠ±æ¿å’Œç¯</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Mar-11-2021 16-54-44.gif"                                     ></li></ul><h1 id="03-16-V0-2-1"><a href="#03-16-V0-2-1" class="headerlink" title="03.16 V0.2.1"></a>03.16 V0.2.1</h1><h2 id="åŠ å…¥å¸®åŠ©æŒ‰é’®"><a href="#åŠ å…¥å¸®åŠ©æŒ‰é’®" class="headerlink" title="åŠ å…¥å¸®åŠ©æŒ‰é’®"></a>åŠ å…¥å¸®åŠ©æŒ‰é’®</h2><ul><li><p>ç‚¹å‡»æ˜¾ç¤ºæ“ä½œè¯´æ˜</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Mar-16-2021 11-50-45.gif"                                     ></li></ul><h2 id="è°ƒæ•´"><a href="#è°ƒæ•´" class="headerlink" title="è°ƒæ•´"></a>è°ƒæ•´</h2><ul><li>ç‚¹å‡»æŸ¥çœ‹å¤§å›¾æ—¶ï¼Œåœ¨æ–°çª—å£æ‰“å¼€é¡µé¢</li><li>è°ƒæ•´ç‚¹å‡»å¯»è·¯ç²’å­æ•ˆæœ</li></ul><h1 id="03-20-V0-2-2"><a href="#03-20-V0-2-2" class="headerlink" title="03.20 V0.2.2"></a>03.20 V0.2.2</h1><h2 id="HallAæ­å»ºåŸºæœ¬å®Œæˆ"><a href="#HallAæ­å»ºåŸºæœ¬å®Œæˆ" class="headerlink" title="HallAæ­å»ºåŸºæœ¬å®Œæˆ"></a>HallAæ­å»ºåŸºæœ¬å®Œæˆ</h2><ul><li><p>å…±28å¼ ç”»ä½œ</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Mar-21-2021 22-30-25.gif"                                     ></li><li><p>è®¾ç½®åº§æ¤…ã€ç»¿æ¤ã€èŠ±ç“¶ç­‰</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Mar-21-2021 22-32-51.gif"                                     ></li></ul><h1 id="03-25-V0-2-3"><a href="#03-25-V0-2-3" class="headerlink" title="03.25 V0.2.3"></a>03.25 V0.2.3</h1><ul><li><p>ä¿®æ”¹å¯¼èˆªæ é«˜äº®æ•ˆæœ</p></li><li><p>æ–°å¢è£…é¥°æ•ˆæœ</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Mar-26-2021 10-03-52.gif"                                     ></li></ul><h2 id="æ–°å¢éŸ³ä¹"><a href="#æ–°å¢éŸ³ä¹" class="headerlink" title="æ–°å¢éŸ³ä¹"></a>æ–°å¢éŸ³ä¹</h2><ul><li>ç§»åŠ¨æ—¶æ·»åŠ è„šæ­¥éŸ³æ•ˆ</li><li>åƒé‡Œæ±Ÿå±±å›¾èµ°å»Šä¸­æ·»åŠ æµæ°´éŸ³æ•ˆ</li></ul><h1 id="03-31-V0-2-4"><a href="#03-31-V0-2-4" class="headerlink" title="03.31 V0.2.4"></a>03.31 V0.2.4</h1><p>ä¿®æ”¹UI</p><ul><li><p>ä¿®æ”¹å¯¼èˆªæ å›¾æ ‡ä¸ºæ–‡å­—ï¼Œé¿å…å·¦å³ç®­å¤´ä¸ç§»åŠ¨æ–¹å‘ä¸ä¸€è‡´å½±å“ä½“éªŒ</p></li><li><p>æ–°å¢ä¸Šä¸‹å·¦å³ç§»åŠ¨æŒ‰é’®</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Apr-02-2021 09-24-45.gif"                                     ></li><li><p>å¯¼èˆªæ åˆå§‹æ˜¾ç¤º0å±•è§ˆä»‹ç»ï¼Œæ­¤æ—¶åªæœ‰ä¸‹ä¸€å¹…æŒ‰é’®å¯ç‚¹å‡»</p></li></ul><p>ä¿®æ”¹å±•å…</p><ul><li>æ–°å¢å±•è§ˆä»‹ç»ï¼Œé»˜è®¤è¿›å…¥åœºæ™¯æ—¶é¢å‘å±•è§ˆä»‹ç»ï¼Œç‚¹ä¸‹ä¸€å¹…æ¥åˆ°ç¬¬ä¸€å¹…ç”»ä½œ</li><li>è°ƒæ•´æœä»£ä»‹ç»ä½ç½®ï¼Œä½¿å¯¼èˆªåˆ°ç”»ä½œæ—¶èƒ½å®Œæ•´æµè§ˆ</li><li>æ–°å¢å‡ºå£</li><li>æ–°å¢æ–¹å‘æŒ‡ç¤ºç‰Œï¼Œå°†éƒ¨åˆ†åœ°ä¸Šçš„èŠ±ç“¶ç§»åŠ¨åˆ°æŒ‡ç¤ºç‰Œå¹³å°ä¸Š</li></ul><p>ä¿®æ”¹å¯¼èˆªæ¨¡å—</p><ul><li>ç‚¹å‡»ç”»ä½œä¹Ÿå¯å¯¼èˆª</li></ul><h1 id="04-02-V0-3"><a href="#04-02-V0-3" class="headerlink" title="04.02 V0.3"></a>04.02 V0.3</h1><p>æ–°å¢å½±å…</p><ul><li><p>å¼€å§‹å’Œæš‚åœè§†é¢‘</p><img                       lazyload                     src="/images/loading.svg"                     data-src="/images/2021/Apr-02-2021 09-18-14.gif"                                     ></li></ul><p>å¯¼èˆªæ æ–°å¢å±•å¼€æŒ‰é’®</p><ul><li>ç‚¹å‡»å±•å¼€å»å½±å…å’Œå›èµ·ç‚¹æŒ‰é’®</li><li>å»å½±å…å¯¼èˆªåˆ°å½±å…</li><li>ä¼šèµ·ç‚¹å¯¼èˆªåˆ°å±•å…ä»‹ç»</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;02-16-V0-1&quot;&gt;&lt;a href=&quot;#02-16-V0-1&quot; class=&quot;headerlink&quot; title=&quot;02.16 V0.1&quot;&gt;&lt;/a&gt;02.16 V0.1&lt;/h1&gt;&lt;h2 id=&quot;æ–°å¢åŸºç¡€ç§»åŠ¨æ“ä½œ&quot;&gt;&lt;a href=&quot;#æ–°å¢åŸºç¡€ç§»åŠ¨æ“ä½œ&quot; cla
      
    
    </summary>
    
    
      <category term="Memo" scheme="https://coconutnutx.github.io/categories/Memo/"/>
    
    
      <category term="unity" scheme="https://coconutnutx.github.io/tags/unity/"/>
    
  </entry>
  
</feed>
