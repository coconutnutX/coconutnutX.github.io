<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    
    <title>SpringCloudç¬”è®°06 GatewayæœåŠ¡ç½‘å…³ | CoCoNutNut&#39;s NoteBook</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    

    
        <meta property="algolia:search" data-application-id="TEBQDP8EUP" data-api-key="ce44cbe0f6cb711854c1df404fd28ab1" data-index-name="coconutnutx">
    

    

    

    

    

    

    
<link rel="stylesheet" href="/dist/build.css?v=1633679241878.css">


    
<link rel="stylesheet" href="/dist/custom.css?v=1633679241878.css">


    <script>
        window.isPost = true
        window.aomori = {
            
            
            
        }
        window.aomori_logo_typed_animated = false
        window.aomori_search_algolia = true

    </script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="CoCoNutNut's NoteBook" type="application/atom+xml">
</head>

<body>

    <div class="container">
    <header class="header">
        <div class="header-type">
            
            <div class="header-type-inner">
                
                    <a class="header-type-title" href="/">CoCoNutNut&#39;s NoteBook</a>
                
    
                
            </div>
        </div>
        <div class="header-menu">
            <div class="header-menu-inner">
                
            </div>
            <div class="header-menu-social">
                
            </div>
        </div>

        <div class="header-menu-mobile">
            <div class="header-menu-mobile-inner" id="mobile-menu-open">
                <i class="icon icon-menu"></i>
            </div>
        </div>
    </header>

    <div class="header-menu-mobile-menu">
        <div class="header-menu-mobile-menu-bg"></div>
        <div class="header-menu-mobile-menu-wrap">
            <div class="header-menu-mobile-menu-inner">
                <div class="header-menu-mobile-menu-close" id="mobile-menu-close">
                    <i class="icon icon-cross"></i>
                </div>
                <div class="header-menu-mobile-menu-list">
                    
                </div>
            </div>
        </div>
    </div>

</div>

    <div class="container">
        <div class="main">
            <section class="inner">
                <section class="inner-main">
                    <div class="post">
    <article id="post-ckw1zv19i0066ukqdffm2gpuo" class="article article-type-post" itemscope
    itemprop="blogPost">

    <div class="article-inner">

        
          
        
        
        

        
        <header class="article-header">
            
  
    <h1 class="article-title" itemprop="name">
      SpringCloudç¬”è®°06 GatewayæœåŠ¡ç½‘å…³
    </h1>
  

        </header>
        

        <div class="article-more-info article-more-info-post hairline">

            <div class="article-date">
  <time datetime="2020-04-25T07:42:08.000Z" itemprop="datePublished">2020-04-25</time>
</div>

            
            <div class="article-category">
                <a class="article-category-link" href="/categories/Note/">Note</a>
            </div>
            

            
            <div class="article-tag">
                <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/springcloud/" rel="tag">springcloud</a></li></ul>
            </div>
            

            

        </div>

        <div class="article-entry post-inner-html hairline" itemprop="articleBody">
            <blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ThinkWon/article/details/103757927">https://blog.csdn.net/ThinkWon/article/details/103757927</a></p>
</blockquote>
<p>Gatewayæ˜¯åœ¨Springç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šæ„å»ºçš„APIç½‘å…³æœåŠ¡ï¼Œæ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹APIè¿›è¡Œè·¯ç”±ï¼Œä»¥åŠæä¾›ä¸€äº›å¼ºå¤§çš„è¿‡æ»¤å™¨åŠŸèƒ½ï¼Œ ä¾‹å¦‚ï¼šç†”æ–­ã€é™æµã€é‡è¯•ç­‰</p>
<p>é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½å’ŒSpring CloudæœåŠ¡å‘ç°åŠŸèƒ½</p>
<h1 id="åˆ›å»ºapi-gatewayæ¨¡å—"><a href="#åˆ›å»ºapi-gatewayæ¨¡å—" class="headerlink" title="åˆ›å»ºapi-gatewayæ¨¡å—"></a>åˆ›å»ºapi-gatewayæ¨¡å—</h1><h2 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸éœ€è¦æ³¨å†Œï¼Ÿ</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9201</span></span><br><span class="line"></span><br><span class="line"><span class="attr">service-url:</span></span><br><span class="line">  <span class="attr">user-service:</span> <span class="string">http://localhost:8201</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">          <span class="comment"># è·¯ç”±çš„ID</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">path_route</span></span><br><span class="line">          <span class="comment"># åŒ¹é…åè·¯ç”±åœ°å€</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">$&#123;service-url.user-service&#125;/user/&#123;id&#125;</span></span><br><span class="line">          <span class="attr">predicates:</span></span><br><span class="line">              <span class="comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">Path=/user/&#123;id&#125;</span></span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨consul-serverã€user-serviceå’Œapi-gateway</p>
<p>æµ‹è¯• <a target="_blank" rel="noopener" href="http://localhost:9201/user/1">http://localhost:9201/user/1</a></p>
<img src="/images/2020/screencapture2020-04-25 AM9.58.55.jpg">

<h1 id="Route-Predicate-çš„ä½¿ç”¨"><a href="#Route-Predicate-çš„ä½¿ç”¨" class="headerlink" title="Route Predicate çš„ä½¿ç”¨"></a>Route Predicate çš„ä½¿ç”¨</h1><ul>
<li><p>After Route Predicate : åœ¨æŒ‡å®šæ—¶é—´ä¹‹åçš„è¯·æ±‚ä¼šåŒ¹é…è¯¥è·¯ç”±</p>
</li>
<li><p>Before Route Predicate : åœ¨æŒ‡å®šæ—¶é—´ä¹‹å‰çš„è¯·æ±‚ä¼šåŒ¹é…è¯¥è·¯ç”±</p>
</li>
<li><p>Between Route Predicate : åœ¨æŒ‡å®šæ—¶é—´åŒºé—´å†…çš„è¯·æ±‚ä¼šåŒ¹é…è¯¥è·¯ç”±</p>
</li>
<li><p>Cookie Route Predicate : å¸¦æœ‰æŒ‡å®šCookieçš„è¯·æ±‚ä¼šåŒ¹é…è¯¥è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=jourwon</span><br></pre></td></tr></table></figure>
</li>
<li><p>Header Route Predicate : å¸¦æœ‰æŒ‡å®šè¯·æ±‚å¤´çš„è¯·æ±‚ä¼šåŒ¹é…è¯¥è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Request-Id:123</span><br></pre></td></tr></table></figure>
</li>
<li><p>Host Route Predicate : å¸¦æœ‰æŒ‡å®šHostçš„è¯·æ±‚ä¼šåŒ¹é…è¯¥è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Host:www.jourwon.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>Method Route Predicate : å‘é€æŒ‡å®šæ–¹æ³•çš„è¯·æ±‚ä¼šåŒ¹é…è¯¥è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br></pre></td></tr></table></figure>
</li>
<li><p>Path Route Predicate : å‘é€æŒ‡å®šè·¯å¾„çš„è¯·æ±‚ä¼šåŒ¹é…è¯¥è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/user/1</span><br></pre></td></tr></table></figure>
</li>
<li><p>Query Route Predicate : å¸¦æŒ‡å®šæŸ¥è¯¢å‚æ•°çš„è¯·æ±‚å¯ä»¥åŒ¹é…è¯¥è·¯ç”±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=jourwon</span><br></pre></td></tr></table></figure>
</li>
<li><p>RemoteAddr Route Predicate : ä»æŒ‡å®šè¿œç¨‹åœ°å€å‘èµ·çš„è¯·æ±‚å¯ä»¥åŒ¹é…è¯¥è·¯ç”±</p>
</li>
<li><p>Weight Route Predicate : ä½¿ç”¨æƒé‡æ¥è·¯ç”±ç›¸åº”è¯·æ±‚</p>
<p>å¦‚80%çš„è¯·æ±‚è·¯ç”±åˆ°localhost:8201ï¼Œ20%è·¯ç”±åˆ°localhost:8202</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">routes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">weight_high</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://localhost:8201</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Weight=group1,</span> <span class="number">8</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">weight_low</span></span><br><span class="line">        <span class="attr">uri:</span> <span class="string">http://localhost:8202</span></span><br><span class="line">        <span class="attr">predicates:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Weight=group1,</span> <span class="number">2</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="Route-Filterçš„ä½¿ç”¨"><a href="#Route-Filterçš„ä½¿ç”¨" class="headerlink" title="Route Filterçš„ä½¿ç”¨"></a>Route Filterçš„ä½¿ç”¨</h1><p>å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œåªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨</p>
<ul>
<li>AddRequestParameter GatewayFilter : ç»™è¯·æ±‚æ·»åŠ å‚æ•°çš„è¿‡æ»¤å™¨</li>
<li>StripPrefix GatewayFilter : å¯¹æŒ‡å®šæ•°é‡çš„è·¯å¾„å‰ç¼€è¿›è¡Œå»é™¤çš„è¿‡æ»¤å™¨</li>
<li>PrefixPath GatewayFilter : ä¸StripPrefixè¿‡æ»¤å™¨ç›¸åï¼Œä¼šå¯¹åŸæœ‰è·¯å¾„è¿›è¡Œå¢åŠ æ“ä½œçš„è¿‡æ»¤å™¨</li>
<li>Retry GatewayFilter : å¯¹è·¯ç”±è¯·æ±‚è¿›è¡Œé‡è¯•çš„è¿‡æ»¤å™¨ï¼Œæ ¹æ®è·¯ç”±è¯·æ±‚è¿”å›çš„HTTPçŠ¶æ€ç æ¥ç¡®å®šæ˜¯å¦è¿›è¡Œé‡è¯•</li>
</ul>
<h2 id="Hystrix-GatewayFilter"><a href="#Hystrix-GatewayFilter" class="headerlink" title="Hystrix GatewayFilter"></a>Hystrix GatewayFilter</h2><p>å°†æ–­è·¯å™¨åŠŸèƒ½æ·»åŠ åˆ°ç½‘å…³è·¯ç”±ä¸­</p>
<p>éœ€æ·»åŠ Hystrixçš„ç›¸å…³ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-hystrix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ ç›¸å…³æœåŠ¡é™çº§çš„å¤„ç†ç±»FallbackController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FallbackController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/fallback&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">fallback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        result.put(<span class="string">&quot;data&quot;</span>,<span class="keyword">null</span>);</span><br><span class="line">        result.put(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;Get request fallback!&quot;</span>);</span><br><span class="line">        result.put(<span class="string">&quot;code&quot;</span>,<span class="number">500</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®æœåŠ¡é™çº§</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hystrix</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">fallbackcmd</span></span><br><span class="line">      <span class="attr">fallback-uri:</span> <span class="string">forward:/fallback</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼ˆå…ˆé‡å¯api-gatewayï¼‰</p>
<p>å…³é—­user-serviceï¼Œè°ƒç”¨<a target="_blank" rel="noopener" href="http://localhost:9201/user/1">http://localhost:9201/user/1</a> </p>
<img src="/images/2020/screencapture2020-04-25 AM10.13.57.jpg">

<p>å‘ç”Ÿäº†é™çº§</p>
<h2 id="RequestRateLimiter-GatewayFilter"><a href="#RequestRateLimiter-GatewayFilter" class="headerlink" title="RequestRateLimiter GatewayFilter"></a>RequestRateLimiter GatewayFilter</h2><p>å¯ä»¥ç”¨äºé™æµ</p>
<p>æ·»åŠ ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis-reactive<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ é™æµç­–ç•¥çš„é…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisRateLimiterConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KeyResolver <span class="title">userKeyResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®è¯·æ±‚å‚æ•°ä¸­çš„usernameè¿›è¡Œé™æµ</span></span><br><span class="line">        <span class="keyword">return</span> exchange -&gt; Mono.just(exchange.getRequest().getQueryParams().getFirst(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> KeyResolver <span class="title">ipKeyResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®è®¿é—®IPè¿›è¡Œé™æµ</span></span><br><span class="line">        <span class="keyword">return</span> exchange -&gt; Mono.just(exchange.getRequest().getRemoteAddress().getHostName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ Rediså’ŒRequestRateLimiterçš„é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RequestRateLimiter</span></span><br><span class="line">  <span class="attr">args:</span></span><br><span class="line">    <span class="comment"># æ¯ç§’å…è®¸å¤„ç†çš„è¯·æ±‚æ•°é‡</span></span><br><span class="line">    <span class="attr">redis-rate-limiter.replenishRate:</span> <span class="number">1</span></span><br><span class="line">    <span class="comment"># æ¯ç§’æœ€å¤§å¤„ç†çš„è¯·æ±‚æ•°é‡</span></span><br><span class="line">    <span class="attr">redis-rate-limiter.burstCapacity:</span> <span class="number">2</span></span><br><span class="line">    <span class="comment"># é™æµç­–ç•¥ï¼Œå¯¹åº”ç­–ç•¥çš„Bean</span></span><br><span class="line">    <span class="attr">key-resolver:</span> <span class="string">&quot;#&#123;@ipKeyResolver&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•</p>
<p>å¯åŠ¨æœåŠ¡ï¼Œå¤šæ¬¡è¯·æ±‚ <a target="_blank" rel="noopener" href="http://localhost:9201/user/1">http://localhost:9201/user/1</a></p>
<img src="/images/2020/screencapture2020-04-25 AM10.35.06.jpg">

<p>æŠ¥é”™429</p>
<h2 id="DEBUGï¼šå¯åŠ¨å¤±è´¥"><a href="#DEBUGï¼šå¯åŠ¨å¤±è´¥" class="headerlink" title="DEBUGï¼šå¯åŠ¨å¤±è´¥"></a>DEBUGï¼šå¯åŠ¨å¤±è´¥</h2><p>æŠ¥é”™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">***************************</span><br><span class="line">APPLICATION FAILED TO START</span><br><span class="line">***************************</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line"></span><br><span class="line">Parameter 1 of method requestRateLimiterGatewayFilterFactory in org.springframework.cloud.gateway.config.GatewayAutoConfiguration required a single bean, but 2 were found:</span><br><span class="line">	- userKeyResolver: defined by method &#x27;userKeyResolver&#x27; in class path resource [com/coconutnut/apigateway/config/RedisRateLimiterConfig.class]</span><br><span class="line">	- ipKeyResolver: defined by method &#x27;ipKeyResolver&#x27; in class path resource [com/coconutnut/apigateway/config/RedisRateLimiterConfig.class]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line"></span><br><span class="line">Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Process finished with exit code 1</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æç¤ºåŠ ä¸Š@Primaryï¼Œè§£å†³</p>
<h2 id="DEBUGï¼šRedisè¿æ¥å¤±è´¥"><a href="#DEBUGï¼šRedisè¿æ¥å¤±è´¥" class="headerlink" title="DEBUGï¼šRedisè¿æ¥å¤±è´¥"></a>DEBUGï¼šRedisè¿æ¥å¤±è´¥</h2><p>è®¿é—®<a target="_blank" rel="noopener" href="http://localhost:9201/user/1æ—¶æ•°æ®æ­£å¸¸ï¼Œä½†æ§åˆ¶å°æŠ¥é”™">http://localhost:9201/user/1æ—¶æ•°æ®æ­£å¸¸ï¼Œä½†æ§åˆ¶å°æŠ¥é”™</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.data.redis.RedisConnectionFailureException: Unable to connect to Redis; nested exception is io.lettuce.core.RedisConnectionException: Unable to connect to localhost:6379</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getNativeConnection(LettuceConnectionFactory.java:1199) ~[spring-data-redis-2.2.3.RELEASE.jar:2.2.3.RELEASE]</span><br><span class="line">	at org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory$SharedConnection.getConnection(LettuceConnectionFactory.java:1178) ~[spring-data-redis-2.2.3.RELEASE.jar:2.2.3.RELEASE]</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½å®‰è£…</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.redis.cn/download.html">http://www.redis.cn/download.html</a></p>
</blockquote>
<p>å¯åŠ¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-5.0.5 % src/redis-server</span><br></pre></td></tr></table></figure>

<img src="/images/2020/screencapture2020-04-25 AM10.37.45.jpg">

<p>å¥½å¯çˆ±ğŸ™€</p>
<h1 id="ç»“åˆæ³¨å†Œä¸­å¿ƒä½¿ç”¨"><a href="#ç»“åˆæ³¨å†Œä¸­å¿ƒä½¿ç”¨" class="headerlink" title="ç»“åˆæ³¨å†Œä¸­å¿ƒä½¿ç”¨"></a>ç»“åˆæ³¨å†Œä¸­å¿ƒä½¿ç”¨</h1><p>ï¼ˆå¼ƒï¼‰</p>
<p>æ•™ç¨‹ç»™çš„æ˜¯eurekaï¼Œè¿™é‡Œå°è¯•æ”¹æˆconsul</p>
<p>åŠ ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æ”¹é…ç½®</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">application:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">api-gateway</span></span><br><span class="line">    <span class="attr">consul:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8500</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">service-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line">    <span class="attr">gateway:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">locator:</span></span><br><span class="line">          <span class="comment">#å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="comment">#ä½¿ç”¨å°å†™æœåŠ¡åï¼Œé»˜è®¤æ˜¯å¤§å†™</span></span><br><span class="line">          <span class="attr">lower-case-service-id:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h2 id="DEBUGï¼šå¯åŠ¨å¤±è´¥-1"><a href="#DEBUGï¼šå¯åŠ¨å¤±è´¥-1" class="headerlink" title="DEBUGï¼šå¯åŠ¨å¤±è´¥"></a>DEBUGï¼šå¯åŠ¨å¤±è´¥</h2><p>æŠ¥é”™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;webHandler&#x27; defined in class path resource [org/springframework/boot/autoconfigure/web/reactive/WebFluxAutoConfiguration$EnableWebFluxConfiguration.class]: Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;webEndpointReactiveHandlerMapping&#x27; defined in class path resource [org/springframework/boot/actuate/autoconfigure/endpoint/web/reactive/WebFluxEndpointManagementContextConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.boot.actuate.endpoint.web.reactive.WebFluxEndpointHandlerMapping]: Factory method &#x27;webEndpointReactiveHandlerMapping&#x27; threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;org.springframework.cloud.client.serviceregistry.ServiceRegistryAutoConfiguration$ServiceRegistryEndpointConfiguration&#x27;: Unsatisfied dependency expressed through field &#x27;registration&#x27;; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;consulRegistration&#x27; defined in class path resource [org/springframework/cloud/consul/serviceregistry/ConsulAutoServiceRegistrationAutoConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.cloud.consul.serviceregistry.ConsulAutoRegistration]: Factory method &#x27;consulRegistration&#x27; threw exception; nested exception is java.lang.IllegalArgumentException: Consul service ids must not be empty, must start with a letter, end with a letter or digit, and have as interior characters only letters, digits, and hyphen: 9201</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:603) ~[spring-beans-5.2.2.RELEASE.jar:5.2.2.RELEASE]</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:517) ~[spring-beans-5.2.2.RELEASE.jar:5.2.2.RELEASE]</span><br></pre></td></tr></table></figure>

<p>å‘ç°å¯åŠ¨ç±»å¿˜åŠ æ³¨é‡Šäº†ï¼ŒåŠ ä¸Šå…ˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸‹ä¾èµ–ï¼Œæ²¡æœ‰å†²çª</p>
<img src="/images/2020/screencapture2020-04-25 AM10.49.46.jpg">

<p>ä½†æ˜¯ç¡®å®æ˜¯åŠ äº†consulçš„ä¾èµ–ä¹‹åæ‰æŠ¥é”™çš„</p>
<p>å»æ‰å®ƒçš„ä¾èµ–å°±å¯ä»¥æ­£å¸¸å¯åŠ¨</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/jiazhiyuan0/article/details/84033595">https://blog.csdn.net/jiazhiyuan0/article/details/84033595</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/maduo_duo/article/details/84866137">https://blog.csdn.net/maduo_duo/article/details/84866137</a></p>
</blockquote>
<p>ç¡®å®å¯èƒ½æ˜¯æœ‰å†²çª</p>
<p>ç°åœ¨çš„Spring Bootç‰ˆæœ¬æ˜¯2.2.2.RELEASEï¼ŒSpring Cloudç‰ˆæœ¬æ˜¯2.2.0.RELEASE</p>
<p><strong>å°è¯•1</strong></p>
<p>æŠŠSpring Booté™åˆ°2.2.0</p>
<p>å¹¶ä¸è¡Œ</p>
<p><strong>å°è¯•2</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-gateway/issues/319">https://github.com/spring-cloud/spring-cloud-gateway/issues/319</a></p>
<p>Finchley is not compatible with boot 2.1.0. Either downgrade to boot 2.0.6 or use Greenwich.M3</p>
</blockquote>
<p>è¿™é‡Œç”¨çš„æ˜¯Hoxtonç‰ˆæœ¬</p>
<p>æ‰¾ä¸‹æ–‡æ¡£</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://spring.io/blog/2019/11/28/spring-cloud-hoxton-released">https://spring.io/blog/2019/11/28/spring-cloud-hoxton-released</a></p>
</blockquote>
<p>Consulå’ŒGatewayçš„ç‰ˆæœ¬ä¹Ÿæ˜¯2.2.0.RELEASE</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud#overview">https://spring.io/projects/spring-cloud#overview</a></p>
</blockquote>
<p>Hoxtonå¯¹åº”çš„Boot Versionæ˜¯2.2.x</p>
<p>åº”è¯¥æ²¡é”™</p>
<p>å¥½å‡ ä¸ªåœ°æ–¹çœ‹åˆ°è¯´æ˜¯spring-boot-starter-webçš„é—®é¢˜</p>
<img src="/images/2020/screencapture2020-04-25 AM11.49.26.jpg">

<p>æœä¸€ä¸‹ï¼Œç¡®å®å¼•ç”¨äº†</p>
<p>æŠŠå®ƒæ’é™¤</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/images/2020/screencapture2020-04-25 AM11.55.17.jpg">

<p>å¹¶ä¸è¡Œ</p>
<p><strong>å°è¯•3</strong></p>
<p>æ‰¾æ‰¾Spring Cloud Hoxton + Gatway + Consulçš„æ•™ç¨‹</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://piotrminkowski.com/2019/11/06/microservices-with-spring-boot-spring-cloud-gateway-and-consul-cluster/">https://piotrminkowski.com/2019/11/06/microservices-with-spring-boot-spring-cloud-gateway-and-consul-cluster/</a></p>
</blockquote>
<p>è¿™ä¸ªæ•™ç¨‹çš„ä¾èµ–æ˜¯</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>å·²æœ‰</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>æŠŠä¹‹å‰spring-boot-starterçš„ä¾èµ–æ”¹æˆspring-boot-starter-web</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯æ²¡å¯åŠ¨æˆåŠŸï¼Œä½†æ˜¯æŠ¥é”™å˜æˆäº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-04-25 12:09:53.083 ERROR 4989 --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br><span class="line"></span><br><span class="line">org.springframework.context.ApplicationContextException: Unable to start web server; nested exception is org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat</span><br><span class="line">	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:156) ~[spring-boot-2.2.2.RELEASE.jar:2.2.2.RELEASE]</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fly_west/article/details/101229871?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1&amp;utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1">https://blog.csdn.net/fly_west/article/details/101229871?depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1&amp;utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-1</a></p>
</blockquote>
<p>è¿˜æ˜¯spring-boot-starter-webå†²çªçš„é—®é¢˜</p>
<p>ç°åœ¨å†æŠŠgatewayé‡Œçš„webfluxæ’é™¤è¯•è¯•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-04-25 12:12:38.331 ERROR 5002 --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br><span class="line"></span><br><span class="line">org.springframework.context.ApplicationContextException: Unable to start web server; nested exception is org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat</span><br><span class="line">	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:156) ~[spring-boot-2.2.2.RELEASE.jar:2.2.2.RELEASE]</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p><strong>å°è¯•4</strong></p>
<p>ä¾èµ–å…¨æ”¹å¾—å’Œåˆšé‚£ä¸ªæ•™ç¨‹ä¸€æ ·è¯•è¯•</p>
<p>hystrixå’Œredisç›¸å…³çš„éƒ½æ³¨é‡Šæ‰</p>
<p>ç‰ˆæœ¬</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">spring-cloud.version</span>&gt;</span>Hoxton.RC1<span class="tag">&lt;/<span class="name">spring-cloud.version</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>è¿˜æ˜¯å´©äº†</p>
<p>å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œä¾èµ–çš„æœ€ä¸‹é¢æ€ä¹ˆè¿˜æœ‰ä¸ª</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¼°è®¡æ˜¯åˆ›å»ºçš„æ—¶å€™å¯¼å…¥çš„ï¼Œåˆ æ‰</p>
<p>é‡å¯</p>
<p>å´©</p>
<p><strong>å°è¯•5</strong></p>
<p>è¿˜æ˜¯æŠŠç‰ˆæœ¬æ”¹å›Spring Boot 2.2.0å’ŒSpring Cloud Hoxton</p>
<p>ç°åœ¨çš„ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--            &lt;exclusions&gt;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--                &lt;exclusion&gt;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--                    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--                    &lt;artifactId&gt;spring-cloud-starter-webflux&lt;/artifactId&gt;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--                &lt;/exclusion&gt;--&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--            &lt;/exclusions&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨çš„æŠ¥é”™</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-04-25 12:32:36.436 ERROR 5170 --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br><span class="line"></span><br><span class="line">org.springframework.context.ApplicationContextException: Unable to start web server; nested exception is org.springframework.boot.web.server.WebServerException: Unable to start embedded Tomcat</span><br><span class="line">	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.onRefresh(ServletWebServerApplicationContext.java:156) ~[spring-boot-2.2.2.RELEASE.jar:2.2.2.RELEASE]</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p>åˆšæ‰çœ‹ä¾èµ–å›¾å‘ç°gatewayä¾èµ–çš„æ˜¯webflux</p>
<p>è¿™é‡Œä¾èµ–çš„æ˜¯web</p>
<p>å¦‚æœæ”¹æˆwebfluxï¼Ÿ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-04-25 12:33:57.502 ERROR 5182 --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br><span class="line"></span><br><span class="line">org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;webHandler&#x27; defined in class path resource [org/springframework/boot/autoconfigure/web/reactive/WebFluxAutoConfiguration$EnableWebFluxConfiguration.class]: Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;webEndpointReactiveHandlerMapping&#x27; defined in class path resource [org/springframework/boot/actuate/autoconfigure/endpoint/web/reactive/WebFluxEndpointManagementContextConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.boot.actuate.endpoint.web.reactive.WebFluxEndpointHandlerMapping]: Factory method &#x27;webEndpointReactiveHandlerMapping&#x27; threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;org.springframework.cloud.client.serviceregistry.ServiceRegistryAutoConfiguration$ServiceRegistryEndpointConfiguration&#x27;: Unsatisfied dependency expressed through field &#x27;registration&#x27;; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;consulRegistration&#x27; defined in class path resource [org/springframework/cloud/consul/serviceregistry/ConsulAutoServiceRegistrationAutoConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.cloud.consul.serviceregistry.ConsulAutoRegistration]: Factory method &#x27;consulRegistration&#x27; threw exception; nested exception is java.lang.IllegalArgumentException: Consul service ids must not be empty, must start with a letter, end with a letter or digit, and have as interior characters only letters, digits, and hyphen: 9201</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:603) ~[spring-beans-5.2.2.RELEASE.jar:5.2.2.RELEASE]</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥åº”è¯¥æ˜¯ï¼Œå¯åŠ¨éœ€è¦webï¼Œå¦åˆ™æŠ¥BeanCreationException</p>
<p>è€Œgatewayä¾èµ–äº†webfluxï¼Œå’Œwebå†²çªï¼ŒæŠ¥ApplicationContextException</p>
<p>å†æŠŠexclusionåŠ ä¸Š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-webflux<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-04-25 12:35:30.492 ERROR 5188 --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br><span class="line"></span><br><span class="line">org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;webHandler&#x27; defined in class path resource [org/springframework/boot/autoconfigure/web/reactive/WebFluxAutoConfiguration$EnableWebFluxConfiguration.class]: Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;webEndpointReactiveHandlerMapping&#x27; defined in class path resource [org/springframework/boot/actuate/autoconfigure/endpoint/web/reactive/WebFluxEndpointManagementContextConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.boot.actuate.endpoint.web.reactive.WebFluxEndpointHandlerMapping]: Factory method &#x27;webEndpointReactiveHandlerMapping&#x27; threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;org.springframework.cloud.client.serviceregistry.ServiceRegistryAutoConfiguration$ServiceRegistryEndpointConfiguration&#x27;: Unsatisfied dependency expressed through field &#x27;registration&#x27;; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;consulRegistration&#x27; defined in class path resource [org/springframework/cloud/consul/serviceregistry/ConsulAutoServiceRegistrationAutoConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.cloud.consul.serviceregistry.ConsulAutoRegistration]: Factory method &#x27;consulRegistration&#x27; threw exception; nested exception is java.lang.IllegalArgumentException: Consul service ids must not be empty, must start with a letter, end with a letter or digit, and have as interior characters only letters, digits, and hyphen: 9201</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:603) ~[spring-beans-5.2.2.RELEASE.jar:5.2.2.RELEASE]</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<p>æŠŠexclusionå»æ‰ï¼Œwebfluxåˆ äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-04-25 12:37:30.419 ERROR 5199 --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br><span class="line"></span><br><span class="line">org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;webHandler&#x27; defined in class path resource [org/springframework/boot/autoconfigure/web/reactive/WebFluxAutoConfiguration$EnableWebFluxConfiguration.class]: Initialization of bean failed; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;webEndpointReactiveHandlerMapping&#x27; defined in class path resource [org/springframework/boot/actuate/autoconfigure/endpoint/web/reactive/WebFluxEndpointManagementContextConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.boot.actuate.endpoint.web.reactive.WebFluxEndpointHandlerMapping]: Factory method &#x27;webEndpointReactiveHandlerMapping&#x27; threw exception; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;org.springframework.cloud.client.serviceregistry.ServiceRegistryAutoConfiguration$ServiceRegistryEndpointConfiguration&#x27;: Unsatisfied dependency expressed through field &#x27;registration&#x27;; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;consulRegistration&#x27; defined in class path resource [org/springframework/cloud/consul/serviceregistry/ConsulAutoServiceRegistrationAutoConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.cloud.consul.serviceregistry.ConsulAutoRegistration]: Factory method &#x27;consulRegistration&#x27; threw exception; nested exception is java.lang.IllegalArgumentException: Consul service ids must not be empty, must start with a letter, end with a letter or digit, and have as interior characters only letters, digits, and hyphen: 9201</span><br><span class="line">	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:603) ~[spring-beans-5.2.2.RELEASE.jar:5.2.2.RELEASE]</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<img src="/images/2020/a.gif" width=200>

<p><strong>å°è¯•6</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-gateway/issues/319">https://github.com/spring-cloud/spring-cloud-gateway/issues/319</a></p>
</blockquote>
<p>ä¹‹å‰è¿™ä¸ªissueé‡Œé¢æœ‰äººè¯´</p>
<blockquote>
<p>spring cloud gateway is not compatible with spring mvc and servlet containers, what you get when you depend on <code>spring-boot-starter-web</code>.</p>
</blockquote>
<p>è¯•è¯•æŠŠspring-boot-starter-webé‡Œçš„spring mvcå’Œservletæ’é™¤äº†ï¼Ÿ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¸è¡Œ</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-gateway/issues/1004">https://github.com/spring-cloud/spring-cloud-gateway/issues/1004</a></p>
<p><code>spring-cloud-gateway-mvc</code> is not compatible with gateway core. You need to use <code>spring-cloud-gateway-webflux</code>.</p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-gateway/issues/1473">https://github.com/spring-cloud/spring-cloud-gateway/issues/1473</a></p>
<p>Spring MVC found on classpath, which is incompatible with Spring Cloud Gateway at this time. Please remove spring-boot-starter-web dependency.</p>
</blockquote>
<p>ç°åœ¨å°±åªæœ‰è¿™å‡ ä¸ªä¾èµ–ï¼Œä¸ºä»€ä¹ˆè¿˜æ˜¯å¯åŠ¨ä¸äº†å‘¢</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>éš¾é“actuatoré‡Œé¢ä¹Ÿæœ‰webï¼Ÿ</p>
<p>æŠŠå®ƒæ³¨é‡Šæ‰</p>
<p>æŠ¥é”™å˜æˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2020-04-25 13:17:36.860 ERROR 5310 --- [           main] o.s.boot.SpringApplication               : Application run failed</span><br><span class="line"></span><br><span class="line">org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;org.springframework.cloud.client.serviceregistry.AutoServiceRegistrationAutoConfiguration&#x27;: Unsatisfied dependency expressed through field &#x27;autoServiceRegistration&#x27;; nested exception is org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name &#x27;consulAutoServiceRegistration&#x27; defined in class path resource [org/springframework/cloud/consul/serviceregistry/ConsulAutoServiceRegistrationAutoConfiguration.class]: Unsatisfied dependency expressed through method &#x27;consulAutoServiceRegistration&#x27; parameter 3; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#x27;consulRegistration&#x27; defined in class path resource [org/springframework/cloud/consul/serviceregistry/ConsulAutoServiceRegistrationAutoConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [org.springframework.cloud.consul.serviceregistry.ConsulAutoRegistration]: Factory method &#x27;consulRegistration&#x27; threw exception; nested exception is java.lang.IllegalArgumentException: Consul service ids must not be empty, must start with a letter, end with a letter or digit, and have as interior characters only letters, digits, and hyphen: 9201</span><br><span class="line">	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:643) ~[spring-beans-5.2.2.RELEASE.jar:5.2.2.RELEASE]</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/spring-cloud/spring-cloud-gateway/issues/802">https://github.com/spring-cloud/spring-cloud-gateway/issues/802</a></p>
<p>Gateway is thought to be used as a separate technical component in your architecture. It usually does not make sense to add a gateway dependency directly to your business code.</p>
</blockquote>
<p>é€‚åˆå•ç‹¬ä½¿ç”¨â€¦</p>
<p>å•ç‹¬ä½¿ç”¨â€¦</p>
<p>å•ç‹¬â€¦</p>
<p>fine</p>
<p>æš‚æ—¶å°±ä¸ç»“åˆæ³¨å†Œä¸­å¿ƒäº†</p>
<p>ä»¥åæœ‰éœ€è¦å†è¯´</p>
<p>å†è§</p>

        </div>

    </div>

    

    

    

    

    

    
<nav class="article-nav">
  
    <a href="/2020/04/25/note-springcloud-07/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-caption">ä¸‹ä¸€ç¯‡</div>
      <div class="article-nav-title">
        
          SpringCloudç¬”è®°07 æ€»ç»“
        
      </div>
    </a>
  
  
    <a href="/2020/04/24/note-mybatisplus-06/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-caption">ä¸Šä¸€ç¯‡</div>
      <div class="article-nav-title">MyBatisPlusç¬”è®°06 è‡ªåŠ¨å¡«å……ã€é€»è¾‘åˆ é™¤ã€é€šç”¨æšä¸¾ç­‰</div>
    </a>
  
</nav>


    <section class="share">
        <div class="share-title">åˆ†äº«</div>
        <a class="share-item" target="_blank"
            href="https://twitter.com/share?text=SpringCloudç¬”è®°06 GatewayæœåŠ¡ç½‘å…³ - CoCoNutNut's NoteBook&url=http://yoursite.com/2020/04/25/note-springcloud-06/">
            <box-icon type='logo' name='twitter'></box-icon>
        </a>
        <a class="share-item" target="_blank"
            href="https://www.facebook.com/sharer.php?title=SpringCloudç¬”è®°06 GatewayæœåŠ¡ç½‘å…³ - CoCoNutNut's NoteBook&u=http://yoursite.com/2020/04/25/note-springcloud-06/">
            <box-icon name='facebook-square' type='logo' ></box-icon>
        </a>
        <!-- <a class="share-item" target="_blank"
            href="https://service.weibo.com/share/share.php?title=SpringCloudç¬”è®°06 GatewayæœåŠ¡ç½‘å…³ - CoCoNutNut's NoteBook&url=http://yoursite.com/2020/04/25/note-springcloud-06/&pic=">
            <div class="n-icon n-icon-weibo"></div>
        </a> -->
    </section>

</article>












</div>
                </section>
            </section>

            
            <aside class="sidebar sidebar-search-fix">
                

    <div class="search">
    <div class="has-icon-right">
        <input type="text" class="form-input" id="search" placeholder="SEARCH" autocomplete="off">
        <div class="form-icon">
            <box-icon name='search' color="#3c4859"></box-icon>
        </div>
    </div>
    <div class="search-result" id="search-ps"></div>
</div>


<div class="widget" id="widget">
    
      
  <div class="widget-wrap">
    <div class="widget-inner">
      <div class="toc post-toc-html"></div>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-cate">
    <div class="widget-title"><span>Categories</span></div>
    <div class="widget-inner">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Debug/">Debug</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Memo/">Memo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Note/">Note</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-tags">
    <div class="widget-title"><span>Tags</span></div>
    <div class="widget-inner">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/" rel="tag">algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ar/" rel="tag">ar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bioinformatics/" rel="tag">bioinformatics</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrent-algorithm/" rel="tag">concurrent_algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/distributed-algorithm/" rel="tag">distributed_algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mindmap/" rel="tag">mindmap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis/" rel="tag">mybatis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mybatis-plus/" rel="tag">mybatis_plus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/" rel="tag">spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springcloud/" rel="tag">springcloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springmvc/" rel="tag">springmvc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sublinear-algorithm/" rel="tag">sublinear_algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/" rel="tag">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unity/" rel="tag">unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-recent-posts">
    <div class="widget-title"><span>Recent Posts</span></div>
    <div class="widget-inner">
      <ul>
        
          <li>
            <a href="/2021/11/16/algolia/">æ›´æ”¹ä¸»é¢˜è®°å½•</a>
          </li>
        
          <li>
            <a href="/2021/11/13/concurrent2/">sync example note2ï¼šmemory order</a>
          </li>
        
          <li>
            <a href="/2021/11/13/concurrent/">sync example note1</a>
          </li>
        
          <li>
            <a href="/2021/10/31/register/">Summary on basic register reductions</a>
          </li>
        
          <li>
            <a href="/2021/10/27/countsketch/">CountSketch Matrix</a>
          </li>
        
      </ul>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-archive">
    <div class="widget-title"><span>Archive</span></div>
    <div class="widget-inner">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a></li></ul>
    </div>
  </div>


    
</div>

<div id="backtop"><i class="icon icon-arrow-up"></i></div>
            </aside>
            
        </div>
    </div>

    <footer class="footer">
    <div class="footer-wave">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="#3c4859" fill-opacity="1" d="M0,160L60,181.3C120,203,240,245,360,240C480,235,600,181,720,186.7C840,192,960,256,1080,261.3C1200,267,1320,213,1380,186.7L1440,160L1440,320L1380,320C1320,320,1200,320,1080,320C960,320,840,320,720,320C600,320,480,320,360,320C240,320,120,320,60,320L0,320Z"></path></svg>
    </div>

    <div class="footer-wrap">
        <div class="footer-inner"> 
            CoCoNutNut&#39;s NoteBook &copy; 2021<br>
            Powered By Hexo Â· Theme By <a href="https://github.com/lh1me/hexo-theme-aomori" target="_blank">Aomori</a>
        </div>
    </div>

</footer>






<script src="/dist/build.js?1633679241878.js"></script>


<script src="/dist/custom.js?1633679241878.js"></script>









</body>

</html>